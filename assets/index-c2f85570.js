import{o as a,b as l,e,d as ce,C as ve,k as r,c as Y,s as de,L as U,t as o,n as p,F as L,r as z,f as $,l as x,w as _,T as W,a as R,m as M,M as we,E as De,D as X,O as Te,A as $e,B as Z,Q as Pe,R as ke,S as Se}from"./index-fa2db9d6.js";import{_ as Ce}from"./EntitiesMapViewer-bc4914c1.js";import{D as re}from"./DateUtils-c1a87f7b.js";import{g as ge}from"./Colors-74604422.js";import{_ as pe,t as Me}from"./ChartComponent-7f59dc61.js";import{a as ie,_ as Le}from"./Select-bf356678.js";import{_ as he}from"./BfTable-1e0d91ab.js";import{_ as se}from"./BfButton-539b9149.js";import{p as ze}from"./parcelData-63db60fa.js";import{_ as Ie}from"./plugin-vue_export-helper-c27b6911.js";import"./cicciotto-25d2cff1.js";import"./use-outside-click-21f3f43a.js";import"./use-text-value-05efac81.js";import"./use-tree-walker-7cc814eb.js";function me(u,V){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})])}function _e(u,V){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})])}const Be=[{id:0,name:"Rodilegno"},{id:1,name:"Lobesia botrana"},{id:2,name:"Tortricidae"},{id:3,name:"Coleottero"},{id:4,name:"Popillia Japonica"},{id:5,name:"Processionaria"},{id:6,name:"Cerambycidae"}],Ae=[{id:"1",name:"S03925",type:"Cymatrap garden",last_capture:new Date("2023-03-28"),warning_treshold:30,danger_treshold:50,insects:[{count:5,id:"0",name:"Rodilegno"},{count:18,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.560286922994884,lon:10.721558966213962},battery:67,signal:100},{id:"2",name:"S05321",type:"Cymatrap garden",last_capture:new Date("2023-03-10"),warning_treshold:30,danger_treshold:70,insects:[{count:2,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.561788608518086,lon:10.719467188742241},battery:89,signal:70},{id:"3",name:"S08513",type:"Cymatrap pro",last_capture:new Date("2023-02-07"),warning_treshold:200,danger_treshold:300,insects:[{count:12,id:"0",name:"Rodilegno"},{count:1,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56160296275679,lon:10.720474777327212},battery:56,signal:50},{id:"4",name:"S00593",type:"Isagro dispenser",last_capture:new Date("2023-04-30"),warning_treshold:10,danger_treshold:20,insects:[{count:32,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559936248891546,lon:10.720922594476088},battery:34,signal:100},{id:"5",name:"S03858",type:"Isagro dispenser",last_capture:new Date("2023-03-14"),warning_treshold:80,danger_treshold:200,insects:[{count:41,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55896672672015,lon:10.721040441094033},battery:16,signal:80},{id:"6",name:"S05952",type:"Isagro dispenser",last_capture:new Date("2023-03-10"),warning_treshold:120,danger_treshold:200,insects:[{count:32,id:"0",name:"Rodilegno"},{count:15,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55821997698153,lon:10.721606104861031},battery:89,signal:30},{id:"7",name:"S08332",type:"Linea bacterocera",last_capture:new Date("2023-03-22"),warning_treshold:50,danger_treshold:100,insects:[{count:4,id:"0",name:"Rodilegno"},{count:7,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56011777455661,lon:10.722436923510717},battery:78,signal:20},{id:"8",name:"S09876",type:"Isagro carpo +",last_capture:new Date("2023-03-24"),warning_treshold:30,danger_treshold:70,insects:[{count:0,id:"0",name:"Rodilegno"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55862017006319,lon:10.72403963751722},battery:55,signal:0},{id:"9",name:"S02273",type:"Isagro carpo +",last_capture:new Date("2023-03-26"),warning_treshold:10,danger_treshold:20,insects:[{count:51,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559086370782154,lon:10.721712166809247},battery:54,signal:80},{id:"10",name:"S01423",type:"Isagro double wing",last_capture:new Date("2023-03-07"),warning_treshold:10,danger_treshold:20,insects:[{count:54,id:"0",name:"Rodilegno"},{count:34,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559346286317734,lon:10.722271938245344},battery:79,signal:100}],Ee={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},Re=e("span",{class:"sr-only"},"Chiudi pannello",-1),Ve=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),je=[Re,Ve],Ne={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},Fe={class:"flex w-6/12 items-center border-r pr-6"},Oe={class:"flex flex-grow flex-col"},We={class:"flex items-center gap-x-3"},Je={class:"flex gap-x-3 text-lg leading-7"},Ue={class:"font-semibold"},qe={class:"mt-2 text-sm leading-6 text-label"},He={class:"flex w-6/12"},Ge={class:"flex w-full divide-x divide-border"},Qe={class:"text-sm font-medium leading-6 text-label"},Xe={class:"text-3xl font-medium tracking-tight text-text"},Ke={key:0,class:"text-sm text-label"},Ye={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Ze={class:"flex h-full w-6/12"},et={key:0,class:"flex h-full w-full"},tt={class:"relative flex h-full w-full pb-4 pl-3 pr-3 pt-4"},at={class:"absolute z-10 flex h-16 w-12 flex-col items-center justify-center",style:{left:"calc(50% - 1.5rem)",top:"calc(50% - 2rem)"}},st=e("span",{class:"text-sm font-medium text-label"},"Totali",-1),nt={class:"text-3xl font-medium tracking-tight text-text"},lt={class:"thin-scrollbar relative flex h-full w-full flex-col space-y-3 overflow-auto pb-4 pl-8 pr-6"},ot={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3"},it={class:"flex w-full flex-col"},rt={class:"flex w-full items-center"},ct={class:"text-sm font-medium text-label"},dt={class:"text-3xl font-medium tracking-tight text-text"},ut={key:1,class:"thin-scrollbar h-full w-full overflow-auto px-6 pb-6"},ft={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 py-3"},gt=e("th",null,"Insetto",-1),pt=e("th",null,"Conteggio",-1),ht={class:"flex flex-col h-full w-6/12 px-6 border-l overflow-auto thin-scrollbar"},vt={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3 space-x-2"},mt={key:0,class:"flex h-full w-full"},_t={class:"relative flex h-full w-full pb-4 pt-4"},xt={key:1,class:"w-full pb-6"},bt=e("th",null,"Giorno",-1),yt=ce({__name:"trapResumePanel",props:{insectTypes:{},curTrap:{}},emits:["close"],setup(u,{emit:V}){const q=ve(),k=r(!0);let f=!1,I=!1;const j=r(null),g=r(null),H=["Anno","Mese","Settimana"],b=r("Settimana"),S=r("chart"),N=r("chart"),F=r(0),T=r(0);let c=r([]);const y=r([]),i=Me.color;let v=[],B=[],G=[],O=[],P=[];function Q(s){s.style.height=0}function le(s){s.style.height=`${u.curTrap.battery}%`,s.style.transition="height 1s ease-out"}function ee(s){s.style.height=0}function D(s){s.style.height=`${u.curTrap.signal}%`,s.style.transition="height 1s ease-out"}const w=Y(()=>{let s=0;return u.curTrap.insects.forEach(d=>{s+=d.count}),s}),A=Y(()=>w.value>u.curTrap.danger_treshold),t=Y(()=>w.value>u.curTrap.warning_treshold),J=Y(()=>Math.floor(w.value/u.curTrap.danger_treshold*100));de(async()=>{u.curTrap?(fe(),ue(),oe(),te()):(f=!0,I=!0),k.value=!1}),U(()=>q.darkMode,async()=>{oe(!0),te(!0)}),U(()=>u.curTrap,async()=>{fe(),ue(),oe(),te()});function ue(){c.value=[];const s=new Date,d=365;s.setDate(new Date().getDate()-d);for(let n=0;n<d;n++){const h=new Date(s);h.setDate(h.getDate()+n);const m=[];u.curTrap.insects.forEach(E=>{m.push({id:E.id,name:E.name,count:Math.floor(Math.random()*25)+1})});const C={insects:m,date:h};c.value.push(C)}}function fe(){const s=Math.floor(Math.random()*25)+1;y.value=[{name:"Batteria",value:u.curTrap.battery.toString(),unit:"%"},{name:"Segnale",value:u.curTrap.signal.toString(),unit:"%"},{name:"Ultima cattura",value:s.toString(),unit:"gg fa"}]}function oe(s=!1){if(u.curTrap.insects.length===0){f=!0;return}const d=u.curTrap.insects,n=ge("color-bg-100");G=[],v=[],P=[];const h={id:"insects",name:"Insetti",radius:["82%","90%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:n,borderWidth:4},label:{show:!1,position:"center"},emphasis:{label:{show:!1,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},type:"pie",data:[]};d.forEach(m=>{P.findIndex(C=>C.type_id===m.id)===-1&&P.push({type_id:m.id,type_description:m.name,colorIndex:0,count:0})}),P.forEach((m,C)=>{let E=0;d.forEach(ae=>{ae.id===m.type_id&&(E=E+ae.count)}),m.count=E,m.colorIndex=C,G.push(m.type_description),h.data.push({value:m.count,name:m.type_description})}),v.push(h),xe(),s&&F.value++}U(()=>b.value,async()=>{te()});const K=Y(()=>{if(c.value.length===0)return[];const s=[];let d=new Date;c.value.length>0&&(d=new Date(c.value[c.value.length-1].date));let n=0;return b.value==="Anno"?n=365:b.value==="Mese"?n=30:b.value==="Settimana"&&(n=7),d.setDate(new Date().getDate()-n),d.setHours(0,0,0,0),c.value.forEach(h=>{const m=new Date(h.date);m.setHours(0,0,0,0),m.getTime()>d.getTime()&&s.push(h)}),s});function te(s=!1){if(K.value.length===0){I=!0;return}ge("color-bg-100"),O=[],B=[];const d=[],n=[];K.value[0].insects.forEach(h=>{d.findIndex(m=>m.id===h.id)===-1&&d.push({id:h.id,name:h.name})}),d.forEach((h,m)=>{const C={id:"line_"+h.id,name:h.name,smooth:!0,lineStyle:{width:2},symbolSize:6,type:"line",data:[]};n.push(C)}),K.value.forEach(h=>{const m=new Date(h.date);O.push(new re(m).format("dd/MM")),h.insects.forEach(C=>{const E=n.findIndex(ae=>ae.id==="line_"+C.id);E!==-1&&n[E].data.push(C.count)})}),B.push(...n),be(),s&&T.value++}function xe(){j.value={grid:{top:12,right:24,left:24,bottom:20,containLabel:!0},tooltip:{trigger:"none"},legend:{show:!1,selectedMode:!1},series:v,textStyle:{fontFamily:"Work Sans"}}}function be(){g.value={grid:{top:12,right:0,left:0,bottom:0,containLabel:!0},tooltip:{trigger:"axis",confine:!0},legend:{show:!1},xAxis:{type:"category",data:O},yAxis:[{type:"value",name:"",position:"left"}],series:B,textStyle:{fontFamily:"Work Sans"}}}function ye(s,d){return new re(s).format(d)}return(s,d)=>(a(),l("div",Ee,[e("button",{type:"button",onClick:d[0]||(d[0]=n=>V("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},je),e("div",Ne,[e("div",Fe,[e("div",Oe,[e("div",We,[e("h1",Je,[e("span",Ue,o(s.curTrap.type),1)])]),e("p",qe,o(s.curTrap.name),1)]),e("div",{class:p(["order-first flex-none rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset sm:order-none",{"bg-green-500/20 text-green-700 ring-green-400/30":!t.value,"bg-orange-500/20 text-orange-700 ring-orange-400/30":t.value&&!A.value,"bg-red-500/20 text-red-700 ring-red-400/30":A.value}])}," Saturazione al "+o(J.value)+"% ",3)]),e("div",He,[e("div",Ge,[(a(!0),l(L,null,z(y.value,(n,h)=>(a(),l("div",{key:n.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Qe,o(n.name),1),(a(),l("p",{class:"flex items-baseline gap-x-2",key:n.value},[e("span",Xe,o(n.value),1),n.unit?(a(),l("span",Ke,o(n.unit),1)):$("",!0)])),n.name==="Batteria"?(a(),l("div",{class:p(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":s.curTrap.battery>=75,"bg-orange-50":s.curTrap.battery>=50&&s.curTrap.battery<75,"bg-red-50":s.curTrap.battery<50}]),key:s.curTrap.id},[x(W,{appear:"",onBeforeAppear:Q,onAfterAppear:le},{default:_(()=>[e("div",{class:p(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":s.curTrap.battery>=75,"bg-orange-400":s.curTrap.battery>=50&&s.curTrap.battery<75,"bg-red-400":s.curTrap.battery<50}])},null,2)]),_:1})],2)):$("",!0),n.name==="Segnale"?(a(),l("div",{class:p(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":s.curTrap.signal>=75,"bg-orange-50":s.curTrap.signal>=50&&s.curTrap.signal<75,"bg-red-50":s.curTrap.signal<50}]),key:s.curTrap.id},[x(W,{appear:"",onBeforeAppear:ee,onAfterAppear:D},{default:_(()=>[e("div",{class:p(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":s.curTrap.signal>=75,"bg-orange-400":s.curTrap.signal>=50&&s.curTrap.signal<75,"bg-red-400":s.curTrap.signal<50}])},null,2)]),_:1})],2)):$("",!0)]))),128))])])]),e("div",Ye,[e("div",Ze,[S.value==="chart"?(a(),l("div",et,[e("div",tt,[e("div",at,[st,e("span",nt,o(w.value),1)]),k.value?$("",!0):(a(),R(pe,{key:0,options:j.value,loading:k.value,"no-data":M(f),"disable-theme-refresh":!0,rebuild:F.value},null,8,["options","loading","no-data","rebuild"]))]),e("div",lt,[e("div",ot,[x(ie,{onUpdate:d[1]||(d[1]=n=>S.value=n),"cur-value":S.value},null,8,["cur-value"])]),(a(!0),l(L,null,z(M(P).sort((n,h)=>h.count-n.count),n=>(a(),l("div",it,[e("div",rt,[e("div",{class:"mr-2 h-3 w-3 rounded-sm",style:we("background: "+M(i)[n.colorIndex])},null,4),e("span",ct,o(n.type_description),1)]),e("div",null,[e("span",dt,o(n.count),1)])]))),256))])])):(a(),l("div",ut,[e("div",ft,[x(ie,{onUpdate:d[2]||(d[2]=n=>S.value=n),"cur-value":S.value},null,8,["cur-value"])]),x(he,{items:M(P),"is-compact":"","full-width":""},{header:_(()=>[gt,pt]),rows:_(({item:n})=>[e("td",null,o(n.type_description),1),e("td",null,o(n.count),1)]),_:1},8,["items"])]))]),e("div",ht,[e("div",vt,[x(Le,{values:H,onUpdate:d[3]||(d[3]=n=>b.value=n),"cur-value":b.value},null,8,["cur-value"]),x(ie,{onUpdate:d[4]||(d[4]=n=>N.value=n),"cur-value":N.value},null,8,["cur-value"])]),N.value==="chart"?(a(),l("div",mt,[e("div",_t,[k.value?$("",!0):(a(),R(pe,{key:0,options:g.value,loading:k.value,"no-data":M(I),"disable-theme-refresh":!0,rebuild:T.value},null,8,["options","loading","no-data","rebuild"]))])])):(a(),l("div",xt,[x(he,{items:K.value,"is-compact":"","full-width":""},{header:_(()=>[e("th",null,o(K.value[0].insects[0].name),1),bt]),rows:_(({item:n})=>[e("td",null,o(n.insects[0].count),1),e("td",null,o(ye(n.date,"dd/MM")),1)]),_:1},8,["items"])]))])])]))}}),wt={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},Dt=e("span",{class:"sr-only"},"Chiudi pannello",-1),Tt=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),$t=[Dt,Tt],Pt={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},kt={class:"flex w-6/12 items-center border-r pr-6"},St={class:"flex flex-grow flex-col"},Ct={class:"flex items-center gap-x-3"},Mt={class:"flex gap-x-3 text-lg leading-7"},Lt={class:"font-semibold"},zt={class:"mt-2 text-sm leading-6 text-label"},It={class:"flex w-6/12"},Bt={class:"flex w-full divide-x divide-border"},At={class:"text-sm font-medium leading-6 text-label"},Et={class:"text-3xl font-medium tracking-tight text-text"},Rt={key:0,class:"text-sm text-label"},Vt={class:"flex w-full",style:{height:"calc(100% - 130px)"}},jt={class:"flex flex-grow h-full"},Nt={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Ft={class:"flex w-full flex-col items-center justify-center pt-2 pb-4"},Ot={class:"flex items-center pb-6 pt-4"},Wt={class:"mr-5 border-ra pr-4a"},Jt={class:"text-5xl font-extralight"},Ut={class:"relative inline-flex items-center text-blue-400"},qt={class:"mt-2 mb-4 flex flex-col md:flex-row w-full rounded-lg text-sm"},Ht={class:"text-sm font-light uppercase tracking-wider"},Gt={class:"text-xl"},Qt={class:"flex w-full text-sm border-t pt-4"},Xt={class:"w-full pb-2 text-center text-xs font-light uppercase tracking-wider"},Kt={class:"w-full pb-1 text-center"},Yt={class:"w-full pl-1 text-center"},Zt={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},ea={role:"list",class:"space-y-6 py-6"},ta=e("div",{class:"w-px bg-gray-200"},null,-1),aa=[ta],sa=e("div",{class:"relative flex h-6 w-6 flex-none items-center justify-center bg-bg-100"},[e("div",{class:"h-2 w-2 rounded-full bg-gray-50 ring-1 ring-gray-200"})],-1),na={class:"flex-auto rounded-lg p-3 border"},la={class:"flex justify-between gap-x-4"},oa={class:"py-0.5 text-xs leading-5 text-gray-500"},ia={class:"font-medium text-gray-900"},ra=["datetime"],ca={class:"text-sm leading-6 text-gray-500"},da={class:"flex flex-col h-full w-60 overflow-auto thin-scrollbar border-r px-6 relative"},ua={class:"flex flex-col items-center w-full py-6"},fa=e("i",{class:"fal fa-wheat"},null,-1),ga=e("i",{class:"fal fa-map"},null,-1),pa=e("div",{class:"pb-2 mb-2 w-full"},null,-1),ha=e("i",{class:"fal fa-tractor"},null,-1),va=e("i",{class:"fal fa-notebook"},null,-1),ma=ce({__name:"plotResumePanel",props:{curParcel:{}},emits:["close"],setup(u,{emit:V}){ve();const q=De(),k=r(!0);r(null),r("Mese"),r("chart"),r(0);const f=[{id:0,comment:"Notati nugoli di insetti lungo il filare",date:"3 gg fa",dateTime:"2023-01-23T15:56"},{id:1,comment:"I nugoletti sono stati eliminati con un trattamento chimico",date:"5 gg fa",dateTime:"2023-01-23T15:56"},{id:2,comment:"Nugoli di insetti nuovamente notati",date:"7 gg fa",dateTime:"2023-01-23T15:56"},{id:3,comment:"I nugoli si fanno sempre più numerosi, urgono rinforzi",date:"13 gg fa",dateTime:"2023-01-23T15:56"},{id:4,comment:"I nugoli si stanno evolvendo in una vera e propria invasione",date:"15 gg fa",dateTime:"2023-01-23T15:56"},{id:5,comment:"Dite a tutti di stare attenti, i nugoletti sono molto pericolosi",date:"18 gg fa",dateTime:"2023-01-23T15:56"},{id:6,comment:"Non so se ce la farò, sono troppi",date:"21 gg fa",dateTime:"2023-01-23T15:56"},{id:7,comment:"I nugoletti hanno oscurato il cielo, non vedo più il sole",date:"23 gg fa",dateTime:"2023-01-23T15:56"}],I=r([]),j=r([]),g=r([]),b=r({id:"rainy",temp:"14°",icon:"fa-cloud-showers",theme:"weather-widget-rain"});function S(c){c.style.height=0}function N(c){c.style.height=`${u.curParcel.cultivatedPercentage}%`,c.style.transition="height 1s ease-out"}de(async()=>{if(u.curParcel){const c=new Date,y=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],i=["fa-cloud-showers","fa-cloud-bolt","fa-cloud-fog","fa-sun-bright","fa-sun-bright"];for(let v=1;v<=5;v++){const B=new Date(c);B.setDate(B.getDate()+v);const G=Math.floor(Math.random()*15)+10;g.value.push({day:y[B.getDay()],icon:i[v-1],temp:G+"°"})}F(),T()}k.value=!1}),U(()=>u.curParcel,async()=>{F(),T()});function F(){I.value=[{name:"Coltivato",value:u.curParcel.cultivatedPercentage.toString(),unit:"%"},{name:"Area",value:u.curParcel.area.toString(),unit:"ha"},{name:"Indice NDVI",value:(u.curParcel.ndvi_change_type==="decrease"?"-":"+")+u.curParcel.ndvi_change.toString(),unit:"da ieri"}]}function T(){const c=Math.floor(Math.random()*50),y=Math.floor(Math.random()*20),i=Math.floor(Math.random()*20),v=Math.floor(Math.random()*20)+10;j.value=[{name:"Precipitazioni",value:c+" mm"},{name:"Vento",value:y+" km/h"},{name:"Temperature",value:i+"° - "+v+"°"}]}return(c,y)=>(a(),l("div",wt,[e("button",{type:"button",onClick:y[0]||(y[0]=i=>V("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},$t),e("div",Pt,[e("div",kt,[e("div",St,[e("div",Ct,[e("h1",Mt,[e("span",Lt,o(c.curParcel.name),1)])]),e("p",zt,o(c.curParcel.cropDescription),1)])]),e("div",It,[e("div",Bt,[(a(!0),l(L,null,z(I.value,(i,v)=>(a(),l("div",{key:i.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",At,o(i.name),1),(a(),l("p",{class:"flex items-baseline gap-x-2",key:i.value},[e("span",Et,o(i.value),1),i.unit?(a(),l("span",Rt,o(i.unit),1)):$("",!0)])),i.name==="Coltivato"?(a(),l("div",{class:p(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-100":c.curParcel.cultivatedPercentage>=75,"bg-orange-100":c.curParcel.cultivatedPercentage>=50&&c.curParcel.cultivatedPercentage<75,"bg-red-100":c.curParcel.cultivatedPercentage<50}]),key:c.curParcel.parcel_id},[x(W,{appear:"",onBeforeAppear:S,onAfterAppear:N},{default:_(()=>[e("div",{class:p(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":c.curParcel.cultivatedPercentage>=75,"bg-orange-400":c.curParcel.cultivatedPercentage>=50&&c.curParcel.cultivatedPercentage<75,"bg-red-400":c.curParcel.cultivatedPercentage<50}])},null,2)]),_:1})],2)):$("",!0),x(W,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":c.curParcel.ndvi_change_type==="increase"?"translate-y-2 opacity-0":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100"},{default:_(()=>[i.name==="Indice NDVI"?(a(),l("div",{class:"absolute h-12 w-12 top-2 right-0",key:c.curParcel.parcel_id},[c.curParcel.ndvi_change_type==="increase"?(a(),R(M(_e),{key:0,class:"h-full w-full text-green-200","aria-hidden":"true"})):(a(),R(M(me),{key:1,class:"h-full w-full text-red-100","aria-hidden":"true"}))])):$("",!0)]),_:2},1032,["enter-from-class"])]))),128))])])]),e("div",Vt,[e("div",jt,[e("div",Nt,[e("div",Ft,[e("div",Ot,[e("div",Wt,[e("span",Jt,o(b.value.temp),1)]),e("div",Ut,[e("i",{class:p(["fa-solid relative z-10 text-5xl",b.value.icon]),style:{"font-size":"44px"}},null,2)])]),e("div",qt,[(a(!0),l(L,null,z(j.value,(i,v)=>(a(),l("div",{class:p(["flex flex-grow md:flex-col px-4 py-2 md:py-0 justify-between md:justify-normal items-center md:items-start",v<j.value.length-1?"border-b md:border-b-0 md:border-r":""])},[e("span",Ht,o(i.name),1),e("span",Gt,o(i.value),1)],2))),256))]),e("div",Qt,[(a(!0),l(L,null,z(g.value,(i,v)=>(a(),l("div",{class:p(["flex flex-grow flex-col px-4",v<g.value.length-1?"border-r":""])},[e("span",Xt,o(i.day),1),e("span",Kt,[e("i",{class:p(["fa-solid relative z-10 text-xl text-blue-300",i.icon])},null,2)]),e("span",Yt,o(i.temp),1)],2))),256))])])]),e("div",Zt,[e("ul",ea,[(a(),l(L,null,z(f,(i,v)=>e("li",{key:i.id,class:"relative flex gap-x-4"},[e("div",{class:p([v===f.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"])},aa,2),sa,e("div",na,[e("div",la,[e("div",oa,[e("span",ia,o(v%2===0?M(q).name:"Tu"),1),X(" "+o(v%2===0?"ha":"hai")+" scritto ",1)]),e("time",{datetime:i.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-gray-500"},o(i.date),9,ra)]),e("p",ca,o(i.comment),1)])])),64))])])]),e("div",da,[e("div",ua,[x(se,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:_(()=>[fa]),default:_(()=>[X("Modifica colture")]),_:1}),x(se,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:_(()=>[ga]),default:_(()=>[X("Vedi dettagli")]),_:1}),pa,x(se,{"is-success":"","is-outlined":"",class:"w-full mb-3"},{icon:_(()=>[ha]),default:_(()=>[X("Crea attività")]),_:1}),x(se,{"is-success":"","is-outlined":"",class:"w-full"},{icon:_(()=>[va]),default:_(()=>[X("Aggiungi nota")]),_:1})])])])]))}}),_a=[{id:-4,date:new Date(new Date().setDate(new Date().getDate()-12)),isPresent:!0},{id:-3,date:new Date(new Date().setDate(new Date().getDate()-11)),isPresent:!0},{id:-2,date:new Date(new Date().setDate(new Date().getDate()-10)),isPresent:!0},{id:-1,date:new Date(new Date().setDate(new Date().getDate()-9)),isPresent:!0},{id:0,date:new Date(new Date().setDate(new Date().getDate()-8)),isPresent:!0},{id:1,date:new Date(new Date().setDate(new Date().getDate()-7)),isPresent:!1},{id:2,date:new Date(new Date().setDate(new Date().getDate()-6)),isPresent:!1},{id:3,date:new Date(new Date().setDate(new Date().getDate()-5)),isPresent:!0},{id:4,date:new Date(new Date().setDate(new Date().getDate()-4)),isPresent:!0},{id:5,date:new Date(new Date().setDate(new Date().getDate()-3)),isPresent:!0},{id:6,date:new Date(new Date().setDate(new Date().getDate()-2)),isPresent:!1},{id:7,date:new Date(new Date().setDate(new Date().getDate()-1)),isPresent:!0},{id:8,date:new Date,isPresent:!0}];const ne=u=>(ke("data-v-0886b9e0"),u=u(),Se(),u),xa={class:"relative flex h-full w-full"},ba={class:"flex flex-col w-96 bg-green-25 rounded-l-lg overflow-auto thin-scrollbar relative"},ya={class:"flex w-full sticky top-0 pt-6 px-4 justify-between bg-green-25 z-10 pb-4"},wa={class:"flex flex-grow space-x-4 overflow-y-auto","aria-label":"Tabs"},Da=["onClick","aria-current"],Ta={class:"border-l border-green-200 ml-3 pl-3"},$a=ne(()=>e("i",{class:"fal fa-pen-to-square",style:{"margin-top":"-3px"}},null,-1)),Pa=[$a],ka={class:"flex flex-col w-full pt-4 rounded-t-2xl bg-bg-100 flex-grow"},Sa={key:0,role:"list",class:"divide-y divide-border"},Ca=["onClick"],Ma={class:"flex max justify-between px-4"},La={class:"flex"},za={class:"flex flex-col"},Ia={class:"text-sm font-semibold leading-6 text-gray-900"},Ba={class:"mt-1 flex text-sm leading-7 text-gray-500"},Aa={class:"flex items-center"},Ea={class:"hidden sm:flex sm:flex-col sm:items-end"},Ra={class:"text-sm leading-6 text-gray-900"},Va={class:"mt-1 flex items-center"},ja={class:"sr-only"},Na={key:1,role:"list",class:"divide-y divide-border"},Fa=["onClick"],Oa={class:"flex max justify-between px-4"},Wa={class:"flex"},Ja={class:"flex flex-col"},Ua={class:"text-sm font-semibold leading-6 text-gray-900"},qa={class:"mt-1 flex text-xs leading-5 text-gray-500"},Ha={class:"flex items-center"},Ga={class:"hidden sm:flex sm:flex-col sm:items-end"},Qa={class:"text-sm leading-6 text-gray-900"},Xa={class:"mt-1 text-xs leading-5 text-gray-500"},Ka={class:"mt-1 flex items-center gap-x-1.5"},Ya=ne(()=>e("p",{class:"text-xs leading-5 text-gray-500"},"Saturazione",-1)),Za={key:2,class:"flex flex-col w-full h-full"},es={class:"flex flex-col pb-3 border-b px-4"},ts=ne(()=>e("label",{for:"ndviRange",class:"form-label text-sm font-medium mb-2"},"Visibilità",-1)),as={class:""},ss=["onClick"],ns={class:"flex items-center h-full justify-between px-4"},ls={class:"flex items-center"},os={class:"text-sm font-semibold leading-6 text-gray-900"},is={key:0,class:"flex items-center"},rs={class:"flex flex-col flex-grow relative overflow-hidden"},cs=ne(()=>e("div",{class:"h-full w-full bg-green-200 absolute"},null,-1)),ds=ce({__name:"index",setup(u){const V=[{name:"Appezz.",id:"plots",icon:"fa-map"},{name:"Trappole",id:"traps",icon:"fa-mosquito"},{name:"Ndvi",id:"ndvi",icon:"fa-satellite"}],q=r(!1),k=r(ze),f=r(null),I=r(Ae),j=r(Be),g=r(null),H=r(_a),b=r(H.value[H.value.length-1]),S=r(0),N=r(0),F=r(10),T=r(V[0].id),c=r(!1),y=r(!1),i=r(!1);de(()=>{Te(()=>{q.value=!0})});function v(){c.value=!0}U(()=>T.value,()=>{y.value=!1,g.value=null,i.value=!1,f.value=null}),U(()=>g.value,()=>{g&&(y.value=!0)}),U(()=>f.value,()=>{f.value&&(i.value=!0)});function B(){y.value=!1,g.value=null}function G(){i.value=!1,f.value=null}function O(D){let w=0;return D.insects.forEach(A=>{w+=A.count}),w}function P(D){return O(D)>D.danger_treshold}function Q(D){return O(D)>D.warning_treshold}function le(D){return Math.floor(O(D)/D.danger_treshold*100)}function ee(D,w){return new re(D).format(w)}return(D,w)=>{const A=$e("bf-tooltip");return a(),l("div",xa,[e("div",ba,[e("div",ya,[e("nav",wa,[(a(),l(L,null,z(V,t=>e("button",{role:"tab",key:t.id,onClick:J=>T.value=t.id,class:p([(T.value===t.id,""),"group flex flex-col items-center space-y-1"]),"aria-current":T.value===t.id?"page":void 0},[e("span",{class:p([T.value===t.id?"border-green-600 bg-green-600 text-green-50":"border-transparent group-hover:border-green-400 text-green-500","flex flex-col items-center justify-center border-2 w-14 h-14 bg-green-400/20 transition-colors-default rounded-full"])},[e("i",{class:p(["fal",t.icon])},null,2)],2),e("span",{class:p([T.value===t.id?"text-green-700":"group-hover:text-green-700","text-sm font-medium text-gray-500 transition-colors-default"])},o(t.name),3)],10,Da)),64))]),e("div",Ta,[Z((a(),l("button",{onClick:v,class:"border-transparent hover:bg-green-400/20 rounded-md h-full text-green-500 flex text-xl px-4 items-center justify-center transition-colors-default"},Pa)),[[A,"Aggiungi/rimuovi"]])])]),e("div",ka,[x(W,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:_(()=>[T.value==="plots"?(a(),l("ul",Sa,[(a(!0),l(L,null,z(k.value,t=>(a(),l("li",{class:p(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":f.value&&f.value.parcel_id===t.parcel_id}]),onClick:J=>{y.value=!1,g.value=null,f.value=!f.value||f.value&&f.value.parcel_id!==t.parcel_id?t:null,N.value++}},[e("div",Ma,[e("div",La,[e("div",za,[e("p",Ia,o(t.name),1),e("p",Ba,o(t.cropDescription),1)])]),e("div",Aa,[e("div",Ea,[e("p",Ra,o(t.area)+" ha",1),e("div",Va,[Z((a(),l("div",{class:p([t.ndvi_change_type==="increase"?"bg-green-50 text-green-800":"bg-red-50 text-red-800","inline-flex items-baseline rounded-full px-2.5 py-0.5 text-sm font-medium md:mt-2 lg:mt-0"])},[t.ndvi_change_type==="increase"?(a(),R(M(_e),{key:0,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-green-500","aria-hidden":"true"})):(a(),R(M(me),{key:1,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-red-500","aria-hidden":"true"})),e("span",ja,o(t.ndvi_change_type==="increase"?"Aumendo":"Diminuzione")+" del ",1),X(" "+o(t.ndvi_change),1)],2)),[[A,t.ndvi_change_type==="increase"?"Aumendo indice NDVI da ieri":"Diminuzione indice NDVI da ieri"]])])])])])],10,Ca))),256))])):T.value==="traps"?(a(),l("ul",Na,[(a(!0),l(L,null,z(I.value,t=>(a(),l("li",{class:p(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":g.value&&g.value.id===t.id}]),onClick:J=>{i.value=!1,f.value=null,g.value=!g.value||g.value&&g.value.id!==t.id?t:null,S.value++}},[e("div",Oa,[e("div",Wa,[e("div",Ja,[e("p",Ua,o(t.type),1),e("p",qa,o(t.name),1)])]),e("div",Ha,[e("div",Ga,[e("p",Qa,o(O(t))+" catture ",1),e("p",Xa," Ultima cattura "+o(ee(t.last_capture,"dd/MM")),1),e("div",Ka,[Z((a(),l("div",{class:p(["flex-none rounded-full p-1",{"bg-green-500/20":!Q(t),"bg-orange-500/20":Q(t)&&!P(t),"bg-red-500/20":P(t)}])},[e("div",{class:p(["h-1.5 w-1.5 rounded-full",{"bg-green-500":!Q(t),"bg-orange-500":Q(t)&&!P(t),"bg-red-500":P(t)}])},null,2)],2)),[[A,le(t)+"%"]]),Ya])])])])],10,Fa))),256))])):(a(),l("div",Za,[e("div",es,[ts,Z(e("input",{"onUpdate:modelValue":w[0]||(w[0]=t=>F.value=t),type:"range",class:"form-range",min:"0",max:"10",step:"0.1",id:"ndviRange"},null,512),[[Pe,F.value]])]),e("ul",as,[(a(!0),l(L,null,z(H.value.sort((t,J)=>J.date.getTime()-t.date.getTime()),t=>(a(),l("li",{class:p(["relative py-4 transition-colors-default border-b",{"!bg-gray-100":b.value&&b.value.id===t.id,"hover:bg-gray-50 cursor-pointer":t.isPresent}]),onClick:J=>t.isPresent?b.value=!b.value||b.value&&b.value.id!==t.id?t:null:"",style:{height:"73px"}},[e("div",ns,[e("div",ls,[e("p",os,o(ee(t.date,"dd/MM")),1)]),t.isPresent?$("",!0):(a(),l("div",is,[Z((a(),l("div",{class:p(["flex items-center justify-center w-12 h-12 rounded-full text-xl",t.isPresent?"bg-teal-50 text-teal-400":"bg-gray-50 text-gray-400"])},[e("i",{class:p(["fal",t.isPresent?"fa-check":"fa-clouds"])},null,2)],2)),[[A,t.isPresent?"NDVI presente":"È stata scattata un'immagine satellitare in questo giorno, ma l'indice di vegetazione NDVI non può essere calcolato. Ciò può accadere a causa della copertura nuvolosa, della foschia, della neve o di altri fattori."]])]))])],10,ss))),256))])]))]),_:1})])]),e("div",rs,[cs,x(W,{"enter-active-class":"transition duration-300 ease-out delay-500","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:_(()=>[q.value?(a(),R(Ce,{key:0,"show-ndvi":!0,parcels:k.value,curParcel:f.value,traps:I.value,curTrap:g.value,equipments:[],curEquipment:null,zoomOnTrap:S.value,zoomOnPlot:N.value,zoomOnEquipment:0,onSelectTrap:w[1]||(w[1]=t=>{i.value=!1,f.value=null,g.value=!g.value||g.value&&g.value.id!==t.id?t:null}),onSelectParcel:w[2]||(w[2]=t=>{y.value=!1,g.value=null,f.value=!f.value||f.value&&f.value.parcel_id!==t.parcel_id?t:null})},null,8,["parcels","curParcel","traps","curTrap","zoomOnTrap","zoomOnPlot"])):$("",!0)]),_:1}),x(W,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:_(()=>[y.value&&g.value?(a(),R(yt,{key:0,curTrap:g.value,insectTypes:j.value,onClose:B},null,8,["curTrap","insectTypes"])):$("",!0)]),_:1}),x(W,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:_(()=>[i.value&&f.value?(a(),R(ma,{key:0,curParcel:f.value,onClose:G},null,8,["curParcel"])):$("",!0)]),_:1})])])}}}),$s=Ie(ds,[["__scopeId","data-v-0886b9e0"]]);export{$s as default};

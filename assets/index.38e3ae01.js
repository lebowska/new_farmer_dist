import{o as i,c as f,a as e,d as pe,e as we,N as Ve,g as O,v as Be,r as h,b as se,j as p,n as w,F as X,z as j,x as W,u as L,q as Y,A as E,y as T,T as q,M as Fe,C as Le,B as ae,k as Ue,l as re,W as Me,X as Qe,Y as Re}from"./index.f2b5fb0f.js";import{T as ze,B as Ye,u as Oe,d as Ne,C as He,W as Ge,V as de,e as he,f as me,h as ve,v as Xe,i as De,j as je,k as te,l as Ce,P as Ae,I as ue,p as ye,o as $e,q as xe,r as Ke,t as Je,a as be,b as Te,_ as We,s as Ze}from"./parcelData.a8f66b04.js";import{a as Pe,t as qe,g as Se,D as ge,_ as Ee,b as et}from"./Colors.6410847a.js";import{_ as fe}from"./BfButton.2530c824.js";import"./use-outside-click.9b9941f2.js";function ke(o,N){return i(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})])}function Ie(o,N){return i(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})])}const tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAA8klEQVQYlXWQsUrDUBRAz325NoFgitjBoXUp4hKh4ObU2dVPKM5+UD7BxcGlnQRHlw5ZFAQVUREtEk1raGocntUY7ZkevMPh3isHDQVg/2RY8EXU7QgVTFVahMRx/C35rZDsAy4TGGzrr6qZP2ZrIZ4DroEVFxr9vPgjes0QAMfAqge+wrQyjAH7oQJXr3A3hjSHjWW4iH6qJup2xF+C+zEcXcPxDdy+QVCDnfVKMZ3C2ROkuyrDEYwyW20HsHVqqzK/Y5nnw7zYDKzoOpDNSluXeUngPLGCit3hX7HdU1EDDxM7QtNfIALU91Qe3221XoNPcCBLMI6LQyMAAAAASUVORK5CYII=",at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABeElEQVQokW3SO2tUURTF8d+9nntnxjiJQpABUQz4wEY/gSIIYi1ptbIX7Cxt7GwEsbARBCtBOz+ApcRCUFQIQQIS8pyZZN535lqc0RHMqc5ZsNbe+392cn8xgI9PijLP2dig02FwQDHgzquQOOQE+PGiKK+fYrPPeEy1xrBOeoQPj4uy22H9K/fezkLSny+L8tpZTlYJaRQnE0JGnjNfp9Fg6QrvHhTlX+OtJS4scCxjPmOhTppSjOh2WFtjdZXhIHbw/mE0h3PzDCYcDdQDi8fZbcaq/R69Nr09DirkdfJarJh821N+2mZ3EIVfXb7vsLZOq0W3Tb8VQUHtBI0zpM/Ph2QusDdgfxTnzLMZvTSLlUKFcREDdranVK822OrzpRnNzX2yjCzQG0/xV2dhy09DEuDR6ZAsfy7KrX4MqEwhjUa0m4y6lGPuvp59R/hzeXM5JDdXinKzHwkXk6gPh9x49v8ShH8fFxdoDWkP46xzt0Ny6bC1wW8e44quL8wQiQAAAABJRU5ErkJggg==",nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABGklEQVQYlV2QMUvDUBSFv5e8hAYbjWkGkzRoEQdBcHUTcXcUdxdBpZOIINJR8EfojxCcHN106lrFyUWkYK1pk9fE4VWLvXC4cPk499wrmoEE4HpXlZYDyQpsnkvBVBkAN3uqrC1C2IDvPjxcqnIaFHNHlH4C4QJUZyDL4bMH3S7sXE2cDS8C19WQ58JSBI0E6jHcnU2cjXkfBil89fVAFeBUoOZBUofbUw2LZiC5b6nSMCAOtatpQpbBqIBhBp2X8THbLSkGKaQDGI20bFtvCDyII5C/GaJI9ywHx4SqpaUKeP8YOwKsH0thW9AbZ/VtmLWg/QxbF1L8gQCrB1I4FR3hLYWnV9g40S/6BwIs70sxzOGxDWuHkz/+AMEfTy2fWGeUAAAAAElFTkSuQmCC",st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABXklEQVQokV3Sv44SURTH8Q/MMLAgEkSCmqw2xsJiY+Nb2NlZ2Vib+Ah2PoCW1lv6BvoGFj6Aru6yYUGRsPwbZgaLC4H4S07uOffmm5zfL7f0+nYMPr/NNpCuGJ6T1Ll7zMMHTOc8ehWXHKh08sEGkoRuh2qFn/3w2Ovy9JisoL+g9XwPlwcXxDF3ujTr3Ghwr0e7FWa43+BJm6vTsBXExZrlgus59Vq4rCahoD/nZoVOlcdtvrzPNt++Un7xMS5NJlzPSNekaQCicjhnKWczzmdMM6KISp0YakeMxxzVaDWJowAlFfKcwZTRnMWSqxHLCWV49i6YHg7585fVOgB5Tl4wXzKdhcoyivUW3MHrjOUqrJvlAVile99JQq1G0jwAd/B4zO9xmPNim2C0951lZEtKuw9wqE9vsk2jEfpOJ3iPIi4uufxBOt+G87/WK36dURSMOtzqhX7wnZenIY9/RoeHctXEeSgAAAAASUVORK5CYII=",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAYAAAD+Bd/7AAAAmElEQVQImS3MMWoCUQAA0ffX75J1NZUE0gQhrZdIn1K8huAB0od0uYBX8FARBIkKZl2V1bX4qQZmYMJsGC2mTfvwSKdLXpB1uJyZfMcQF9OmHY3pl8D1lljXieH1Szt64fmJ+sShSuGvYrUie/+MYfOb4qDH4P+U5xQFGVQVP2sOR44ntnu2O2KXMBtGsJw3bVkmCW8fMcAdpnwsOXDzZHAAAAAASUVORK5CYII=",ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAYAAAAvg9c4AAADGElEQVQ4jY2Vu28cVRSHv5l7x7Mzs+ud9a6XXeJAgmUhBYeHeCRSihRINAiJAiSIxB9ARRmK0FHQICFqCkQXCkSBKKBCAoFEeIkiFBESmOBX/Fjvzu7Mzt25FGftGOKxudLojnTv+e5vzj3nN84bLU3Z+PAVY/0qeCHkQ3j1A+2Ubj40nKOgH10x1lGgPPAC8HzwfUgSeOn9k8H/In7/rrHrG+CuQZEDngDrMQQBtFr/R+cU2vnSWM+F3i6Mc0hHYDKwE8gz2VgNQSn45h1jL715vFr3hZ+MfaIJ8Qzs9mGYgOvKs5+CagSTQgKMga/eNvZYaOiBr2AhggunoN2GWg0cF0wKwx1YXYNBIgHd+wR8LLQbgHZgYuFcDM88BGEkCpUnue2tweYG3NkWeKsJn10tV+u+t6idUEOoYc6H8zF05mXRUVJOjguDLQH39mA8hiiCj18/GnxQUs/9YGySg7HwWw8++Q621qHYz2UKroJqE/wZyfnOHej95VCJLY4Lp5fg8jXtHJRUw4ckh6GBByJ4eBF+zSCb3n6uwRaQDiBzpdQqVXDPWup10B7c/l1q/AB6fVk7L/5ibGIgMfBUB7Ix/Hlb1oMA+nuwuy1wV0kKGg1ozUFYkeZIR/8p/k8f086Fb43tjaHmwaNdGAxhlEJ3HiYTCSwKqZBOG5oxLMUQKMhyyfk9PXo6gj8G8PcA2j6cfxBurctaNQLVFfhcDBfPwP0BdEPYTCGuwep6Se8//rWxP25DYwZmPbjVh+0EzsRQ09A3Mi/OSsVMLGyM4GYPsucPXdTh0Q5Ewc5Y5uUYfi4gL+BcAyoK0sndLlsZwMAIEMA9CvrFk9rpTJvCWIg0XJyHdgVWh+C7UJ924uZIgCvP3vWDUjNtB5BNJNBX0wMKuLElwIUqzM7IIYeBpUr31T49L4GRBuXKe6Dh8xVR6Cu4eflexyq3fWCpLs1gLOyNYXMsipWSr7i+fLQFlioFeOuUdrqhAIyVi+vnsnbjUrmnHgsFscTVIQxz2EhhJ4HmyyeY9EnQq13tPNKArUxULrx28j/qH3hsHP+6HLkeAAAAAElFTkSuQmCC",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAWCAYAAADNX8xBAAAB5ElEQVQ4jZ3UTWsTURTG8f+9cyevTYO1RDoqFUQt6iIYXIkSdJmNIEpBBDcuXNWtX8DPIGTRb9CF4AuCK5euxHahoNWWCFralCbTJNM7GReHtNa0zYwHBubexY/nHM6Mmps05F/ZaCOArAOdENK3jSJhqedLRDaCogu+hbUuNDrJMf15C1o7kHZgPAUFF6bz0H9ho0SQq+FrC353oReC0dLi2TEovomP6V7NKKMllW8h48CYK08ziJ9Mg8xjaRO6oVw6CmwfLhVheS1mosFLEEh7ti9no2Vm1TPw/tnoVLvQ1H2jVlvwrQ1hJOC2BS8H1y7D66dHY/rvQ2nWqE8/4WMT2hbaO7AVQCkNnhcz0aDOPzLqVwsa22AjGXgnhNJEQmjQ5vI6bPT27k6Ow8KTw9s7EAKYfmjUii87VXBhIgWVMszfOxg7FAI4fteoH75ABRcqU3DlOtRr4RBmjoIAVjbB1eBlBbtxDtp+BC8TJAI49UA+3k4oW+9lYfYqfKnvb3EkBNCrGdUMZPONhhMZuDMD/sIeFgsCKGUklaMg58LFY/B4Bm5+EEzNTY4c026dfmcjLwcXirLx698Xk7U2qNVbRhVTkHf3I4khgLcVo2xjceg+MQRQr5aHfsP/Bf2L1atl9QeqsqHj3YkKIgAAAABJRU5ErkJggg==",it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAABCElEQVQYlW2RvUoDQRRGz0yuG+KSTTZkQfEPGy20CNhELKzEws4XER/AR1IhhY1Yia2FICmsxB8ChpVEF1yc3bEYJW7YW92Bw5nv3quO2sLo1NjQg/UA+ruiKCmd94zthLAdQVSDpStjy0B1/YoFSDNIDMQp9EeQHhTNeqe5wkboIGNhfhbWgpKvj5dflGgHNGZAFCz6kPeKETTAyYKoVhWqFWfOLNQFkrMJrP+a2yGMv38j5LDVhs3mlBHgpivqLoaGB764GKt18C+cVfOvBntu0sCDinZROi2YuzS2AAKcP7pVZbkbLKpB6E0ZAfxDUffvk/fzJ7x9lYDgzhin8JTAwwcM90X9AG7EUPqOil3VAAAAAElFTkSuQmCC",ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABVElEQVQokX2SO0sDQRSFv5kd3DyMmKABQSGxEdRCxEYESSOCIFj6L/xFVmJl46O3E3yAlYgQLAyBSBINajbuspNdi2sUjXGqO3C/uefcOWpnzACwdGbjlxDKJaP452iA1UsbA9gIiqdSDwRWzm2cT8BsFvJJuHuF4HAwpF0HJtNy6UbQDiHpgD75G9I2hucArhrwFMBCTgAbQ3WvH9K1DhxVoOKJpPksTGfg3UImBfe7PyFdLhlV96WpkIGRIRhPgN+FmREoFf7YkrtllKOgFUAnFDlzozA7KhOj4+8puldUPbhuip+EI81GQ9CFxRzU9gX6AprrRt224DWElIGcK/9iY5hKw2bh1wSA/LZRDR9qHXk5LSHAszCRgqcDG/8AAN5CeGhDEIHriLygC3VffPUB3oZRNgLnM1FZV2TdtOBxzag+oOen6omU4jBcLBvlbUgoPwDYj4IfJzeDcwAAAABJRU5ErkJggg==",dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAHCAYAAAArkDztAAAAj0lEQVQImT3LIQ7CQBRF0fvLz1AMpRWsANFAAt0AEk9SyxbYAptAo9gAHl+FIehaQkARxJB0YBDT8JKrTp5sTnj3haqG2VqFdlGvA0UGywmct87/4WrBecgHsCqg3gXUVwN3C8MYphl0czjsnY+SUsV+4NmE5ziFcgQKcFuocHReBfoGEtMCQGrg8Q5d5io/VTwqesL437MAAAAASUVORK5CYII=",ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABa0lEQVQokXXQMWtTURiH8d+9ObmpJEohttg2qFhEnFwVHNXBXRDByQ/g5GcQV0eHfoZSHUV0sRQK6iAoOKhBi2mjialp09ybOByhNtYXXs45vO/zf+Akd48HDzby8conVpqcrHJ1geULIXFIJfdfGb//GR+dXuy5Ga41eH35Xyhd+8LXTQZDsjJFwZu3LK1z9nk+ngRCrRpTi4Iso1Si26Xd4uk0pyYN9RshaZyg16fVptNlNKS/xeoqg+WDlhSuN9jb43OT9lYcZDW2Wzxb4/yLfSiFtUshma0zzAlljk5TqzN1jB/fePJhwgCzN0MyP0clI6tEsFJjVPCxSfo4WlJ/1WydNI1LkJQIU2xu8PLdhAEat+O/7+ySDxkXMWBc0GoxWsnHBwA4czqeef4nsUypHAOa3ycMsHgnJNttdrsUOflgf9b7dQgAt5ZCstNh2Cc7Ei3zCzy88h8AZhYJlXivVrl4LySPzoXkN4PofZ5v1q44AAAAAElFTkSuQmCC",ft="/new_farmer_dist/assets/trap_green_default.4e22ed9b.svg",gt="/new_farmer_dist/assets/trap_green_selected.50db3ff5.svg",pt="/new_farmer_dist/assets/trap_green_hover.94fb773d.svg",ht="/new_farmer_dist/assets/trap_red_default.8a46b256.svg",mt="/new_farmer_dist/assets/trap_red_selected.87af6be1.svg",vt="/new_farmer_dist/assets/trap_red_hover.33543daa.svg",At="/new_farmer_dist/assets/trap_orange_default.fbd0de4d.svg",yt="/new_farmer_dist/assets/trap_orange_selected.15335778.svg",xt="/new_farmer_dist/assets/trap_orange_hover.ecdc61c5.svg",bt="Aerial",wt="Ak2gN0iZ3d02J-xwYSYgRp8oHFZCOneWeg_Hj7C2ZntIKTXCGc0HXVQ8GHkuxp17",_t=pe({__name:"EntitiesMapViewer",props:{parcels:{},curParcel:{},traps:{},curTrap:{},zoomOnTrap:{},zoomOnPlot:{}},emits:["select-trap","select-parcel"],setup(o,{emit:N}){const J=new ze({visible:!0,preload:1/0,source:new Ye({key:wt,imagerySet:bt})}),A=[{parcelId:12,image:tt,coordX:.4,coordY:.5,scale:14},{parcelId:10,image:at,coordX:.5,coordY:.5,scale:14},{parcelId:2,image:nt,coordX:.53,coordY:.48,scale:14},{parcelId:3,image:st,coordX:.55,coordY:.51,scale:14},{parcelId:11,image:rt,coordX:.55,coordY:.51,scale:14},{parcelId:9,image:ot,coordX:.74,coordY:.51,scale:14},{parcelId:8,image:lt,coordX:.47,coordY:.48,scale:14},{parcelId:6,image:it,coordX:.47,coordY:.48,scale:14},{parcelId:7,image:ct,coordX:.46,coordY:.52,scale:14},{parcelId:13,image:dt,coordX:.51,coordY:.53,scale:13},{parcelId:1,image:ut,coordX:.51,coordY:.53,scale:14}],V=Oe(),{map:y,mapRef:v,padding:M}=Ne();let B=null,D=null;const C=new He;let Q=null;const P=new Ge;we(async()=>{v.value&&(y.setTarget(v.value),v.value.addEventListener("mouseleave",g),await new Promise(s=>setTimeout(s,500))),U(),y.getLayers().clear(),await $(),Z(),H(),ne()});async function $(){y.addLayer(J)}Ve(()=>{U()});function g(){V.emit("hover:map",[])}function S(s){if(s.type==="pointermove"){const a=y.getFeaturesAtPixel(s.pixel);if(a&&a.length>=1){const r=a[0]?.values_?.features[0]?.values_?.type;if(r&&r==="trap"){const u=a[0].get("features");if(Array.isArray(u)&&u.length>0){const l=u.map(t=>t.get("ref"));V.emit("hover:map",l)}else V.emit("hover:map",[a[0].get("ref")]);y.getTargetElement().style.cursor="pointer"}}else V.emit("hover:map",[]),y.getTargetElement().style.cursor="default";return!0}return!1}function m(s){const a=y.getAllLayers().find(r=>r.get("name")==="trapInteractionLayer");if(a){const r=a.getSource();if(r){const u=r.getFeatures();for(const l of u){const t=l.get("features");if(Array.isArray(t)){for(const d of t)if(d.getProperties().ref===s)return l}else if(l.getProperties().ref===s)return l}}}return null}function x(s){const a=y.getAllLayers().find(r=>r.get("name")==="parcelInteractionLayer");if(a){const r=a.getSource();if(r){const u=r.getFeatures();for(const l of u){const t=l.get("features");if(Array.isArray(t)){for(const d of t)if(d.getProperties().ref===s)return l}else if(l.getProperties().ref===s)return l}}}return null}function k(s){const a=Je();return s.forEach(r=>{const u=r.getGeometry();u&&Ke(a,u.getExtent())}),a}function U(){y.getLayers().getArray().filter(a=>a instanceof de).forEach(a=>{y.removeLayer(a)}),C.getLength()&&C.clear(),B&&(y.removeInteraction(B),B.dispose(),B=null),D&&(y.removeInteraction(D),D.dispose(),D=null)}function Z(){const s=[];o.parcels.forEach(l=>{const t=P.readFeature(l.world_geom);t.setProperties({ref:"parcel_"+l.parcel_id,type:"parcel",parcel_id:l.parcel_id}),C.push(t),s.push(t)}),Q=new he({features:s});const a=new me({distance:0,source:Q,geometryFunction:ee}),r=new de({source:a,style:I,properties:{name:"parcelInteractionLayer",ref:ve.VECTOR,id:"parcel"},renderBuffer:500});y.addLayer(r),r.setZIndex(900);const u=k(C.getArray());le(u)}O(()=>o.curParcel,()=>{if(C.getArray().filter(a=>a.getProperties().type==="parcel").forEach(a=>{a.setStyle(I)}),o.curParcel){const a=o.parcels.find(r=>r.parcel_id===o.curParcel.parcel_id);if(a){const r=x("parcel_"+a.parcel_id);r&&r.setStyle(F)}}}),O(()=>o.zoomOnPlot,()=>{if(o.curParcel){const s=o.parcels.find(a=>a.parcel_id===o.curParcel.parcel_id);if(s){const a=x("parcel_"+s.parcel_id);if(a){const r=k([a]),u=xe(r),l=[u[0],u[1]-100];y.getView().animate({center:l,duration:500})}}}});function H(){const s=[];o.parcels.forEach(l=>{if(A.find(t=>t.parcelId===l.parcel_id)){const t=P.readFeature(l.world_geom);t.setProperties({ref:"ndvi_"+l.parcel_id,type:"ndvi",parcel_id:l.parcel_id}),C.push(t),s.push(t)}});const a=new he({features:s}),r=new me({distance:0,source:a,geometryFunction:ee}),u=new de({source:r,style:oe,properties:{name:"ndviLayer",ref:ve.VECTOR,id:"ndvi"},renderBuffer:500});u.on("prerender",l=>{const t=l.context;t.imageSmoothingEnabled=!1;const d=t;d.webkitImageSmoothingEnabled=!1,d.mozImageSmoothingEnabled=!1,d.msImageSmoothingEnabled=!1}),y.addLayer(u),u.setZIndex(700)}function ne(){const s=[];o.traps.forEach(l=>{const t=P.readFeature(ie(Xe([l.coordinates.lon,l.coordinates.lat])));t.setProperties({ref:"trap_"+l.id,type:"trap",trap_id:l.id}),C.push(t),s.push(t)});const a=new he({features:s}),r=new me({distance:0,source:a,geometryFunction:ee}),u=new de({source:r,style:R,properties:{name:"trapInteractionLayer",ref:ve.VECTOR,id:"trap"},renderBuffer:500});B=new De({style:z,condition(l){return je(l)},layers:function(l){return l.get("name")==="trapInteractionLayer"}}),y.addInteraction(B),B.on("select",l=>{const t=l.target.getFeatures().getArray()[0].getProperties().features;if(t.length>1){const d=k(t);le(d)}else{const d=t[0].get("trap_id"),c=o.traps.find(b=>b.id===d);N("select-trap",c)}}),D=new De({style:n,condition:S,layers:function(l){return l.get("name")==="trapInteractionLayer"}}),y.addInteraction(D),y.addLayer(u),u.setZIndex(910)}O(()=>o.curTrap,()=>{if(C.getArray().filter(a=>a.getProperties().type==="trap").forEach(a=>{a.setStyle(R)}),o.curTrap){const a=o.traps.find(r=>r.id===o.curTrap.id);if(a){const r=m("trap_"+a.id);r&&r.setStyle(z)}}}),O(()=>o.zoomOnTrap,()=>{if(o.curTrap){const s=o.traps.find(a=>a.id===o.curTrap.id);if(s){const a=m("trap_"+s.id);if(a){const r=k([a]);y.getView().animate({center:xe(r),duration:500})}}}});const I=s=>{if(s.get("features")!==void 0){const u=s.get("features")[0].getGeometry().getCoordinates();return new te({stroke:new Ce({color:Pe("lime-200",1),width:2}),geometry:new Ae(u)})}},F=s=>{if(s.get("features")!==void 0){const u=s.get("features")[0].getGeometry().getCoordinates();return new te({stroke:new Ce({color:Pe("lime-50",1),width:4}),geometry:new Ae(u)})}},R=s=>{const a=s.get("features");if(a!==void 0){const r=o.traps.find(t=>t.id===a[0].values_.trap_id);let u=0;r.insects.forEach(t=>{u+=t.count});let l=ft;return u>r.danger_treshold?l=ht:u>r.warning_treshold&&(l=At),new te({image:new ue({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:l})})}},n=s=>{const a=s.get("features");if(a!==void 0){const r=o.traps.find(u=>u.id===a[0].values_.trap_id);if(r){let u=0;r.insects.forEach(t=>{u+=t.count});let l=pt;return u>r.danger_treshold?l=vt:u>r.warning_treshold&&(l=xt),new te({image:new ue({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:l})})}}},z=s=>{const a=s.get("features");if(a!==void 0){const r=o.traps.find(t=>t.id===a[0].values_.trap_id);let u=0;r.insects.forEach(t=>{u+=t.count});let l=gt;return u>r.danger_treshold?l=mt:u>r.warning_treshold&&(l=yt),new te({image:new ue({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:l})})}},oe=s=>{const a=s.get("features");if(a!==void 0){const u=s.get("features")[0].getGeometry().getCoordinates(),t=new Ae(u).getInteriorPoint().getCoordinates(),d=A.find(c=>c.parcelId===a[0].values_.parcel_id);if(d)return new te({image:new ue({scale:d.scale,anchor:[d.coordX,d.coordY],anchorXUnits:"fraction",anchorYUnits:"fraction",src:d.image}),geometry:new ye(t)})}};function le(s){y.getView().fit(s,{padding:[50,50,50,50],easing:$e,duration:1e3})}function ee(s){const a=s.getGeometry();return a?new ye(xe(a.getExtent())):new ye([0])}function ie(s){return"POINT("+s[0]+" "+s[1]+")"}return(s,a)=>(i(),f("div",{ref_key:"mapRef",ref:v,class:"relative h-full w-full"},null,512))}}),Dt=[{id:0,name:"Rodilegno"},{id:1,name:"Lobesia botrana"},{id:2,name:"Tortricidae"},{id:3,name:"Coleottero"},{id:4,name:"Popillia Japonica"},{id:5,name:"Processionaria"},{id:6,name:"Cerambycidae"}],Ct=[{id:"1",name:"S03925",type:"Cymatrap garden",last_capture:new Date("2023-03-28"),warning_treshold:30,danger_treshold:50,insects:[{count:5,id:"0",name:"Rodilegno"},{count:18,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.560286922994884,lon:10.721558966213962},battery:67,signal:100},{id:"2",name:"S05321",type:"Cymatrap garden",last_capture:new Date("2023-03-10"),warning_treshold:30,danger_treshold:70,insects:[{count:2,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.561788608518086,lon:10.719467188742241},battery:89,signal:70},{id:"3",name:"S08513",type:"Cymatrap pro",last_capture:new Date("2023-02-07"),warning_treshold:200,danger_treshold:300,insects:[{count:12,id:"0",name:"Rodilegno"},{count:1,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56160296275679,lon:10.720474777327212},battery:56,signal:50},{id:"4",name:"S00593",type:"Isagro dispenser",last_capture:new Date("2023-04-30"),warning_treshold:10,danger_treshold:20,insects:[{count:32,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559936248891546,lon:10.720922594476088},battery:34,signal:100},{id:"5",name:"S03858",type:"Isagro dispenser",last_capture:new Date("2023-03-14"),warning_treshold:80,danger_treshold:200,insects:[{count:41,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55896672672015,lon:10.721040441094033},battery:16,signal:80},{id:"6",name:"S05952",type:"Isagro dispenser",last_capture:new Date("2023-03-10"),warning_treshold:120,danger_treshold:200,insects:[{count:32,id:"0",name:"Rodilegno"},{count:15,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55821997698153,lon:10.721606104861031},battery:89,signal:30},{id:"7",name:"S08332",type:"Linea bacterocera",last_capture:new Date("2023-03-22"),warning_treshold:50,danger_treshold:100,insects:[{count:4,id:"0",name:"Rodilegno"},{count:7,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56011777455661,lon:10.722436923510717},battery:78,signal:20},{id:"8",name:"S09876",type:"Isagro carpo +",last_capture:new Date("2023-03-24"),warning_treshold:30,danger_treshold:70,insects:[{count:0,id:"0",name:"Rodilegno"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55862017006319,lon:10.72403963751722},battery:55,signal:0},{id:"9",name:"S02273",type:"Isagro carpo +",last_capture:new Date("2023-03-26"),warning_treshold:10,danger_treshold:20,insects:[{count:51,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559086370782154,lon:10.721712166809247},battery:54,signal:80},{id:"10",name:"S01423",type:"Isagro double wing",last_capture:new Date("2023-03-07"),warning_treshold:10,danger_treshold:20,insects:[{count:54,id:"0",name:"Rodilegno"},{count:34,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559346286317734,lon:10.722271938245344},battery:79,signal:100}],Tt={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},Pt=e("span",{class:"sr-only"},"Chiudi pannello",-1),St=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Et=[Pt,St],Bt={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},kt={class:"flex w-6/12 items-center border-r pr-6"},It={class:"flex flex-grow flex-col"},Vt={class:"flex items-center gap-x-3"},Ft={class:"flex gap-x-3 text-lg leading-7"},Lt={class:"font-semibold"},Ut={class:"mt-2 text-sm leading-6 text-label"},Mt={class:"flex w-6/12"},Qt={class:"flex w-full divide-x divide-border"},Rt={class:"text-sm font-medium leading-6 text-label"},zt={class:"text-3xl font-medium tracking-tight text-text"},Yt={key:0,class:"text-sm text-label"},Ot={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Nt={class:"flex h-full w-6/12"},Ht={key:0,class:"flex h-full w-full"},Gt={class:"relative flex h-full w-full pb-4 pl-3 pr-3 pt-4"},Xt={class:"absolute z-10 flex h-16 w-12 flex-col items-center justify-center",style:{left:"calc(50% - 1.5rem)",top:"calc(50% - 2rem)"}},jt=e("span",{class:"text-sm font-medium text-label"},"Totali",-1),$t={class:"text-3xl font-medium tracking-tight text-text"},Kt={class:"thin-scrollbar relative flex h-full w-full flex-col space-y-3 overflow-auto pb-4 pl-8 pr-6"},Jt={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3"},Wt={class:"flex w-full flex-col"},Zt={class:"flex w-full items-center"},qt={class:"text-sm font-medium text-label"},ea={class:"text-3xl font-medium tracking-tight text-text"},ta={key:1,class:"thin-scrollbar h-full w-full overflow-auto px-6 pb-6"},aa={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 py-3"},na=e("th",null,"Insetto",-1),sa=e("th",null,"Conteggio",-1),ra={class:"flex flex-col h-full w-6/12 px-6 border-l overflow-auto thin-scrollbar"},oa={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3 space-x-2"},la={key:0,class:"flex h-full w-full"},ia={class:"relative flex h-full w-full pb-4 pt-4"},ca={key:1,class:"w-full pb-6"},da=e("th",null,"Giorno",-1),ua=pe({__name:"trapResumePanel",props:{insectTypes:{},curTrap:{}},emits:["close"],setup(o,{emit:N}){const J=Be(),A=h(!0);let V=!1,y=!1;const v=h(null),M=h(null),B=["Anno","Mese","Settimana"],D=h("Settimana"),C=h("chart"),Q=h("chart"),P=h(0),$=h(0);let g=h([]);const S=h([]),m=qe.color;let x=[],k=[],U=[],Z=[],H=[];function ne(t){t.style.height=0}function I(t){t.style.height=`${o.curTrap.battery}%`,t.style.transition="height 1s ease-out"}function F(t){t.style.height=0}function R(t){t.style.height=`${o.curTrap.signal}%`,t.style.transition="height 1s ease-out"}const n=se(()=>{let t=0;return o.curTrap.insects.forEach(d=>{t+=d.count}),t}),z=se(()=>n.value>o.curTrap.danger_treshold),oe=se(()=>n.value>o.curTrap.warning_treshold),le=se(()=>Math.floor(n.value/o.curTrap.danger_treshold*100));we(async()=>{o.curTrap?(ie(),ee(),s(),r()):(V=!0,y=!0),A.value=!1}),O(()=>J.darkMode,async()=>{s(!0),r(!0)}),O(()=>o.curTrap,async()=>{ie(),ee(),s(),r()});function ee(){g.value=[];const t=new Date,d=365;t.setDate(new Date().getDate()-d);for(let c=0;c<d;c++){const b=new Date(t);b.setDate(b.getDate()+c);const _=[];o.curTrap.insects.forEach(K=>{_.push({id:K.id,name:K.name,count:Math.floor(Math.random()*25)+1})});const G={insects:_,date:b};g.value.push(G)}}function ie(){const t=Math.floor(Math.random()*25)+1;S.value=[{name:"Batteria",value:o.curTrap.battery.toString(),unit:"%"},{name:"Segnale",value:o.curTrap.signal.toString(),unit:"%"},{name:"Ultima cattura",value:t.toString(),unit:"gg fa"}]}function s(t=!1){if(o.curTrap.insects.length===0){V=!0;return}const d=o.curTrap.insects,c=Se("color-bg-100");U=[],x=[],H=[];const b={id:"insects",name:"Insetti",radius:["82%","90%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:c,borderWidth:4},label:{show:!1,position:"center"},emphasis:{label:{show:!1,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},type:"pie",data:[]};d.forEach(_=>{H.findIndex(G=>G.type_id===_.id)===-1&&H.push({type_id:_.id,type_description:_.name,colorIndex:0,count:0})}),H.forEach((_,G)=>{let K=0;d.forEach(ce=>{ce.id===_.type_id&&(K=K+ce.count)}),_.count=K,_.colorIndex=G,U.push(_.type_description),b.data.push({value:_.count,name:_.type_description})}),x.push(b),u(),t&&P.value++}O(()=>D.value,async()=>{r()});const a=se(()=>{if(g.value.length===0)return[];const t=[];let d=new Date;g.value.length>0&&(d=new Date(g.value[g.value.length-1].date));let c=0;return D.value==="Anno"?c=365:D.value==="Mese"?c=30:D.value==="Settimana"&&(c=7),d.setDate(new Date().getDate()-c),d.setHours(0,0,0,0),g.value.forEach(b=>{const _=new Date(b.date);_.setHours(0,0,0,0),_.getTime()>d.getTime()&&t.push(b)}),t});function r(t=!1){if(a.value.length===0){y=!0;return}Se("color-bg-100"),Z=[],k=[];const d=[],c=[];a.value[0].insects.forEach(b=>{d.findIndex(_=>_.id===b.id)===-1&&d.push({id:b.id,name:b.name})}),d.forEach((b,_)=>{const G={id:"line_"+b.id,name:b.name,smooth:!0,lineStyle:{width:2},symbolSize:6,type:"line",data:[]};c.push(G)}),a.value.forEach(b=>{const _=new Date(b.date);Z.push(new ge(_).format("dd/MM")),b.insects.forEach(G=>{const K=c.findIndex(ce=>ce.id==="line_"+G.id);K!==-1&&c[K].data.push(G.count)})}),k.push(...c),l(),t&&$.value++}function u(){v.value={grid:{top:12,right:24,left:24,bottom:20,containLabel:!0},tooltip:{trigger:"none"},legend:{show:!1,selectedMode:!1},series:x,textStyle:{fontFamily:"Work Sans"}}}function l(){M.value={grid:{top:12,right:0,left:0,bottom:0,containLabel:!0},tooltip:{trigger:"axis"},legend:{show:!1},xAxis:{type:"category",data:Z},yAxis:[{type:"value",name:"",position:"left"}],series:k,textStyle:{fontFamily:"Work Sans"}}}return(t,d)=>(i(),f("div",Tt,[e("button",{type:"button",onClick:d[0]||(d[0]=c=>N("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},Et),e("div",Bt,[e("div",kt,[e("div",It,[e("div",Vt,[e("h1",Ft,[e("span",Lt,p(t.curTrap.type),1)])]),e("p",Ut,p(t.curTrap.name),1)]),e("div",{class:w(["order-first flex-none rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset sm:order-none",{"bg-green-500/20 text-green-700 ring-green-400/30":!oe.value,"bg-orange-500/20 text-orange-700 ring-orange-400/30":oe.value&&!z.value,"bg-red-500/20 text-red-700 ring-red-400/30":z.value}])}," Saturazione al "+p(le.value)+"% ",3)]),e("div",Mt,[e("div",Qt,[(i(!0),f(X,null,j(S.value,(c,b)=>(i(),f("div",{key:c.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Rt,p(c.name),1),(i(),f("p",{class:"flex items-baseline gap-x-2",key:c.value},[e("span",zt,p(c.value),1),c.unit?(i(),f("span",Yt,p(c.unit),1)):Y("",!0)])),c.name==="Batteria"?(i(),f("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":t.curTrap.battery>=75,"bg-orange-50":t.curTrap.battery>=50&&t.curTrap.battery<75,"bg-red-50":t.curTrap.battery<50}]),key:t.curTrap.id},[E(q,{appear:"",onBeforeAppear:ne,onAfterAppear:I},{default:T(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":t.curTrap.battery>=75,"bg-orange-400":t.curTrap.battery>=50&&t.curTrap.battery<75,"bg-red-400":t.curTrap.battery<50}])},null,2)]),_:1})],2)):Y("",!0),c.name==="Segnale"?(i(),f("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":t.curTrap.signal>=75,"bg-orange-50":t.curTrap.signal>=50&&t.curTrap.signal<75,"bg-red-50":t.curTrap.signal<50}]),key:t.curTrap.id},[E(q,{appear:"",onBeforeAppear:F,onAfterAppear:R},{default:T(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":t.curTrap.signal>=75,"bg-orange-400":t.curTrap.signal>=50&&t.curTrap.signal<75,"bg-red-400":t.curTrap.signal<50}])},null,2)]),_:1})],2)):Y("",!0)]))),128))])])]),e("div",Ot,[e("div",Nt,[C.value==="chart"?(i(),f("div",Ht,[e("div",Gt,[e("div",Xt,[jt,e("span",$t,p(n.value),1)]),A.value?Y("",!0):(i(),W(Ee,{key:0,options:v.value,loading:A.value,"no-data":L(V),"disable-theme-refresh":!0,rebuild:P.value},null,8,["options","loading","no-data","rebuild"]))]),e("div",Kt,[e("div",Jt,[E(be,{onUpdate:d[1]||(d[1]=c=>C.value=c),"cur-value":C.value},null,8,["cur-value"])]),(i(!0),f(X,null,j(L(H).sort((c,b)=>b.count-c.count),c=>(i(),f("div",Wt,[e("div",Zt,[e("div",{class:"mr-2 h-3 w-3 rounded-sm",style:Fe("background: "+L(m)[c.colorIndex])},null,4),e("span",qt,p(c.type_description),1)]),e("div",null,[e("span",ea,p(c.count),1)])]))),256))])])):(i(),f("div",ta,[e("div",aa,[E(be,{onUpdate:d[2]||(d[2]=c=>C.value=c),"cur-value":C.value},null,8,["cur-value"])]),E(Te,{items:L(H),"is-compact":"","full-width":""},{header:T(()=>[na,sa]),rows:T(({item:c})=>[e("td",null,p(c.type_description),1),e("td",null,p(c.count),1)]),_:1},8,["items"])]))]),e("div",ra,[e("div",oa,[E(We,{values:B,onUpdate:d[3]||(d[3]=c=>D.value=c),"cur-value":D.value},null,8,["cur-value"]),E(be,{onUpdate:d[4]||(d[4]=c=>Q.value=c),"cur-value":Q.value},null,8,["cur-value"])]),Q.value==="chart"?(i(),f("div",la,[e("div",ia,[A.value?Y("",!0):(i(),W(Ee,{key:0,options:M.value,loading:A.value,"no-data":L(y),"disable-theme-refresh":!0,rebuild:$.value},null,8,["options","loading","no-data","rebuild"]))])])):(i(),f("div",ca,[E(Te,{items:a.value,"is-compact":"","full-width":""},{header:T(()=>[e("th",null,p(a.value[0].insects[0].name),1),da]),rows:T(({item:c})=>[e("td",null,p(c.insects[0].count),1),e("td",null,p(new L(ge)(c.date).format("dd/MM")),1)]),_:1},8,["items"])]))])])]))}}),fa={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},ga=e("span",{class:"sr-only"},"Chiudi pannello",-1),pa=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ha=[ga,pa],ma={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},va={class:"flex w-6/12 items-center border-r pr-6"},Aa={class:"flex flex-grow flex-col"},ya={class:"flex items-center gap-x-3"},xa={class:"flex gap-x-3 text-lg leading-7"},ba={class:"font-semibold"},wa={class:"mt-2 text-sm leading-6 text-label"},_a={class:"flex w-6/12"},Da={class:"flex w-full divide-x divide-border"},Ca={class:"text-sm font-medium leading-6 text-label"},Ta={class:"text-3xl font-medium tracking-tight text-text"},Pa={key:0,class:"text-sm text-label"},Sa={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Ea={class:"flex flex-grow h-full"},Ba={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},ka={class:"flex w-full flex-col items-center justify-center pt-2 pb-4"},Ia={class:"flex items-center pb-6 pt-4"},Va={class:"mr-5 border-ra pr-4a"},Fa={class:"text-5xl font-extralight"},La={class:"relative inline-flex items-center text-blue-400"},Ua={class:"mt-2 mb-4 flex flex-col md:flex-row w-full rounded-lg text-sm"},Ma={class:"text-sm font-light uppercase tracking-wider"},Qa={class:"text-xl"},Ra={class:"flex w-full text-sm border-t pt-4"},za={class:"w-full pb-2 text-center text-xs font-light uppercase tracking-wider"},Ya={class:"w-full pb-1 text-center"},Oa={class:"w-full pl-1 text-center"},Na={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Ha={role:"list",class:"space-y-6 py-6"},Ga=e("div",{class:"w-px bg-gray-200"},null,-1),Xa=[Ga],ja=e("div",{class:"relative flex h-6 w-6 flex-none items-center justify-center bg-bg-100"},[e("div",{class:"h-2 w-2 rounded-full bg-gray-50 ring-1 ring-gray-200"})],-1),$a={class:"flex-auto rounded-lg p-3 border"},Ka={class:"flex justify-between gap-x-4"},Ja={class:"py-0.5 text-xs leading-5 text-gray-500"},Wa={class:"font-medium text-gray-900"},Za=["datetime"],qa={class:"text-sm leading-6 text-gray-500"},en={class:"flex flex-col h-full w-60 overflow-auto thin-scrollbar border-r px-6 relative"},tn={class:"flex flex-col items-center w-full py-6"},an=e("i",{class:"fal fa-wheat"},null,-1),nn=e("i",{class:"fal fa-map"},null,-1),sn=e("div",{class:"pb-2 mb-2 w-full"},null,-1),rn=e("i",{class:"fal fa-tractor"},null,-1),on=e("i",{class:"fal fa-notebook"},null,-1),ln=pe({__name:"plotResumePanel",props:{curParcel:{}},emits:["close"],setup(o,{emit:N}){Be();const J=Le(),A=h(!0);h(null),h("Mese"),h("chart"),h(0);const V=[{id:0,comment:"Notati nugoli di insetti lungo il filare",date:"3 gg fa",dateTime:"2023-01-23T15:56"},{id:1,comment:"I nugoletti sono stati eliminati con un trattamento chimico",date:"5 gg fa",dateTime:"2023-01-23T15:56"},{id:2,comment:"Nugoli di insetti nuovamente notati",date:"7 gg fa",dateTime:"2023-01-23T15:56"},{id:3,comment:"I nugoli si fanno sempre pi\xF9 numerosi, urgono rinforzi",date:"13 gg fa",dateTime:"2023-01-23T15:56"},{id:4,comment:"I nugoli si stanno evolvendo in una vera e propria invasione",date:"15 gg fa",dateTime:"2023-01-23T15:56"},{id:5,comment:"Dite a tutti di stare attenti, i nugoletti sono molto pericolosi",date:"18 gg fa",dateTime:"2023-01-23T15:56"},{id:6,comment:"Non so se ce la far\xF2, sono troppi",date:"21 gg fa",dateTime:"2023-01-23T15:56"},{id:7,comment:"I nugoletti hanno oscurato il cielo, non vedo pi\xF9 il sole",date:"23 gg fa",dateTime:"2023-01-23T15:56"}],y=h([]),v=h([]),M=h([]),D=h({id:"rainy",temp:"14\xB0",icon:"fa-cloud-showers",theme:"weather-widget-rain"});function C(g){g.style.height=0}function Q(g){g.style.height=`${o.curParcel.cultivatedPercentage}%`,g.style.transition="height 1s ease-out"}we(async()=>{if(o.curParcel){const g=new Date,S=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],m=["fa-cloud-showers","fa-cloud-bolt","fa-cloud-fog","fa-sun-bright","fa-sun-bright"];for(let x=1;x<=5;x++){const k=new Date(g);k.setDate(k.getDate()+x);const U=Math.floor(Math.random()*15)+10;M.value.push({day:S[k.getDay()],icon:m[x-1],temp:U+"\xB0"})}P(),$()}A.value=!1}),O(()=>o.curParcel,async()=>{P(),$()});function P(){y.value=[{name:"Coltivato",value:o.curParcel.cultivatedPercentage.toString(),unit:"%"},{name:"Area",value:o.curParcel.area.toString(),unit:"ha"},{name:"Indice NDVI",value:(o.curParcel.ndvi_change_type==="decrease"?"-":"+")+o.curParcel.ndvi_change.toString(),unit:"da ieri"}]}function $(){const g=Math.floor(Math.random()*50),S=Math.floor(Math.random()*20),m=Math.floor(Math.random()*20),x=Math.floor(Math.random()*20)+10;v.value=[{name:"Precipitazioni",value:g+" mm"},{name:"Vento",value:S+" km/h"},{name:"Temperature",value:m+"\xB0 - "+x+"\xB0"}]}return(g,S)=>(i(),f("div",fa,[e("button",{type:"button",onClick:S[0]||(S[0]=m=>N("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},ha),e("div",ma,[e("div",va,[e("div",Aa,[e("div",ya,[e("h1",xa,[e("span",ba,p(g.curParcel.name),1)])]),e("p",wa,p(g.curParcel.cropDescription),1)])]),e("div",_a,[e("div",Da,[(i(!0),f(X,null,j(y.value,(m,x)=>(i(),f("div",{key:m.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Ca,p(m.name),1),(i(),f("p",{class:"flex items-baseline gap-x-2",key:m.value},[e("span",Ta,p(m.value),1),m.unit?(i(),f("span",Pa,p(m.unit),1)):Y("",!0)])),m.name==="Coltivato"?(i(),f("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-100":g.curParcel.cultivatedPercentage>=75,"bg-orange-100":g.curParcel.cultivatedPercentage>=50&&g.curParcel.cultivatedPercentage<75,"bg-red-100":g.curParcel.cultivatedPercentage<50}]),key:g.curParcel.parcel_id},[E(q,{appear:"",onBeforeAppear:C,onAfterAppear:Q},{default:T(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":g.curParcel.cultivatedPercentage>=75,"bg-orange-400":g.curParcel.cultivatedPercentage>=50&&g.curParcel.cultivatedPercentage<75,"bg-red-400":g.curParcel.cultivatedPercentage<50}])},null,2)]),_:1})],2)):Y("",!0),E(q,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":g.curParcel.ndvi_change_type==="increase"?"translate-y-2 opacity-0":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100"},{default:T(()=>[m.name==="Indice NDVI"?(i(),f("div",{class:"absolute h-12 w-12 top-2 right-0",key:g.curParcel.parcel_id},[g.curParcel.ndvi_change_type==="increase"?(i(),W(L(Ie),{key:0,class:"h-full w-full text-green-200","aria-hidden":"true"})):(i(),W(L(ke),{key:1,class:"h-full w-full text-red-100","aria-hidden":"true"}))])):Y("",!0)]),_:2},1032,["enter-from-class"])]))),128))])])]),e("div",Sa,[e("div",Ea,[e("div",Ba,[e("div",ka,[e("div",Ia,[e("div",Va,[e("span",Fa,p(D.value.temp),1)]),e("div",La,[e("i",{class:w(["fa-solid relative z-10 text-5xl",D.value.icon]),style:{"font-size":"44px"}},null,2)])]),e("div",Ua,[(i(!0),f(X,null,j(v.value,(m,x)=>(i(),f("div",{class:w(["flex flex-grow md:flex-col px-4 py-2 md:py-0 justify-between md:justify-normal items-center md:items-start",x<v.value.length-1?"border-b md:border-b-0 md:border-r":""])},[e("span",Ma,p(m.name),1),e("span",Qa,p(m.value),1)],2))),256))]),e("div",Ra,[(i(!0),f(X,null,j(M.value,(m,x)=>(i(),f("div",{class:w(["flex flex-grow flex-col px-4",x<M.value.length-1?"border-r":""])},[e("span",za,p(m.day),1),e("span",Ya,[e("i",{class:w(["fa-solid relative z-10 text-xl text-blue-300",m.icon])},null,2)]),e("span",Oa,p(m.temp),1)],2))),256))])])]),e("div",Na,[e("ul",Ha,[(i(),f(X,null,j(V,(m,x)=>e("li",{key:m.id,class:"relative flex gap-x-4"},[e("div",{class:w([x===V.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"])},Xa,2),ja,e("div",$a,[e("div",Ka,[e("div",Ja,[e("span",Wa,p(x%2===0?L(J).name:"Tu"),1),ae(" "+p(x%2===0?"ha":"hai")+" scritto ",1)]),e("time",{datetime:m.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-gray-500"},p(m.date),9,Za)]),e("p",qa,p(m.comment),1)])])),64))])])]),e("div",en,[e("div",tn,[E(fe,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:T(()=>[an]),default:T(()=>[ae("Modifica colture")]),_:1}),E(fe,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:T(()=>[nn]),default:T(()=>[ae("Vedi dettagli")]),_:1}),sn,E(fe,{"is-success":"","is-outlined":"",class:"w-full mb-3"},{icon:T(()=>[rn]),default:T(()=>[ae("Crea attivit\xE0")]),_:1}),E(fe,{"is-success":"","is-outlined":"",class:"w-full"},{icon:T(()=>[on]),default:T(()=>[ae("Aggiungi nota")]),_:1})])])])]))}}),cn=[{id:-4,date:new Date(new Date().setDate(new Date().getDate()-12)),isPresent:!0},{id:-3,date:new Date(new Date().setDate(new Date().getDate()-11)),isPresent:!0},{id:-2,date:new Date(new Date().setDate(new Date().getDate()-10)),isPresent:!0},{id:-1,date:new Date(new Date().setDate(new Date().getDate()-9)),isPresent:!0},{id:0,date:new Date(new Date().setDate(new Date().getDate()-8)),isPresent:!0},{id:1,date:new Date(new Date().setDate(new Date().getDate()-7)),isPresent:!1},{id:2,date:new Date(new Date().setDate(new Date().getDate()-6)),isPresent:!1},{id:3,date:new Date(new Date().setDate(new Date().getDate()-5)),isPresent:!0},{id:4,date:new Date(new Date().setDate(new Date().getDate()-4)),isPresent:!0},{id:5,date:new Date(new Date().setDate(new Date().getDate()-3)),isPresent:!0},{id:6,date:new Date(new Date().setDate(new Date().getDate()-2)),isPresent:!1},{id:7,date:new Date(new Date().setDate(new Date().getDate()-1)),isPresent:!0},{id:8,date:new Date,isPresent:!0}];const _e=o=>(Qe("data-v-3098e80f"),o=o(),Re(),o),dn={class:"relative flex h-full w-full"},un={class:"flex flex-col w-96 bg-green-25 rounded-l-lg overflow-auto thin-scrollbar relative"},fn={class:"flex w-full sticky top-0 pt-6 px-4 justify-between bg-green-25 z-10 pb-4"},gn={class:"flex flex-grow space-x-4 overflow-y-auto","aria-label":"Tabs"},pn=["onClick","aria-current"],hn={class:"border-l border-green-200 ml-3 pl-3"},mn=_e(()=>e("i",{class:"fal fa-pen-to-square",style:{"margin-top":"-3px"}},null,-1)),vn=[mn],An={class:"flex flex-col w-full pt-4 rounded-t-2xl bg-bg-100 flex-grow"},yn={key:0,role:"list",class:"divide-y divide-border"},xn=["onClick"],bn={class:"flex max justify-between px-4"},wn={class:"flex"},_n={class:"flex flex-col"},Dn={class:"text-sm font-semibold leading-6 text-gray-900"},Cn={class:"mt-1 flex text-sm leading-7 text-gray-500"},Tn={class:"flex items-center"},Pn={class:"hidden sm:flex sm:flex-col sm:items-end"},Sn={class:"text-sm leading-6 text-gray-900"},En={class:"mt-1 flex items-center"},Bn={class:"sr-only"},kn={key:1,role:"list",class:"divide-y divide-border"},In=["onClick"],Vn={class:"flex max justify-between px-4"},Fn={class:"flex"},Ln={class:"flex flex-col"},Un={class:"text-sm font-semibold leading-6 text-gray-900"},Mn={class:"mt-1 flex text-xs leading-5 text-gray-500"},Qn={class:"flex items-center"},Rn={class:"hidden sm:flex sm:flex-col sm:items-end"},zn={class:"text-sm leading-6 text-gray-900"},Yn={class:"mt-1 text-xs leading-5 text-gray-500"},On={class:"mt-1 flex items-center gap-x-1.5"},Nn=_e(()=>e("p",{class:"text-xs leading-5 text-gray-500"},"Saturazione",-1)),Hn={key:2,class:"flex flex-col w-full h-full"},Gn={class:"flex flex-col pb-3 border-b px-4"},Xn=_e(()=>e("label",{for:"ndviRange",class:"form-label text-sm font-medium mb-2"},"Visibilit\xE0",-1)),jn={class:""},$n=["onClick"],Kn={class:"flex items-center h-full justify-between px-4"},Jn={class:"flex items-center"},Wn={class:"text-sm font-semibold leading-6 text-gray-900"},Zn={key:0,class:"flex items-center"},qn={class:"flex flex-col flex-grow relative overflow-hidden"},es=pe({__name:"index",setup(o){const N=[{name:"Appezz.",id:"plots",icon:"fa-map"},{name:"Trappole",id:"traps",icon:"fa-mosquito"},{name:"Ndvi",id:"ndvi",icon:"fa-satellite"}],J=h(Ze),A=h(null),V=h(Ct),y=h(Dt),v=h(null),M=h(cn),B=h(M.value[M.value.length-1]),D=h(0),C=h(0),Q=h(10),P=h(N[0].id),$=h(!1),g=h(!1),S=h(!1);function m(){$.value=!0}function x(I){let F=0;return I.insects.forEach(R=>{F+=R.count}),F}function k(I){return x(I)>I.danger_treshold}function U(I){return x(I)>I.warning_treshold}function Z(I){return Math.floor(x(I)/I.danger_treshold*100)}O(()=>P.value,()=>{g.value=!1,v.value=null,S.value=!1,A.value=null}),O(()=>v.value,()=>{v&&(g.value=!0)}),O(()=>A.value,()=>{A.value&&(S.value=!0)});function H(){g.value=!1,v.value=null}function ne(){S.value=!1,A.value=null}return(I,F)=>{const R=Ue("bf-tooltip");return i(),f("div",dn,[e("div",un,[e("div",fn,[e("nav",gn,[(i(),f(X,null,j(N,n=>e("button",{role:"tab",key:n.id,onClick:z=>P.value=n.id,class:w([(P.value===n.id,""),"group flex flex-col items-center space-y-1"]),"aria-current":P.value===n.id?"page":void 0},[e("span",{class:w([P.value===n.id?"border-green-600 bg-green-600 text-green-50":"border-transparent group-hover:border-green-400 text-green-500","flex flex-col items-center justify-center border-2 w-14 h-14 bg-green-400/20 transition-colors-default rounded-full"])},[e("i",{class:w(["fal",n.icon])},null,2)],2),e("span",{class:w([P.value===n.id?"text-green-700":"group-hover:text-green-700","text-sm font-medium text-gray-500 transition-colors-default"])},p(n.name),3)],10,pn)),64))]),e("div",hn,[re((i(),f("button",{onClick:m,class:"border-transparent hover:bg-green-400/20 rounded-md h-full text-green-500 flex text-xl px-4 items-center justify-center transition-colors-default"},vn)),[[R,"Aggiungi/rimuovi"]])])]),e("div",An,[E(q,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:T(()=>[P.value==="plots"?(i(),f("ul",yn,[(i(!0),f(X,null,j(J.value,n=>(i(),f("li",{class:w(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":A.value&&A.value.parcel_id===n.parcel_id}]),onClick:z=>{g.value=!1,v.value=null,A.value=!A.value||A.value&&A.value.parcel_id!==n.parcel_id?n:null,C.value++}},[e("div",bn,[e("div",wn,[e("div",_n,[e("p",Dn,p(n.name),1),e("p",Cn,p(n.cropDescription),1)])]),e("div",Tn,[e("div",Pn,[e("p",Sn,p(n.area)+" ha",1),e("div",En,[re((i(),f("div",{class:w([n.ndvi_change_type==="increase"?"bg-green-50 text-green-800":"bg-red-50 text-red-800","inline-flex items-baseline rounded-full px-2.5 py-0.5 text-sm font-medium md:mt-2 lg:mt-0"])},[n.ndvi_change_type==="increase"?(i(),W(L(Ie),{key:0,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-green-500","aria-hidden":"true"})):(i(),W(L(ke),{key:1,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-red-500","aria-hidden":"true"})),e("span",Bn,p(n.ndvi_change_type==="increase"?"Aumendo":"Diminuzione")+" del ",1),ae(" "+p(n.ndvi_change),1)],2)),[[R,n.ndvi_change_type==="increase"?"Aumendo indice NDVI da ieri":"Diminuzione indice NDVI da ieri"]])])])])])],10,xn))),256))])):P.value==="traps"?(i(),f("ul",kn,[(i(!0),f(X,null,j(V.value,n=>(i(),f("li",{class:w(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":v.value&&v.value.id===n.id}]),onClick:z=>{S.value=!1,A.value=null,v.value=!v.value||v.value&&v.value.id!==n.id?n:null,D.value++}},[e("div",Vn,[e("div",Fn,[e("div",Ln,[e("p",Un,p(n.type),1),e("p",Mn,p(n.name),1)])]),e("div",Qn,[e("div",Rn,[e("p",zn,p(x(n))+" catture ",1),e("p",Yn," Ultima cattura "+p(new L(ge)(n.last_capture).format("dd/MM")),1),e("div",On,[re((i(),f("div",{class:w(["flex-none rounded-full p-1",{"bg-green-500/20":!U(n),"bg-orange-500/20":U(n)&&!k(n),"bg-red-500/20":k(n)}])},[e("div",{class:w(["h-1.5 w-1.5 rounded-full",{"bg-green-500":!U(n),"bg-orange-500":U(n)&&!k(n),"bg-red-500":k(n)}])},null,2)],2)),[[R,Z(n)+"%"]]),Nn])])])])],10,In))),256))])):(i(),f("div",Hn,[e("div",Gn,[Xn,re(e("input",{"onUpdate:modelValue":F[0]||(F[0]=n=>Q.value=n),type:"range",class:"form-range",min:"0",max:"10",step:"0.1",id:"ndviRange"},null,512),[[Me,Q.value]])]),e("ul",jn,[(i(!0),f(X,null,j(M.value.sort((n,z)=>z.date.getTime()-n.date.getTime()),n=>(i(),f("li",{class:w(["relative py-4 transition-colors-default border-b",{"!bg-gray-100":B.value&&B.value.id===n.id,"hover:bg-gray-50 cursor-pointer":n.isPresent}]),onClick:z=>n.isPresent?B.value=!B.value||B.value&&B.value.id!==n.id?n:null:"",style:{height:"73px"}},[e("div",Kn,[e("div",Jn,[e("p",Wn,p(new L(ge)(n.date).format("dd/MM")),1)]),n.isPresent?Y("",!0):(i(),f("div",Zn,[re((i(),f("div",{class:w(["flex items-center justify-center w-12 h-12 rounded-full text-xl",n.isPresent?"bg-teal-50 text-teal-400":"bg-gray-50 text-gray-400"])},[e("i",{class:w(["fal",n.isPresent?"fa-check":"fa-clouds"])},null,2)],2)),[[R,n.isPresent?"NDVI presente":"\xC8 stata scattata un'immagine satellitare in questo giorno, ma l'indice di vegetazione NDVI non pu\xF2 essere calcolato. Ci\xF2 pu\xF2 accadere a causa della copertura nuvolosa, della foschia, della neve o di altri fattori."]])]))])],10,$n))),256))])]))]),_:1})])]),e("div",qn,[E(_t,{parcels:J.value,curParcel:A.value,traps:V.value,curTrap:v.value,zoomOnTrap:D.value,zoomOnPlot:C.value,onSelectTrap:F[1]||(F[1]=n=>{S.value=!1,A.value=null,v.value=!v.value||v.value&&v.value.id!==n.id?n:null}),onSelectParcel:F[2]||(F[2]=n=>{g.value=!1,v.value=null,A.value=!A.value||A.value&&A.value.parcel_id!==n.parcel_id?n:null})},null,8,["parcels","curParcel","traps","curTrap","zoomOnTrap","zoomOnPlot"]),E(q,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:T(()=>[g.value&&v.value?(i(),W(ua,{key:0,curTrap:v.value,insectTypes:y.value,onClose:H},null,8,["curTrap","insectTypes"])):Y("",!0)]),_:1}),E(q,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:T(()=>[S.value&&A.value?(i(),W(ln,{key:0,curParcel:A.value,onClose:ne},null,8,["curParcel"])):Y("",!0)]),_:1})])])}}}),os=et(es,[["__scopeId","data-v-3098e80f"]]);export{os as default};

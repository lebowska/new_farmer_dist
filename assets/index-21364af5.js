import{o,b as f,e,d as pe,s as he,N as Ve,L as N,C as Ie,k as m,c as le,t as g,n as w,F as X,r as K,f as z,l as I,w as C,T as te,a as Z,m as j,M as Le,E as Ue,D as oe,O as Me,A as Re,B as ie,Q as Qe,R as ze,S as Ye}from"./index-47e0eb5e.js";import{T as Ne,B as Oe,u as $e,a as He,C as Ge,W as je,V as ue,b as ve,c as ye,S as _e,k as xe,n as Xe,d as Ke,e as re,f as Te,P as be,I as fe,j as we,i as Je,l as We,m as Ze,p as qe}from"./parcelData-d7f0a92f.js";import{S as Ce,a as Ae,_ as et}from"./Select-e4e9d361.js";import{a as Pe,g as Se}from"./Colors-74604422.js";import{c as tt,a as at}from"./cicciotto-25d2cff1.js";import{D as De}from"./DateUtils-c1a87f7b.js";import{_ as Ee,t as nt}from"./ChartComponent-2a9d85dd.js";import{_ as ke}from"./BfTable-37d5d4b8.js";import{_ as ge}from"./BfButton-5ec604ea.js";import{_ as st}from"./plugin-vue_export-helper-c27b6911.js";import"./use-outside-click-da6ff33c.js";import"./use-text-value-36758152.js";import"./use-tree-walker-fb60298c.js";function Be(l,O){return o(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})])}function Fe(l,O){return o(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})])}const rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAA8klEQVQYlXWQsUrDUBRAz325NoFgitjBoXUp4hKh4ObU2dVPKM5+UD7BxcGlnQRHlw5ZFAQVUREtEk1raGocntUY7ZkevMPh3isHDQVg/2RY8EXU7QgVTFVahMRx/C35rZDsAy4TGGzrr6qZP2ZrIZ4DroEVFxr9vPgjes0QAMfAqge+wrQyjAH7oQJXr3A3hjSHjWW4iH6qJup2xF+C+zEcXcPxDdy+QVCDnfVKMZ3C2ROkuyrDEYwyW20HsHVqqzK/Y5nnw7zYDKzoOpDNSluXeUngPLGCit3hX7HdU1EDDxM7QtNfIALU91Qe3221XoNPcCBLMI6LQyMAAAAASUVORK5CYII=",ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABeElEQVQokW3SO2tUURTF8d+9nntnxjiJQpABUQz4wEY/gSIIYi1ptbIX7Cxt7GwEsbARBCtBOz+ApcRCUFQIQQIS8pyZZN535lqc0RHMqc5ZsNbe+392cn8xgI9PijLP2dig02FwQDHgzquQOOQE+PGiKK+fYrPPeEy1xrBOeoQPj4uy22H9K/fezkLSny+L8tpZTlYJaRQnE0JGnjNfp9Fg6QrvHhTlX+OtJS4scCxjPmOhTppSjOh2WFtjdZXhIHbw/mE0h3PzDCYcDdQDi8fZbcaq/R69Nr09DirkdfJarJh821N+2mZ3EIVfXb7vsLZOq0W3Tb8VQUHtBI0zpM/Ph2QusDdgfxTnzLMZvTSLlUKFcREDdranVK822OrzpRnNzX2yjCzQG0/xV2dhy09DEuDR6ZAsfy7KrX4MqEwhjUa0m4y6lGPuvp59R/hzeXM5JDdXinKzHwkXk6gPh9x49v8ShH8fFxdoDWkP46xzt0Ny6bC1wW8e44quL8wQiQAAAABJRU5ErkJggg==",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAYAAAD+Bd/7AAAAmElEQVQImS3MMWoCUQAA0ffX75J1NZUE0gQhrZdIn1K8huAB0od0uYBX8FARBIkKZl2V1bX4qQZmYMJsGC2mTfvwSKdLXpB1uJyZfMcQF9OmHY3pl8D1lljXieH1Szt64fmJ+sShSuGvYrUie/+MYfOb4qDH4P+U5xQFGVQVP2sOR44ntnu2O2KXMBtGsJw3bVkmCW8fMcAdpnwsOXDzZHAAAAAASUVORK5CYII=",it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAYAAAAvg9c4AAADGElEQVQ4jY2Vu28cVRSHv5l7x7Mzs+ud9a6XXeJAgmUhBYeHeCRSihRINAiJAiSIxB9ARRmK0FHQICFqCkQXCkSBKKBCAoFEeIkiFBESmOBX/Fjvzu7Mzt25FGftGOKxudLojnTv+e5vzj3nN84bLU3Z+PAVY/0qeCHkQ3j1A+2Ubj40nKOgH10x1lGgPPAC8HzwfUgSeOn9k8H/In7/rrHrG+CuQZEDngDrMQQBtFr/R+cU2vnSWM+F3i6Mc0hHYDKwE8gz2VgNQSn45h1jL715vFr3hZ+MfaIJ8Qzs9mGYgOvKs5+CagSTQgKMga/eNvZYaOiBr2AhggunoN2GWg0cF0wKwx1YXYNBIgHd+wR8LLQbgHZgYuFcDM88BGEkCpUnue2tweYG3NkWeKsJn10tV+u+t6idUEOoYc6H8zF05mXRUVJOjguDLQH39mA8hiiCj18/GnxQUs/9YGySg7HwWw8++Q621qHYz2UKroJqE/wZyfnOHej95VCJLY4Lp5fg8jXtHJRUw4ckh6GBByJ4eBF+zSCb3n6uwRaQDiBzpdQqVXDPWup10B7c/l1q/AB6fVk7L/5ibGIgMfBUB7Ix/Hlb1oMA+nuwuy1wV0kKGg1ozUFYkeZIR/8p/k8f086Fb43tjaHmwaNdGAxhlEJ3HiYTCSwKqZBOG5oxLMUQKMhyyfk9PXo6gj8G8PcA2j6cfxBurctaNQLVFfhcDBfPwP0BdEPYTCGuwep6Se8//rWxP25DYwZmPbjVh+0EzsRQ09A3Mi/OSsVMLGyM4GYPsucPXdTh0Q5Ewc5Y5uUYfi4gL+BcAyoK0sndLlsZwMAIEMA9CvrFk9rpTJvCWIg0XJyHdgVWh+C7UJ924uZIgCvP3vWDUjNtB5BNJNBX0wMKuLElwIUqzM7IIYeBpUr31T49L4GRBuXKe6Dh8xVR6Cu4eflexyq3fWCpLs1gLOyNYXMsipWSr7i+fLQFlioFeOuUdrqhAIyVi+vnsnbjUrmnHgsFscTVIQxz2EhhJ4HmyyeY9EnQq13tPNKArUxULrx28j/qH3hsHP+6HLkeAAAAAElFTkSuQmCC",ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAWCAYAAADNX8xBAAAB5ElEQVQ4jZ3UTWsTURTG8f+9cyevTYO1RDoqFUQt6iIYXIkSdJmNIEpBBDcuXNWtX8DPIGTRb9CF4AuCK5euxHahoNWWCFralCbTJNM7GReHtNa0zYwHBubexY/nHM6Mmps05F/ZaCOArAOdENK3jSJhqedLRDaCogu+hbUuNDrJMf15C1o7kHZgPAUFF6bz0H9ho0SQq+FrC353oReC0dLi2TEovomP6V7NKKMllW8h48CYK08ziJ9Mg8xjaRO6oVw6CmwfLhVheS1mosFLEEh7ti9no2Vm1TPw/tnoVLvQ1H2jVlvwrQ1hJOC2BS8H1y7D66dHY/rvQ2nWqE8/4WMT2hbaO7AVQCkNnhcz0aDOPzLqVwsa22AjGXgnhNJEQmjQ5vI6bPT27k6Ow8KTw9s7EAKYfmjUii87VXBhIgWVMszfOxg7FAI4fteoH75ABRcqU3DlOtRr4RBmjoIAVjbB1eBlBbtxDtp+BC8TJAI49UA+3k4oW+9lYfYqfKnvb3EkBNCrGdUMZPONhhMZuDMD/sIeFgsCKGUklaMg58LFY/B4Bm5+EEzNTY4c026dfmcjLwcXirLx698Xk7U2qNVbRhVTkHf3I4khgLcVo2xjceg+MQRQr5aHfsP/Bf2L1atl9QeqsqHj3YkKIgAAAABJRU5ErkJggg==",dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAABCElEQVQYlW2RvUoDQRRGz0yuG+KSTTZkQfEPGy20CNhELKzEws4XER/AR1IhhY1Yia2FICmsxB8ChpVEF1yc3bEYJW7YW92Bw5nv3quO2sLo1NjQg/UA+ruiKCmd94zthLAdQVSDpStjy0B1/YoFSDNIDMQp9EeQHhTNeqe5wkboIGNhfhbWgpKvj5dflGgHNGZAFCz6kPeKETTAyYKoVhWqFWfOLNQFkrMJrP+a2yGMv38j5LDVhs3mlBHgpivqLoaGB764GKt18C+cVfOvBntu0sCDinZROi2YuzS2AAKcP7pVZbkbLKpB6E0ZAfxDUffvk/fzJ7x9lYDgzhin8JTAwwcM90X9AG7EUPqOil3VAAAAAElFTkSuQmCC",ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABVElEQVQokX2SO0sDQRSFv5kd3DyMmKABQSGxEdRCxEYESSOCIFj6L/xFVmJl46O3E3yAlYgQLAyBSBINajbuspNdi2sUjXGqO3C/uefcOWpnzACwdGbjlxDKJaP452iA1UsbA9gIiqdSDwRWzm2cT8BsFvJJuHuF4HAwpF0HJtNy6UbQDiHpgD75G9I2hucArhrwFMBCTgAbQ3WvH9K1DhxVoOKJpPksTGfg3UImBfe7PyFdLhlV96WpkIGRIRhPgN+FmREoFf7YkrtllKOgFUAnFDlzozA7KhOj4+8puldUPbhuip+EI81GQ9CFxRzU9gX6AprrRt224DWElIGcK/9iY5hKw2bh1wSA/LZRDR9qHXk5LSHAszCRgqcDG/8AAN5CeGhDEIHriLygC3VffPUB3oZRNgLnM1FZV2TdtOBxzag+oOen6omU4jBcLBvlbUgoPwDYj4IfJzeDcwAAAABJRU5ErkJggg==",ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAHCAYAAAArkDztAAAAj0lEQVQImT3LIQ7CQBRF0fvLz1AMpRWsANFAAt0AEk9SyxbYAptAo9gAHl+FIehaQkARxJB0YBDT8JKrTp5sTnj3haqG2VqFdlGvA0UGywmct87/4WrBecgHsCqg3gXUVwN3C8MYphl0czjsnY+SUsV+4NmE5ziFcgQKcFuocHReBfoGEtMCQGrg8Q5d5io/VTwqesL437MAAAAASUVORK5CYII=",gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABa0lEQVQokXXQMWtTURiH8d+9ObmpJEohttg2qFhEnFwVHNXBXRDByQ/g5GcQV0eHfoZSHUV0sRQK6iAoOKhBi2mjialp09ybOByhNtYXXs45vO/zf+Akd48HDzby8conVpqcrHJ1geULIXFIJfdfGb//GR+dXuy5Ga41eH35Xyhd+8LXTQZDsjJFwZu3LK1z9nk+ngRCrRpTi4Iso1Si26Xd4uk0pyYN9RshaZyg16fVptNlNKS/xeoqg+WDlhSuN9jb43OT9lYcZDW2Wzxb4/yLfSiFtUshma0zzAlljk5TqzN1jB/fePJhwgCzN0MyP0clI6tEsFJjVPCxSfo4WlJ/1WydNI1LkJQIU2xu8PLdhAEat+O/7+ySDxkXMWBc0GoxWsnHBwA4czqeef4nsUypHAOa3ycMsHgnJNttdrsUOflgf9b7dQgAt5ZCstNh2Cc7Ei3zCzy88h8AZhYJlXivVrl4LySPzoXkN4PofZ5v1q44AAAAAElFTkSuQmCC",pt="/new_farmer_dist/assets/trap_green_default-4e22ed9b.svg",ht="/new_farmer_dist/assets/trap_green_selected-50db3ff5.svg",mt="/new_farmer_dist/assets/trap_green_hover-94fb773d.svg",vt="/new_farmer_dist/assets/trap_red_default-8a46b256.svg",yt="/new_farmer_dist/assets/trap_red_selected-87af6be1.svg",_t="/new_farmer_dist/assets/trap_red_hover-33543daa.svg",xt="/new_farmer_dist/assets/trap_orange_default-fbd0de4d.svg",bt="/new_farmer_dist/assets/trap_orange_selected-15335778.svg",wt="/new_farmer_dist/assets/trap_orange_hover-ecdc61c5.svg",At="Aerial",Dt="Ak2gN0iZ3d02J-xwYSYgRp8oHFZCOneWeg_Hj7C2ZntIKTXCGc0HXVQ8GHkuxp17",Tt=pe({__name:"EntitiesMapViewer",props:{parcels:{},curParcel:{},traps:{},curTrap:{},zoomOnTrap:{},zoomOnPlot:{}},emits:["select-trap","select-parcel"],setup(l,{emit:O}){const q=new Ne({visible:!0,preload:1/0,source:new Oe({key:Dt,imagerySet:At})}),L=[{parcelId:12,image:rt,coordX:.4,coordY:.5,scale:14},{parcelId:10,image:ot,coordX:.5,coordY:.5,scale:14},{parcelId:2,image:tt,coordX:.53,coordY:.48,scale:14},{parcelId:3,image:at,coordX:.55,coordY:.51,scale:14},{parcelId:11,image:lt,coordX:.55,coordY:.51,scale:14},{parcelId:9,image:it,coordX:.74,coordY:.51,scale:14},{parcelId:8,image:ct,coordX:.47,coordY:.48,scale:14},{parcelId:6,image:dt,coordX:.47,coordY:.48,scale:14},{parcelId:7,image:ut,coordX:.46,coordY:.52,scale:14},{parcelId:13,image:ft,coordX:.51,coordY:.53,scale:13},{parcelId:1,image:gt,coordX:.51,coordY:.53,scale:14}],y=$e(),{map:_,mapRef:U,padding:x}=He();let F=null,A=null;const P=new Ge;let Y=null;const R=new je;he(async()=>{U.value&&(_.setTarget(U.value),U.value.addEventListener("mouseleave",h),await new Promise(s=>setTimeout(s,500))),J(),_.getLayers().clear(),await B(),$(),M(),ee()});async function B(){_.addLayer(q)}Ve(()=>{J()});function h(){y.emit("hover:map",[])}function S(s){if(s.type==="pointermove"){const t=_.getFeaturesAtPixel(s.pixel);if(t&&t.length>=1){const r=t[0]?.values_?.features[0]?.values_?.type;if(r&&r==="trap"){const d=t[0].get("features");if(Array.isArray(d)&&d.length>0){const i=d.map(u=>u.get("ref"));y.emit("hover:map",i)}else y.emit("hover:map",[t[0].get("ref")]);_.getTargetElement().style.cursor="pointer"}}else y.emit("hover:map",[]),_.getTargetElement().style.cursor="default";return!0}return!1}function p(s){const t=_.getAllLayers().find(r=>r.get("name")==="trapInteractionLayer");if(t){const r=t.getSource();if(r){const d=r.getFeatures();for(const i of d){const u=i.get("features");if(Array.isArray(u)){for(const a of u)if(a.getProperties().ref===s)return i}else if(i.getProperties().ref===s)return i}}}return null}function b(s){const t=_.getAllLayers().find(r=>r.get("name")==="parcelInteractionLayer");if(t){const r=t.getSource();if(r){const d=r.getFeatures();for(const i of d){const u=i.get("features");if(Array.isArray(u)){for(const a of u)if(a.getProperties().ref===s)return i}else if(i.getProperties().ref===s)return i}}}return null}function V(s){const t=Ze();return s.forEach(r=>{const d=r.getGeometry();d&&We(t,d.getExtent())}),t}function J(){_.getLayers().getArray().filter(t=>t instanceof ue).forEach(t=>{_.removeLayer(t)}),P.getLength()&&P.clear(),F&&(_.removeInteraction(F),F.dispose(),F=null),A&&(_.removeInteraction(A),A.dispose(),A=null)}function $(){const s=[];l.parcels.forEach(i=>{const u=R.readFeature(i.world_geom);u.setProperties({ref:"parcel_"+i.parcel_id,type:"parcel",parcel_id:i.parcel_id}),P.push(u),s.push(u)}),Y=new ve({features:s});const t=new ye({distance:0,source:Y,geometryFunction:se}),r=new ue({source:t,style:ae,properties:{name:"parcelInteractionLayer",ref:_e.VECTOR,id:"parcel"},renderBuffer:500});_.addLayer(r),r.setZIndex(900);const d=V(P.getArray());H(d)}N(()=>l.curParcel,()=>{if(P.getArray().filter(t=>t.getProperties().type==="parcel").forEach(t=>{t.setStyle(ae)}),l.curParcel){const t=l.parcels.find(r=>r.parcel_id===l.curParcel.parcel_id);if(t){const r=b("parcel_"+t.parcel_id);r&&r.setStyle(ne)}}}),N(()=>l.zoomOnPlot,()=>{if(l.curParcel){const s=l.parcels.find(t=>t.parcel_id===l.curParcel.parcel_id);if(s){const t=b("parcel_"+s.parcel_id);if(t){const r=V([t]),d=xe(r),i=[d[0],d[1]-100];_.getView().animate({center:i,duration:500})}}}});function M(){const s=[];l.parcels.forEach(i=>{if(L.find(u=>u.parcelId===i.parcel_id)){const u=R.readFeature(i.world_geom);u.setProperties({ref:"ndvi_"+i.parcel_id,type:"ndvi",parcel_id:i.parcel_id}),P.push(u),s.push(u)}});const t=new ve({features:s}),r=new ye({distance:0,source:t,geometryFunction:se}),d=new ue({source:r,style:n,properties:{name:"ndviLayer",ref:_e.VECTOR,id:"ndvi"},renderBuffer:500});d.on("prerender",i=>{const u=i.context;u.imageSmoothingEnabled=!1;const a=u;a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1}),_.addLayer(d),d.setZIndex(700)}function ee(){const s=[];l.traps.forEach(i=>{const u=R.readFeature(ce(Xe([i.coordinates.lon,i.coordinates.lat])));u.setProperties({ref:"trap_"+i.id,type:"trap",trap_id:i.id}),P.push(u),s.push(u)});const t=new ve({features:s}),r=new ye({distance:0,source:t,geometryFunction:se}),d=new ue({source:r,style:E,properties:{name:"trapInteractionLayer",ref:_e.VECTOR,id:"trap"},renderBuffer:500});F=new Ce({style:Q,condition(i){return Ke(i)},layers:function(i){return i.get("name")==="trapInteractionLayer"}}),_.addInteraction(F),F.on("select",i=>{const u=i.target.getFeatures().getArray()[0].getProperties().features;if(u.length>1){const a=V(u);H(a)}else{const a=u[0].get("trap_id"),v=l.traps.find(c=>c.id===a);O("select-trap",v)}}),A=new Ce({style:k,condition:S,layers:function(i){return i.get("name")==="trapInteractionLayer"}}),_.addInteraction(A),_.addLayer(d),d.setZIndex(910)}N(()=>l.curTrap,()=>{if(P.getArray().filter(t=>t.getProperties().type==="trap").forEach(t=>{t.setStyle(E)}),l.curTrap){const t=l.traps.find(r=>r.id===l.curTrap.id);if(t){const r=p("trap_"+t.id);r&&r.setStyle(Q)}}}),N(()=>l.zoomOnTrap,()=>{if(l.curTrap){const s=l.traps.find(t=>t.id===l.curTrap.id);if(s){const t=p("trap_"+s.id);if(t){const r=V([t]);_.getView().animate({center:xe(r),duration:500})}}}});const ae=s=>{if(s.get("features")!==void 0){const d=s.get("features")[0].getGeometry().getCoordinates();return new re({stroke:new Te({color:Pe("lime-200",1),width:2}),geometry:new be(d)})}},ne=s=>{if(s.get("features")!==void 0){const d=s.get("features")[0].getGeometry().getCoordinates();return new re({stroke:new Te({color:Pe("lime-50",1),width:4}),geometry:new be(d)})}},E=s=>{const t=s.get("features");if(t!==void 0){const r=l.traps.find(u=>u.id===t[0].values_.trap_id);let d=0;r.insects.forEach(u=>{d+=u.count});let i=pt;return d>r.danger_treshold?i=vt:d>r.warning_treshold&&(i=xt),new re({image:new fe({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:i})})}},k=s=>{const t=s.get("features");if(t!==void 0){const r=l.traps.find(d=>d.id===t[0].values_.trap_id);if(r){let d=0;r.insects.forEach(u=>{d+=u.count});let i=mt;return d>r.danger_treshold?i=_t:d>r.warning_treshold&&(i=wt),new re({image:new fe({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:i})})}}},Q=s=>{const t=s.get("features");if(t!==void 0){const r=l.traps.find(u=>u.id===t[0].values_.trap_id);let d=0;r.insects.forEach(u=>{d+=u.count});let i=ht;return d>r.danger_treshold?i=yt:d>r.warning_treshold&&(i=bt),new re({image:new fe({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:i})})}},n=s=>{const t=s.get("features");if(t!==void 0){const d=s.get("features")[0].getGeometry().getCoordinates(),u=new be(d).getInteriorPoint().getCoordinates(),a=L.find(v=>v.parcelId===t[0].values_.parcel_id);if(a)return new re({image:new fe({scale:a.scale,anchor:[a.coordX,a.coordY],anchorXUnits:"fraction",anchorYUnits:"fraction",src:a.image}),geometry:new we(u)})}};function H(s){_.getView().fit(s,{padding:[50,50,50,50],easing:Je,duration:1e3})}function se(s){const t=s.getGeometry();return t?new we(xe(t.getExtent())):new we([0])}function ce(s){return"POINT("+s[0]+" "+s[1]+")"}return(s,t)=>(o(),f("div",{ref_key:"mapRef",ref:U,class:"relative h-full w-full"},null,512))}}),Ct=[{id:0,name:"Rodilegno"},{id:1,name:"Lobesia botrana"},{id:2,name:"Tortricidae"},{id:3,name:"Coleottero"},{id:4,name:"Popillia Japonica"},{id:5,name:"Processionaria"},{id:6,name:"Cerambycidae"}],Pt=[{id:"1",name:"S03925",type:"Cymatrap garden",last_capture:new Date("2023-03-28"),warning_treshold:30,danger_treshold:50,insects:[{count:5,id:"0",name:"Rodilegno"},{count:18,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.560286922994884,lon:10.721558966213962},battery:67,signal:100},{id:"2",name:"S05321",type:"Cymatrap garden",last_capture:new Date("2023-03-10"),warning_treshold:30,danger_treshold:70,insects:[{count:2,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.561788608518086,lon:10.719467188742241},battery:89,signal:70},{id:"3",name:"S08513",type:"Cymatrap pro",last_capture:new Date("2023-02-07"),warning_treshold:200,danger_treshold:300,insects:[{count:12,id:"0",name:"Rodilegno"},{count:1,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56160296275679,lon:10.720474777327212},battery:56,signal:50},{id:"4",name:"S00593",type:"Isagro dispenser",last_capture:new Date("2023-04-30"),warning_treshold:10,danger_treshold:20,insects:[{count:32,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559936248891546,lon:10.720922594476088},battery:34,signal:100},{id:"5",name:"S03858",type:"Isagro dispenser",last_capture:new Date("2023-03-14"),warning_treshold:80,danger_treshold:200,insects:[{count:41,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55896672672015,lon:10.721040441094033},battery:16,signal:80},{id:"6",name:"S05952",type:"Isagro dispenser",last_capture:new Date("2023-03-10"),warning_treshold:120,danger_treshold:200,insects:[{count:32,id:"0",name:"Rodilegno"},{count:15,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55821997698153,lon:10.721606104861031},battery:89,signal:30},{id:"7",name:"S08332",type:"Linea bacterocera",last_capture:new Date("2023-03-22"),warning_treshold:50,danger_treshold:100,insects:[{count:4,id:"0",name:"Rodilegno"},{count:7,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56011777455661,lon:10.722436923510717},battery:78,signal:20},{id:"8",name:"S09876",type:"Isagro carpo +",last_capture:new Date("2023-03-24"),warning_treshold:30,danger_treshold:70,insects:[{count:0,id:"0",name:"Rodilegno"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55862017006319,lon:10.72403963751722},battery:55,signal:0},{id:"9",name:"S02273",type:"Isagro carpo +",last_capture:new Date("2023-03-26"),warning_treshold:10,danger_treshold:20,insects:[{count:51,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559086370782154,lon:10.721712166809247},battery:54,signal:80},{id:"10",name:"S01423",type:"Isagro double wing",last_capture:new Date("2023-03-07"),warning_treshold:10,danger_treshold:20,insects:[{count:54,id:"0",name:"Rodilegno"},{count:34,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559346286317734,lon:10.722271938245344},battery:79,signal:100}],St={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},Et=e("span",{class:"sr-only"},"Chiudi pannello",-1),kt=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),It=[Et,kt],Bt={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},Ft={class:"flex w-6/12 items-center border-r pr-6"},Vt={class:"flex flex-grow flex-col"},Lt={class:"flex items-center gap-x-3"},Ut={class:"flex gap-x-3 text-lg leading-7"},Mt={class:"font-semibold"},Rt={class:"mt-2 text-sm leading-6 text-label"},Qt={class:"flex w-6/12"},zt={class:"flex w-full divide-x divide-border"},Yt={class:"text-sm font-medium leading-6 text-label"},Nt={class:"text-3xl font-medium tracking-tight text-text"},Ot={key:0,class:"text-sm text-label"},$t={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Ht={class:"flex h-full w-6/12"},Gt={key:0,class:"flex h-full w-full"},jt={class:"relative flex h-full w-full pb-4 pl-3 pr-3 pt-4"},Xt={class:"absolute z-10 flex h-16 w-12 flex-col items-center justify-center",style:{left:"calc(50% - 1.5rem)",top:"calc(50% - 2rem)"}},Kt=e("span",{class:"text-sm font-medium text-label"},"Totali",-1),Jt={class:"text-3xl font-medium tracking-tight text-text"},Wt={class:"thin-scrollbar relative flex h-full w-full flex-col space-y-3 overflow-auto pb-4 pl-8 pr-6"},Zt={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3"},qt={class:"flex w-full flex-col"},ea={class:"flex w-full items-center"},ta={class:"text-sm font-medium text-label"},aa={class:"text-3xl font-medium tracking-tight text-text"},na={key:1,class:"thin-scrollbar h-full w-full overflow-auto px-6 pb-6"},sa={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 py-3"},ra=e("th",null,"Insetto",-1),oa=e("th",null,"Conteggio",-1),la={class:"flex flex-col h-full w-6/12 px-6 border-l overflow-auto thin-scrollbar"},ia={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3 space-x-2"},ca={key:0,class:"flex h-full w-full"},da={class:"relative flex h-full w-full pb-4 pt-4"},ua={key:1,class:"w-full pb-6"},fa=e("th",null,"Giorno",-1),ga=pe({__name:"trapResumePanel",props:{insectTypes:{},curTrap:{}},emits:["close"],setup(l,{emit:O}){const q=Ie(),L=m(!0);let y=!1,_=!1;const U=m(null),x=m(null),F=["Anno","Mese","Settimana"],A=m("Settimana"),P=m("chart"),Y=m("chart"),R=m(0),B=m(0);let h=m([]);const S=m([]),p=nt.color;let b=[],V=[],J=[],$=[],M=[];function ee(a){a.style.height=0}function ae(a){a.style.height=`${l.curTrap.battery}%`,a.style.transition="height 1s ease-out"}function ne(a){a.style.height=0}function E(a){a.style.height=`${l.curTrap.signal}%`,a.style.transition="height 1s ease-out"}const k=le(()=>{let a=0;return l.curTrap.insects.forEach(v=>{a+=v.count}),a}),Q=le(()=>k.value>l.curTrap.danger_treshold),n=le(()=>k.value>l.curTrap.warning_treshold),H=le(()=>Math.floor(k.value/l.curTrap.danger_treshold*100));he(async()=>{l.curTrap?(ce(),se(),s(),r()):(y=!0,_=!0),L.value=!1}),N(()=>q.darkMode,async()=>{s(!0),r(!0)}),N(()=>l.curTrap,async()=>{ce(),se(),s(),r()});function se(){h.value=[];const a=new Date,v=365;a.setDate(new Date().getDate()-v);for(let c=0;c<v;c++){const D=new Date(a);D.setDate(D.getDate()+c);const T=[];l.curTrap.insects.forEach(W=>{T.push({id:W.id,name:W.name,count:Math.floor(Math.random()*25)+1})});const G={insects:T,date:D};h.value.push(G)}}function ce(){const a=Math.floor(Math.random()*25)+1;S.value=[{name:"Batteria",value:l.curTrap.battery.toString(),unit:"%"},{name:"Segnale",value:l.curTrap.signal.toString(),unit:"%"},{name:"Ultima cattura",value:a.toString(),unit:"gg fa"}]}function s(a=!1){if(l.curTrap.insects.length===0){y=!0;return}const v=l.curTrap.insects,c=Se("color-bg-100");J=[],b=[],M=[];const D={id:"insects",name:"Insetti",radius:["82%","90%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:c,borderWidth:4},label:{show:!1,position:"center"},emphasis:{label:{show:!1,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},type:"pie",data:[]};v.forEach(T=>{M.findIndex(G=>G.type_id===T.id)===-1&&M.push({type_id:T.id,type_description:T.name,colorIndex:0,count:0})}),M.forEach((T,G)=>{let W=0;v.forEach(de=>{de.id===T.type_id&&(W=W+de.count)}),T.count=W,T.colorIndex=G,J.push(T.type_description),D.data.push({value:T.count,name:T.type_description})}),b.push(D),d(),a&&R.value++}N(()=>A.value,async()=>{r()});const t=le(()=>{if(h.value.length===0)return[];const a=[];let v=new Date;h.value.length>0&&(v=new Date(h.value[h.value.length-1].date));let c=0;return A.value==="Anno"?c=365:A.value==="Mese"?c=30:A.value==="Settimana"&&(c=7),v.setDate(new Date().getDate()-c),v.setHours(0,0,0,0),h.value.forEach(D=>{const T=new Date(D.date);T.setHours(0,0,0,0),T.getTime()>v.getTime()&&a.push(D)}),a});function r(a=!1){if(t.value.length===0){_=!0;return}Se("color-bg-100"),$=[],V=[];const v=[],c=[];t.value[0].insects.forEach(D=>{v.findIndex(T=>T.id===D.id)===-1&&v.push({id:D.id,name:D.name})}),v.forEach((D,T)=>{const G={id:"line_"+D.id,name:D.name,smooth:!0,lineStyle:{width:2},symbolSize:6,type:"line",data:[]};c.push(G)}),t.value.forEach(D=>{const T=new Date(D.date);$.push(new De(T).format("dd/MM")),D.insects.forEach(G=>{const W=c.findIndex(de=>de.id==="line_"+G.id);W!==-1&&c[W].data.push(G.count)})}),V.push(...c),i(),a&&B.value++}function d(){U.value={grid:{top:12,right:24,left:24,bottom:20,containLabel:!0},tooltip:{trigger:"none"},legend:{show:!1,selectedMode:!1},series:b,textStyle:{fontFamily:"Work Sans"}}}function i(){x.value={grid:{top:12,right:0,left:0,bottom:0,containLabel:!0},tooltip:{trigger:"axis",confine:!0},legend:{show:!1},xAxis:{type:"category",data:$},yAxis:[{type:"value",name:"",position:"left"}],series:V,textStyle:{fontFamily:"Work Sans"}}}function u(a,v){return new De(a).format(v)}return(a,v)=>(o(),f("div",St,[e("button",{type:"button",onClick:v[0]||(v[0]=c=>O("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},It),e("div",Bt,[e("div",Ft,[e("div",Vt,[e("div",Lt,[e("h1",Ut,[e("span",Mt,g(a.curTrap.type),1)])]),e("p",Rt,g(a.curTrap.name),1)]),e("div",{class:w(["order-first flex-none rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset sm:order-none",{"bg-green-500/20 text-green-700 ring-green-400/30":!n.value,"bg-orange-500/20 text-orange-700 ring-orange-400/30":n.value&&!Q.value,"bg-red-500/20 text-red-700 ring-red-400/30":Q.value}])}," Saturazione al "+g(H.value)+"% ",3)]),e("div",Qt,[e("div",zt,[(o(!0),f(X,null,K(S.value,(c,D)=>(o(),f("div",{key:c.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Yt,g(c.name),1),(o(),f("p",{class:"flex items-baseline gap-x-2",key:c.value},[e("span",Nt,g(c.value),1),c.unit?(o(),f("span",Ot,g(c.unit),1)):z("",!0)])),c.name==="Batteria"?(o(),f("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":a.curTrap.battery>=75,"bg-orange-50":a.curTrap.battery>=50&&a.curTrap.battery<75,"bg-red-50":a.curTrap.battery<50}]),key:a.curTrap.id},[I(te,{appear:"",onBeforeAppear:ee,onAfterAppear:ae},{default:C(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curTrap.battery>=75,"bg-orange-400":a.curTrap.battery>=50&&a.curTrap.battery<75,"bg-red-400":a.curTrap.battery<50}])},null,2)]),_:1})],2)):z("",!0),c.name==="Segnale"?(o(),f("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":a.curTrap.signal>=75,"bg-orange-50":a.curTrap.signal>=50&&a.curTrap.signal<75,"bg-red-50":a.curTrap.signal<50}]),key:a.curTrap.id},[I(te,{appear:"",onBeforeAppear:ne,onAfterAppear:E},{default:C(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curTrap.signal>=75,"bg-orange-400":a.curTrap.signal>=50&&a.curTrap.signal<75,"bg-red-400":a.curTrap.signal<50}])},null,2)]),_:1})],2)):z("",!0)]))),128))])])]),e("div",$t,[e("div",Ht,[P.value==="chart"?(o(),f("div",Gt,[e("div",jt,[e("div",Xt,[Kt,e("span",Jt,g(k.value),1)]),L.value?z("",!0):(o(),Z(Ee,{key:0,options:U.value,loading:L.value,"no-data":j(y),"disable-theme-refresh":!0,rebuild:R.value},null,8,["options","loading","no-data","rebuild"]))]),e("div",Wt,[e("div",Zt,[I(Ae,{onUpdate:v[1]||(v[1]=c=>P.value=c),"cur-value":P.value},null,8,["cur-value"])]),(o(!0),f(X,null,K(j(M).sort((c,D)=>D.count-c.count),c=>(o(),f("div",qt,[e("div",ea,[e("div",{class:"mr-2 h-3 w-3 rounded-sm",style:Le("background: "+j(p)[c.colorIndex])},null,4),e("span",ta,g(c.type_description),1)]),e("div",null,[e("span",aa,g(c.count),1)])]))),256))])])):(o(),f("div",na,[e("div",sa,[I(Ae,{onUpdate:v[2]||(v[2]=c=>P.value=c),"cur-value":P.value},null,8,["cur-value"])]),I(ke,{items:j(M),"is-compact":"","full-width":""},{header:C(()=>[ra,oa]),rows:C(({item:c})=>[e("td",null,g(c.type_description),1),e("td",null,g(c.count),1)]),_:1},8,["items"])]))]),e("div",la,[e("div",ia,[I(et,{values:F,onUpdate:v[3]||(v[3]=c=>A.value=c),"cur-value":A.value},null,8,["cur-value"]),I(Ae,{onUpdate:v[4]||(v[4]=c=>Y.value=c),"cur-value":Y.value},null,8,["cur-value"])]),Y.value==="chart"?(o(),f("div",ca,[e("div",da,[L.value?z("",!0):(o(),Z(Ee,{key:0,options:x.value,loading:L.value,"no-data":j(_),"disable-theme-refresh":!0,rebuild:B.value},null,8,["options","loading","no-data","rebuild"]))])])):(o(),f("div",ua,[I(ke,{items:t.value,"is-compact":"","full-width":""},{header:C(()=>[e("th",null,g(t.value[0].insects[0].name),1),fa]),rows:C(({item:c})=>[e("td",null,g(c.insects[0].count),1),e("td",null,g(u(c.date,"dd/MM")),1)]),_:1},8,["items"])]))])])]))}}),pa={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},ha=e("span",{class:"sr-only"},"Chiudi pannello",-1),ma=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),va=[ha,ma],ya={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},_a={class:"flex w-6/12 items-center border-r pr-6"},xa={class:"flex flex-grow flex-col"},ba={class:"flex items-center gap-x-3"},wa={class:"flex gap-x-3 text-lg leading-7"},Aa={class:"font-semibold"},Da={class:"mt-2 text-sm leading-6 text-label"},Ta={class:"flex w-6/12"},Ca={class:"flex w-full divide-x divide-border"},Pa={class:"text-sm font-medium leading-6 text-label"},Sa={class:"text-3xl font-medium tracking-tight text-text"},Ea={key:0,class:"text-sm text-label"},ka={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Ia={class:"flex flex-grow h-full"},Ba={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Fa={class:"flex w-full flex-col items-center justify-center pt-2 pb-4"},Va={class:"flex items-center pb-6 pt-4"},La={class:"mr-5 border-ra pr-4a"},Ua={class:"text-5xl font-extralight"},Ma={class:"relative inline-flex items-center text-blue-400"},Ra={class:"mt-2 mb-4 flex flex-col md:flex-row w-full rounded-lg text-sm"},Qa={class:"text-sm font-light uppercase tracking-wider"},za={class:"text-xl"},Ya={class:"flex w-full text-sm border-t pt-4"},Na={class:"w-full pb-2 text-center text-xs font-light uppercase tracking-wider"},Oa={class:"w-full pb-1 text-center"},$a={class:"w-full pl-1 text-center"},Ha={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Ga={role:"list",class:"space-y-6 py-6"},ja=e("div",{class:"w-px bg-gray-200"},null,-1),Xa=[ja],Ka=e("div",{class:"relative flex h-6 w-6 flex-none items-center justify-center bg-bg-100"},[e("div",{class:"h-2 w-2 rounded-full bg-gray-50 ring-1 ring-gray-200"})],-1),Ja={class:"flex-auto rounded-lg p-3 border"},Wa={class:"flex justify-between gap-x-4"},Za={class:"py-0.5 text-xs leading-5 text-gray-500"},qa={class:"font-medium text-gray-900"},en=["datetime"],tn={class:"text-sm leading-6 text-gray-500"},an={class:"flex flex-col h-full w-60 overflow-auto thin-scrollbar border-r px-6 relative"},nn={class:"flex flex-col items-center w-full py-6"},sn=e("i",{class:"fal fa-wheat"},null,-1),rn=e("i",{class:"fal fa-map"},null,-1),on=e("div",{class:"pb-2 mb-2 w-full"},null,-1),ln=e("i",{class:"fal fa-tractor"},null,-1),cn=e("i",{class:"fal fa-notebook"},null,-1),dn=pe({__name:"plotResumePanel",props:{curParcel:{}},emits:["close"],setup(l,{emit:O}){Ie();const q=Ue(),L=m(!0);m(null),m("Mese"),m("chart"),m(0);const y=[{id:0,comment:"Notati nugoli di insetti lungo il filare",date:"3 gg fa",dateTime:"2023-01-23T15:56"},{id:1,comment:"I nugoletti sono stati eliminati con un trattamento chimico",date:"5 gg fa",dateTime:"2023-01-23T15:56"},{id:2,comment:"Nugoli di insetti nuovamente notati",date:"7 gg fa",dateTime:"2023-01-23T15:56"},{id:3,comment:"I nugoli si fanno sempre più numerosi, urgono rinforzi",date:"13 gg fa",dateTime:"2023-01-23T15:56"},{id:4,comment:"I nugoli si stanno evolvendo in una vera e propria invasione",date:"15 gg fa",dateTime:"2023-01-23T15:56"},{id:5,comment:"Dite a tutti di stare attenti, i nugoletti sono molto pericolosi",date:"18 gg fa",dateTime:"2023-01-23T15:56"},{id:6,comment:"Non so se ce la farò, sono troppi",date:"21 gg fa",dateTime:"2023-01-23T15:56"},{id:7,comment:"I nugoletti hanno oscurato il cielo, non vedo più il sole",date:"23 gg fa",dateTime:"2023-01-23T15:56"}],_=m([]),U=m([]),x=m([]),A=m({id:"rainy",temp:"14°",icon:"fa-cloud-showers",theme:"weather-widget-rain"});function P(h){h.style.height=0}function Y(h){h.style.height=`${l.curParcel.cultivatedPercentage}%`,h.style.transition="height 1s ease-out"}he(async()=>{if(l.curParcel){const h=new Date,S=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],p=["fa-cloud-showers","fa-cloud-bolt","fa-cloud-fog","fa-sun-bright","fa-sun-bright"];for(let b=1;b<=5;b++){const V=new Date(h);V.setDate(V.getDate()+b);const J=Math.floor(Math.random()*15)+10;x.value.push({day:S[V.getDay()],icon:p[b-1],temp:J+"°"})}R(),B()}L.value=!1}),N(()=>l.curParcel,async()=>{R(),B()});function R(){_.value=[{name:"Coltivato",value:l.curParcel.cultivatedPercentage.toString(),unit:"%"},{name:"Area",value:l.curParcel.area.toString(),unit:"ha"},{name:"Indice NDVI",value:(l.curParcel.ndvi_change_type==="decrease"?"-":"+")+l.curParcel.ndvi_change.toString(),unit:"da ieri"}]}function B(){const h=Math.floor(Math.random()*50),S=Math.floor(Math.random()*20),p=Math.floor(Math.random()*20),b=Math.floor(Math.random()*20)+10;U.value=[{name:"Precipitazioni",value:h+" mm"},{name:"Vento",value:S+" km/h"},{name:"Temperature",value:p+"° - "+b+"°"}]}return(h,S)=>(o(),f("div",pa,[e("button",{type:"button",onClick:S[0]||(S[0]=p=>O("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},va),e("div",ya,[e("div",_a,[e("div",xa,[e("div",ba,[e("h1",wa,[e("span",Aa,g(h.curParcel.name),1)])]),e("p",Da,g(h.curParcel.cropDescription),1)])]),e("div",Ta,[e("div",Ca,[(o(!0),f(X,null,K(_.value,(p,b)=>(o(),f("div",{key:p.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Pa,g(p.name),1),(o(),f("p",{class:"flex items-baseline gap-x-2",key:p.value},[e("span",Sa,g(p.value),1),p.unit?(o(),f("span",Ea,g(p.unit),1)):z("",!0)])),p.name==="Coltivato"?(o(),f("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-100":h.curParcel.cultivatedPercentage>=75,"bg-orange-100":h.curParcel.cultivatedPercentage>=50&&h.curParcel.cultivatedPercentage<75,"bg-red-100":h.curParcel.cultivatedPercentage<50}]),key:h.curParcel.parcel_id},[I(te,{appear:"",onBeforeAppear:P,onAfterAppear:Y},{default:C(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":h.curParcel.cultivatedPercentage>=75,"bg-orange-400":h.curParcel.cultivatedPercentage>=50&&h.curParcel.cultivatedPercentage<75,"bg-red-400":h.curParcel.cultivatedPercentage<50}])},null,2)]),_:1})],2)):z("",!0),I(te,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":h.curParcel.ndvi_change_type==="increase"?"translate-y-2 opacity-0":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100"},{default:C(()=>[p.name==="Indice NDVI"?(o(),f("div",{class:"absolute h-12 w-12 top-2 right-0",key:h.curParcel.parcel_id},[h.curParcel.ndvi_change_type==="increase"?(o(),Z(j(Fe),{key:0,class:"h-full w-full text-green-200","aria-hidden":"true"})):(o(),Z(j(Be),{key:1,class:"h-full w-full text-red-100","aria-hidden":"true"}))])):z("",!0)]),_:2},1032,["enter-from-class"])]))),128))])])]),e("div",ka,[e("div",Ia,[e("div",Ba,[e("div",Fa,[e("div",Va,[e("div",La,[e("span",Ua,g(A.value.temp),1)]),e("div",Ma,[e("i",{class:w(["fa-solid relative z-10 text-5xl",A.value.icon]),style:{"font-size":"44px"}},null,2)])]),e("div",Ra,[(o(!0),f(X,null,K(U.value,(p,b)=>(o(),f("div",{class:w(["flex flex-grow md:flex-col px-4 py-2 md:py-0 justify-between md:justify-normal items-center md:items-start",b<U.value.length-1?"border-b md:border-b-0 md:border-r":""])},[e("span",Qa,g(p.name),1),e("span",za,g(p.value),1)],2))),256))]),e("div",Ya,[(o(!0),f(X,null,K(x.value,(p,b)=>(o(),f("div",{class:w(["flex flex-grow flex-col px-4",b<x.value.length-1?"border-r":""])},[e("span",Na,g(p.day),1),e("span",Oa,[e("i",{class:w(["fa-solid relative z-10 text-xl text-blue-300",p.icon])},null,2)]),e("span",$a,g(p.temp),1)],2))),256))])])]),e("div",Ha,[e("ul",Ga,[(o(),f(X,null,K(y,(p,b)=>e("li",{key:p.id,class:"relative flex gap-x-4"},[e("div",{class:w([b===y.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"])},Xa,2),Ka,e("div",Ja,[e("div",Wa,[e("div",Za,[e("span",qa,g(b%2===0?j(q).name:"Tu"),1),oe(" "+g(b%2===0?"ha":"hai")+" scritto ",1)]),e("time",{datetime:p.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-gray-500"},g(p.date),9,en)]),e("p",tn,g(p.comment),1)])])),64))])])]),e("div",an,[e("div",nn,[I(ge,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:C(()=>[sn]),default:C(()=>[oe("Modifica colture")]),_:1}),I(ge,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:C(()=>[rn]),default:C(()=>[oe("Vedi dettagli")]),_:1}),on,I(ge,{"is-success":"","is-outlined":"",class:"w-full mb-3"},{icon:C(()=>[ln]),default:C(()=>[oe("Crea attività")]),_:1}),I(ge,{"is-success":"","is-outlined":"",class:"w-full"},{icon:C(()=>[cn]),default:C(()=>[oe("Aggiungi nota")]),_:1})])])])]))}}),un=[{id:-4,date:new Date(new Date().setDate(new Date().getDate()-12)),isPresent:!0},{id:-3,date:new Date(new Date().setDate(new Date().getDate()-11)),isPresent:!0},{id:-2,date:new Date(new Date().setDate(new Date().getDate()-10)),isPresent:!0},{id:-1,date:new Date(new Date().setDate(new Date().getDate()-9)),isPresent:!0},{id:0,date:new Date(new Date().setDate(new Date().getDate()-8)),isPresent:!0},{id:1,date:new Date(new Date().setDate(new Date().getDate()-7)),isPresent:!1},{id:2,date:new Date(new Date().setDate(new Date().getDate()-6)),isPresent:!1},{id:3,date:new Date(new Date().setDate(new Date().getDate()-5)),isPresent:!0},{id:4,date:new Date(new Date().setDate(new Date().getDate()-4)),isPresent:!0},{id:5,date:new Date(new Date().setDate(new Date().getDate()-3)),isPresent:!0},{id:6,date:new Date(new Date().setDate(new Date().getDate()-2)),isPresent:!1},{id:7,date:new Date(new Date().setDate(new Date().getDate()-1)),isPresent:!0},{id:8,date:new Date,isPresent:!0}];const me=l=>(ze("data-v-0f86be83"),l=l(),Ye(),l),fn={class:"relative flex h-full w-full"},gn={class:"flex flex-col w-96 bg-green-25 rounded-l-lg overflow-auto thin-scrollbar relative"},pn={class:"flex w-full sticky top-0 pt-6 px-4 justify-between bg-green-25 z-10 pb-4"},hn={class:"flex flex-grow space-x-4 overflow-y-auto","aria-label":"Tabs"},mn=["onClick","aria-current"],vn={class:"border-l border-green-200 ml-3 pl-3"},yn=me(()=>e("i",{class:"fal fa-pen-to-square",style:{"margin-top":"-3px"}},null,-1)),_n=[yn],xn={class:"flex flex-col w-full pt-4 rounded-t-2xl bg-bg-100 flex-grow"},bn={key:0,role:"list",class:"divide-y divide-border"},wn=["onClick"],An={class:"flex max justify-between px-4"},Dn={class:"flex"},Tn={class:"flex flex-col"},Cn={class:"text-sm font-semibold leading-6 text-gray-900"},Pn={class:"mt-1 flex text-sm leading-7 text-gray-500"},Sn={class:"flex items-center"},En={class:"hidden sm:flex sm:flex-col sm:items-end"},kn={class:"text-sm leading-6 text-gray-900"},In={class:"mt-1 flex items-center"},Bn={class:"sr-only"},Fn={key:1,role:"list",class:"divide-y divide-border"},Vn=["onClick"],Ln={class:"flex max justify-between px-4"},Un={class:"flex"},Mn={class:"flex flex-col"},Rn={class:"text-sm font-semibold leading-6 text-gray-900"},Qn={class:"mt-1 flex text-xs leading-5 text-gray-500"},zn={class:"flex items-center"},Yn={class:"hidden sm:flex sm:flex-col sm:items-end"},Nn={class:"text-sm leading-6 text-gray-900"},On={class:"mt-1 text-xs leading-5 text-gray-500"},$n={class:"mt-1 flex items-center gap-x-1.5"},Hn=me(()=>e("p",{class:"text-xs leading-5 text-gray-500"},"Saturazione",-1)),Gn={key:2,class:"flex flex-col w-full h-full"},jn={class:"flex flex-col pb-3 border-b px-4"},Xn=me(()=>e("label",{for:"ndviRange",class:"form-label text-sm font-medium mb-2"},"Visibilità",-1)),Kn={class:""},Jn=["onClick"],Wn={class:"flex items-center h-full justify-between px-4"},Zn={class:"flex items-center"},qn={class:"text-sm font-semibold leading-6 text-gray-900"},es={key:0,class:"flex items-center"},ts={class:"flex flex-col flex-grow relative overflow-hidden"},as=me(()=>e("div",{class:"h-full w-full bg-green-200 absolute"},null,-1)),ns=pe({__name:"index",setup(l){const O=[{name:"Appezz.",id:"plots",icon:"fa-map"},{name:"Trappole",id:"traps",icon:"fa-mosquito"},{name:"Ndvi",id:"ndvi",icon:"fa-satellite"}],q=m(!1),L=m(qe),y=m(null),_=m(Pt),U=m(Ct),x=m(null),F=m(un),A=m(F.value[F.value.length-1]),P=m(0),Y=m(0),R=m(10),B=m(O[0].id),h=m(!1),S=m(!1),p=m(!1);he(()=>{Me(()=>{q.value=!0})});function b(){h.value=!0}N(()=>B.value,()=>{S.value=!1,x.value=null,p.value=!1,y.value=null}),N(()=>x.value,()=>{x&&(S.value=!0)}),N(()=>y.value,()=>{y.value&&(p.value=!0)});function V(){S.value=!1,x.value=null}function J(){p.value=!1,y.value=null}function $(E){let k=0;return E.insects.forEach(Q=>{k+=Q.count}),k}function M(E){return $(E)>E.danger_treshold}function ee(E){return $(E)>E.warning_treshold}function ae(E){return Math.floor($(E)/E.danger_treshold*100)}function ne(E,k){return new De(E).format(k)}return(E,k)=>{const Q=Re("bf-tooltip");return o(),f("div",fn,[e("div",gn,[e("div",pn,[e("nav",hn,[(o(),f(X,null,K(O,n=>e("button",{role:"tab",key:n.id,onClick:H=>B.value=n.id,class:w([(B.value===n.id,""),"group flex flex-col items-center space-y-1"]),"aria-current":B.value===n.id?"page":void 0},[e("span",{class:w([B.value===n.id?"border-green-600 bg-green-600 text-green-50":"border-transparent group-hover:border-green-400 text-green-500","flex flex-col items-center justify-center border-2 w-14 h-14 bg-green-400/20 transition-colors-default rounded-full"])},[e("i",{class:w(["fal",n.icon])},null,2)],2),e("span",{class:w([B.value===n.id?"text-green-700":"group-hover:text-green-700","text-sm font-medium text-gray-500 transition-colors-default"])},g(n.name),3)],10,mn)),64))]),e("div",vn,[ie((o(),f("button",{onClick:b,class:"border-transparent hover:bg-green-400/20 rounded-md h-full text-green-500 flex text-xl px-4 items-center justify-center transition-colors-default"},_n)),[[Q,"Aggiungi/rimuovi"]])])]),e("div",xn,[I(te,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:C(()=>[B.value==="plots"?(o(),f("ul",bn,[(o(!0),f(X,null,K(L.value,n=>(o(),f("li",{class:w(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":y.value&&y.value.parcel_id===n.parcel_id}]),onClick:H=>{S.value=!1,x.value=null,y.value=!y.value||y.value&&y.value.parcel_id!==n.parcel_id?n:null,Y.value++}},[e("div",An,[e("div",Dn,[e("div",Tn,[e("p",Cn,g(n.name),1),e("p",Pn,g(n.cropDescription),1)])]),e("div",Sn,[e("div",En,[e("p",kn,g(n.area)+" ha",1),e("div",In,[ie((o(),f("div",{class:w([n.ndvi_change_type==="increase"?"bg-green-50 text-green-800":"bg-red-50 text-red-800","inline-flex items-baseline rounded-full px-2.5 py-0.5 text-sm font-medium md:mt-2 lg:mt-0"])},[n.ndvi_change_type==="increase"?(o(),Z(j(Fe),{key:0,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-green-500","aria-hidden":"true"})):(o(),Z(j(Be),{key:1,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-red-500","aria-hidden":"true"})),e("span",Bn,g(n.ndvi_change_type==="increase"?"Aumendo":"Diminuzione")+" del ",1),oe(" "+g(n.ndvi_change),1)],2)),[[Q,n.ndvi_change_type==="increase"?"Aumendo indice NDVI da ieri":"Diminuzione indice NDVI da ieri"]])])])])])],10,wn))),256))])):B.value==="traps"?(o(),f("ul",Fn,[(o(!0),f(X,null,K(_.value,n=>(o(),f("li",{class:w(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":x.value&&x.value.id===n.id}]),onClick:H=>{p.value=!1,y.value=null,x.value=!x.value||x.value&&x.value.id!==n.id?n:null,P.value++}},[e("div",Ln,[e("div",Un,[e("div",Mn,[e("p",Rn,g(n.type),1),e("p",Qn,g(n.name),1)])]),e("div",zn,[e("div",Yn,[e("p",Nn,g($(n))+" catture ",1),e("p",On," Ultima cattura "+g(ne(n.last_capture,"dd/MM")),1),e("div",$n,[ie((o(),f("div",{class:w(["flex-none rounded-full p-1",{"bg-green-500/20":!ee(n),"bg-orange-500/20":ee(n)&&!M(n),"bg-red-500/20":M(n)}])},[e("div",{class:w(["h-1.5 w-1.5 rounded-full",{"bg-green-500":!ee(n),"bg-orange-500":ee(n)&&!M(n),"bg-red-500":M(n)}])},null,2)],2)),[[Q,ae(n)+"%"]]),Hn])])])])],10,Vn))),256))])):(o(),f("div",Gn,[e("div",jn,[Xn,ie(e("input",{"onUpdate:modelValue":k[0]||(k[0]=n=>R.value=n),type:"range",class:"form-range",min:"0",max:"10",step:"0.1",id:"ndviRange"},null,512),[[Qe,R.value]])]),e("ul",Kn,[(o(!0),f(X,null,K(F.value.sort((n,H)=>H.date.getTime()-n.date.getTime()),n=>(o(),f("li",{class:w(["relative py-4 transition-colors-default border-b",{"!bg-gray-100":A.value&&A.value.id===n.id,"hover:bg-gray-50 cursor-pointer":n.isPresent}]),onClick:H=>n.isPresent?A.value=!A.value||A.value&&A.value.id!==n.id?n:null:"",style:{height:"73px"}},[e("div",Wn,[e("div",Zn,[e("p",qn,g(ne(n.date,"dd/MM")),1)]),n.isPresent?z("",!0):(o(),f("div",es,[ie((o(),f("div",{class:w(["flex items-center justify-center w-12 h-12 rounded-full text-xl",n.isPresent?"bg-teal-50 text-teal-400":"bg-gray-50 text-gray-400"])},[e("i",{class:w(["fal",n.isPresent?"fa-check":"fa-clouds"])},null,2)],2)),[[Q,n.isPresent?"NDVI presente":"È stata scattata un'immagine satellitare in questo giorno, ma l'indice di vegetazione NDVI non può essere calcolato. Ciò può accadere a causa della copertura nuvolosa, della foschia, della neve o di altri fattori."]])]))])],10,Jn))),256))])]))]),_:1})])]),e("div",ts,[as,I(te,{"enter-active-class":"transition duration-300 ease-out delay-500","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:C(()=>[q.value?(o(),Z(Tt,{key:0,parcels:L.value,curParcel:y.value,traps:_.value,curTrap:x.value,zoomOnTrap:P.value,zoomOnPlot:Y.value,onSelectTrap:k[1]||(k[1]=n=>{p.value=!1,y.value=null,x.value=!x.value||x.value&&x.value.id!==n.id?n:null}),onSelectParcel:k[2]||(k[2]=n=>{S.value=!1,x.value=null,y.value=!y.value||y.value&&y.value.parcel_id!==n.parcel_id?n:null})},null,8,["parcels","curParcel","traps","curTrap","zoomOnTrap","zoomOnPlot"])):z("",!0)]),_:1}),I(te,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:C(()=>[S.value&&x.value?(o(),Z(ga,{key:0,curTrap:x.value,insectTypes:U.value,onClose:V},null,8,["curTrap","insectTypes"])):z("",!0)]),_:1}),I(te,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:C(()=>[p.value&&y.value?(o(),Z(dn,{key:0,curParcel:y.value,onClose:J},null,8,["curParcel"])):z("",!0)]),_:1})])])}}}),vs=st(ns,[["__scopeId","data-v-0f86be83"]]);export{vs as default};

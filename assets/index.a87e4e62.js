import{o as c,c as d,a as e,d as pe,e as we,N as Ve,g as O,v as Be,r as f,b as se,j as g,n as b,u as _,F as X,z as j,q as Y,A as P,y as D,T as q,x as J,M as Fe,C as Le,B as te,l as re,X as Ue,k as Me,Y as Qe,Z as Re}from"./index.f99e0b73.js";import{T as ze,B as Ye,d as Oe,C as Ne,W as He,V as de,e as he,f as me,h as ve,v as Ge,i as De,j as Xe,k as ee,l as Ce,P as xe,I as ue,q as Ae,o as je,r as ye,u as $e,s as Ke,t as Je,a as be,b as Te,_ as We,p as Ze}from"./parcelData.1b9b3687.js";import{a as Pe,g as Se,D as fe,_ as Ee,t as qe,b as et}from"./Colors.6c965194.js";import{_ as ge}from"./BfButton.af77c858.js";import"./use-outside-click.5f4162e4.js";function ke(a,N){return c(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})])}function Ie(a,N){return c(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})])}var tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAA8klEQVQYlXWQsUrDUBRAz325NoFgitjBoXUp4hKh4ObU2dVPKM5+UD7BxcGlnQRHlw5ZFAQVUREtEk1raGocntUY7ZkevMPh3isHDQVg/2RY8EXU7QgVTFVahMRx/C35rZDsAy4TGGzrr6qZP2ZrIZ4DroEVFxr9vPgjes0QAMfAqge+wrQyjAH7oQJXr3A3hjSHjWW4iH6qJup2xF+C+zEcXcPxDdy+QVCDnfVKMZ3C2ROkuyrDEYwyW20HsHVqqzK/Y5nnw7zYDKzoOpDNSluXeUngPLGCit3hX7HdU1EDDxM7QtNfIALU91Qe3221XoNPcCBLMI6LQyMAAAAASUVORK5CYII=",at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABeElEQVQokW3SO2tUURTF8d+9nntnxjiJQpABUQz4wEY/gSIIYi1ptbIX7Cxt7GwEsbARBCtBOz+ApcRCUFQIQQIS8pyZZN535lqc0RHMqc5ZsNbe+392cn8xgI9PijLP2dig02FwQDHgzquQOOQE+PGiKK+fYrPPeEy1xrBOeoQPj4uy22H9K/fezkLSny+L8tpZTlYJaRQnE0JGnjNfp9Fg6QrvHhTlX+OtJS4scCxjPmOhTppSjOh2WFtjdZXhIHbw/mE0h3PzDCYcDdQDi8fZbcaq/R69Nr09DirkdfJarJh821N+2mZ3EIVfXb7vsLZOq0W3Tb8VQUHtBI0zpM/Ph2QusDdgfxTnzLMZvTSLlUKFcREDdranVK822OrzpRnNzX2yjCzQG0/xV2dhy09DEuDR6ZAsfy7KrX4MqEwhjUa0m4y6lGPuvp59R/hzeXM5JDdXinKzHwkXk6gPh9x49v8ShH8fFxdoDWkP46xzt0Ny6bC1wW8e44quL8wQiQAAAABJRU5ErkJggg==",nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABGklEQVQYlV2QMUvDUBSFv5e8hAYbjWkGkzRoEQdBcHUTcXcUdxdBpZOIINJR8EfojxCcHN106lrFyUWkYK1pk9fE4VWLvXC4cPk499wrmoEE4HpXlZYDyQpsnkvBVBkAN3uqrC1C2IDvPjxcqnIaFHNHlH4C4QJUZyDL4bMH3S7sXE2cDS8C19WQ58JSBI0E6jHcnU2cjXkfBil89fVAFeBUoOZBUofbUw2LZiC5b6nSMCAOtatpQpbBqIBhBp2X8THbLSkGKaQDGI20bFtvCDyII5C/GaJI9ywHx4SqpaUKeP8YOwKsH0thW9AbZ/VtmLWg/QxbF1L8gQCrB1I4FR3hLYWnV9g40S/6BwIs70sxzOGxDWuHkz/+AMEfTy2fWGeUAAAAAElFTkSuQmCC",st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABXklEQVQokV3Sv44SURTH8Q/MMLAgEkSCmqw2xsJiY+Nb2NlZ2Vib+Ah2PoCW1lv6BvoGFj6Aru6yYUGRsPwbZgaLC4H4S07uOffmm5zfL7f0+nYMPr/NNpCuGJ6T1Ll7zMMHTOc8ehWXHKh08sEGkoRuh2qFn/3w2Ovy9JisoL+g9XwPlwcXxDF3ujTr3Ghwr0e7FWa43+BJm6vTsBXExZrlgus59Vq4rCahoD/nZoVOlcdtvrzPNt++Un7xMS5NJlzPSNekaQCicjhnKWczzmdMM6KISp0YakeMxxzVaDWJowAlFfKcwZTRnMWSqxHLCWV49i6YHg7585fVOgB5Tl4wXzKdhcoyivUW3MHrjOUqrJvlAVile99JQq1G0jwAd/B4zO9xmPNim2C0951lZEtKuw9wqE9vsk2jEfpOJ3iPIi4uufxBOt+G87/WK36dURSMOtzqhX7wnZenIY9/RoeHctXEeSgAAAAASUVORK5CYII=",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAYAAAD+Bd/7AAAAmElEQVQImS3MMWoCUQAA0ffX75J1NZUE0gQhrZdIn1K8huAB0od0uYBX8FARBIkKZl2V1bX4qQZmYMJsGC2mTfvwSKdLXpB1uJyZfMcQF9OmHY3pl8D1lljXieH1Szt64fmJ+sShSuGvYrUie/+MYfOb4qDH4P+U5xQFGVQVP2sOR44ntnu2O2KXMBtGsJw3bVkmCW8fMcAdpnwsOXDzZHAAAAAASUVORK5CYII=",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAYAAAAvg9c4AAADGElEQVQ4jY2Vu28cVRSHv5l7x7Mzs+ud9a6XXeJAgmUhBYeHeCRSihRINAiJAiSIxB9ARRmK0FHQICFqCkQXCkSBKKBCAoFEeIkiFBESmOBX/Fjvzu7Mzt25FGftGOKxudLojnTv+e5vzj3nN84bLU3Z+PAVY/0qeCHkQ3j1A+2Ubj40nKOgH10x1lGgPPAC8HzwfUgSeOn9k8H/In7/rrHrG+CuQZEDngDrMQQBtFr/R+cU2vnSWM+F3i6Mc0hHYDKwE8gz2VgNQSn45h1jL715vFr3hZ+MfaIJ8Qzs9mGYgOvKs5+CagSTQgKMga/eNvZYaOiBr2AhggunoN2GWg0cF0wKwx1YXYNBIgHd+wR8LLQbgHZgYuFcDM88BGEkCpUnue2tweYG3NkWeKsJn10tV+u+t6idUEOoYc6H8zF05mXRUVJOjguDLQH39mA8hiiCj18/GnxQUs/9YGySg7HwWw8++Q621qHYz2UKroJqE/wZyfnOHej95VCJLY4Lp5fg8jXtHJRUw4ckh6GBByJ4eBF+zSCb3n6uwRaQDiBzpdQqVXDPWup10B7c/l1q/AB6fVk7L/5ibGIgMfBUB7Ix/Hlb1oMA+nuwuy1wV0kKGg1ozUFYkeZIR/8p/k8f086Fb43tjaHmwaNdGAxhlEJ3HiYTCSwKqZBOG5oxLMUQKMhyyfk9PXo6gj8G8PcA2j6cfxBurctaNQLVFfhcDBfPwP0BdEPYTCGuwep6Se8//rWxP25DYwZmPbjVh+0EzsRQ09A3Mi/OSsVMLGyM4GYPsucPXdTh0Q5Ewc5Y5uUYfi4gL+BcAyoK0sndLlsZwMAIEMA9CvrFk9rpTJvCWIg0XJyHdgVWh+C7UJ924uZIgCvP3vWDUjNtB5BNJNBX0wMKuLElwIUqzM7IIYeBpUr31T49L4GRBuXKe6Dh8xVR6Cu4eflexyq3fWCpLs1gLOyNYXMsipWSr7i+fLQFlioFeOuUdrqhAIyVi+vnsnbjUrmnHgsFscTVIQxz2EhhJ4HmyyeY9EnQq13tPNKArUxULrx28j/qH3hsHP+6HLkeAAAAAElFTkSuQmCC",ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAWCAYAAADNX8xBAAAB5ElEQVQ4jZ3UTWsTURTG8f+9cyevTYO1RDoqFUQt6iIYXIkSdJmNIEpBBDcuXNWtX8DPIGTRb9CF4AuCK5euxHahoNWWCFralCbTJNM7GReHtNa0zYwHBubexY/nHM6Mmps05F/ZaCOArAOdENK3jSJhqedLRDaCogu+hbUuNDrJMf15C1o7kHZgPAUFF6bz0H9ho0SQq+FrC353oReC0dLi2TEovomP6V7NKKMllW8h48CYK08ziJ9Mg8xjaRO6oVw6CmwfLhVheS1mosFLEEh7ti9no2Vm1TPw/tnoVLvQ1H2jVlvwrQ1hJOC2BS8H1y7D66dHY/rvQ2nWqE8/4WMT2hbaO7AVQCkNnhcz0aDOPzLqVwsa22AjGXgnhNJEQmjQ5vI6bPT27k6Ow8KTw9s7EAKYfmjUii87VXBhIgWVMszfOxg7FAI4fteoH75ABRcqU3DlOtRr4RBmjoIAVjbB1eBlBbtxDtp+BC8TJAI49UA+3k4oW+9lYfYqfKnvb3EkBNCrGdUMZPONhhMZuDMD/sIeFgsCKGUklaMg58LFY/B4Bm5+EEzNTY4c026dfmcjLwcXirLx698Xk7U2qNVbRhVTkHf3I4khgLcVo2xjceg+MQRQr5aHfsP/Bf2L1atl9QeqsqHj3YkKIgAAAABJRU5ErkJggg==",it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAABCElEQVQYlW2RvUoDQRRGz0yuG+KSTTZkQfEPGy20CNhELKzEws4XER/AR1IhhY1Yia2FICmsxB8ChpVEF1yc3bEYJW7YW92Bw5nv3quO2sLo1NjQg/UA+ruiKCmd94zthLAdQVSDpStjy0B1/YoFSDNIDMQp9EeQHhTNeqe5wkboIGNhfhbWgpKvj5dflGgHNGZAFCz6kPeKETTAyYKoVhWqFWfOLNQFkrMJrP+a2yGMv38j5LDVhs3mlBHgpivqLoaGB764GKt18C+cVfOvBntu0sCDinZROi2YuzS2AAKcP7pVZbkbLKpB6E0ZAfxDUffvk/fzJ7x9lYDgzhin8JTAwwcM90X9AG7EUPqOil3VAAAAAElFTkSuQmCC",ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABVElEQVQokX2SO0sDQRSFv5kd3DyMmKABQSGxEdRCxEYESSOCIFj6L/xFVmJl46O3E3yAlYgQLAyBSBINajbuspNdi2sUjXGqO3C/uefcOWpnzACwdGbjlxDKJaP452iA1UsbA9gIiqdSDwRWzm2cT8BsFvJJuHuF4HAwpF0HJtNy6UbQDiHpgD75G9I2hucArhrwFMBCTgAbQ3WvH9K1DhxVoOKJpPksTGfg3UImBfe7PyFdLhlV96WpkIGRIRhPgN+FmREoFf7YkrtllKOgFUAnFDlzozA7KhOj4+8puldUPbhuip+EI81GQ9CFxRzU9gX6AprrRt224DWElIGcK/9iY5hKw2bh1wSA/LZRDR9qHXk5LSHAszCRgqcDG/8AAN5CeGhDEIHriLygC3VffPUB3oZRNgLnM1FZV2TdtOBxzag+oOen6omU4jBcLBvlbUgoPwDYj4IfJzeDcwAAAABJRU5ErkJggg==",dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAHCAYAAAArkDztAAAAj0lEQVQImT3LIQ7CQBRF0fvLz1AMpRWsANFAAt0AEk9SyxbYAptAo9gAHl+FIehaQkARxJB0YBDT8JKrTp5sTnj3haqG2VqFdlGvA0UGywmct87/4WrBecgHsCqg3gXUVwN3C8MYphl0czjsnY+SUsV+4NmE5ziFcgQKcFuocHReBfoGEtMCQGrg8Q5d5io/VTwqesL437MAAAAASUVORK5CYII=",ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABa0lEQVQokXXQMWtTURiH8d+9ObmpJEohttg2qFhEnFwVHNXBXRDByQ/g5GcQV0eHfoZSHUV0sRQK6iAoOKhBi2mjialp09ybOByhNtYXXs45vO/zf+Akd48HDzby8conVpqcrHJ1geULIXFIJfdfGb//GR+dXuy5Ga41eH35Xyhd+8LXTQZDsjJFwZu3LK1z9nk+ngRCrRpTi4Iso1Si26Xd4uk0pyYN9RshaZyg16fVptNlNKS/xeoqg+WDlhSuN9jb43OT9lYcZDW2Wzxb4/yLfSiFtUshma0zzAlljk5TqzN1jB/fePJhwgCzN0MyP0clI6tEsFJjVPCxSfo4WlJ/1WydNI1LkJQIU2xu8PLdhAEat+O/7+ySDxkXMWBc0GoxWsnHBwA4czqeef4nsUypHAOa3ycMsHgnJNttdrsUOflgf9b7dQgAt5ZCstNh2Cc7Ei3zCzy88h8AZhYJlXivVrl4LySPzoXkN4PofZ5v1q44AAAAAElFTkSuQmCC",gt="/new_farmer_dist/assets/trap_green_default.eae67839.svg",ft="/new_farmer_dist/assets/trap_green_selected.14e9082d.svg",pt="/new_farmer_dist/assets/trap_green_hover.a20dce2e.svg",ht="/new_farmer_dist/assets/trap_red_default.fe35d728.svg",mt="/new_farmer_dist/assets/trap_red_selected.8cc04ab2.svg",vt="/new_farmer_dist/assets/trap_red_hover.5aed298a.svg",xt="/new_farmer_dist/assets/trap_orange_default.246ee8e5.svg",At="/new_farmer_dist/assets/trap_orange_selected.b1514d87.svg",yt="/new_farmer_dist/assets/trap_orange_hover.9b8cddc5.svg";const bt=pe({__name:"EntitiesMapViewer",props:{parcels:null,curParcel:null,traps:null,curTrap:null,zoomOnTrap:null,zoomOnPlot:null},emits:["select-trap","select-parcel"],setup(a,{emit:N}){const K="Aerial",v="Ak2gN0iZ3d02J-xwYSYgRp8oHFZCOneWeg_Hj7C2ZntIKTXCGc0HXVQ8GHkuxp17",U=new ze({visible:!0,preload:1/0,source:new Ye({key:v,imagerySet:K})}),M=[{parcelId:12,image:tt,coordX:.4,coordY:.5,scale:14},{parcelId:10,image:at,coordX:.5,coordY:.5,scale:14},{parcelId:2,image:nt,coordX:.53,coordY:.48,scale:14},{parcelId:3,image:st,coordX:.55,coordY:.51,scale:14},{parcelId:11,image:rt,coordX:.55,coordY:.51,scale:14},{parcelId:9,image:lt,coordX:.74,coordY:.51,scale:14},{parcelId:8,image:ot,coordX:.47,coordY:.48,scale:14},{parcelId:6,image:it,coordX:.47,coordY:.48,scale:14},{parcelId:7,image:ct,coordX:.46,coordY:.52,scale:14},{parcelId:13,image:dt,coordX:.51,coordY:.53,scale:13},{parcelId:1,image:ut,coordX:.51,coordY:.53,scale:14}],p=$e(),{map:h,mapRef:k,padding:I}=Oe();let C=null,S=null;const w=new Ne;let H=null;const x=new He;we(async()=>{k.value&&(h.setTarget(k.value),k.value.addEventListener("mouseleave",m),await new Promise(o=>setTimeout(o,500))),Q(),h.getLayers().clear(),await T(),ae(),B(),V()});async function T(){h.addLayer(U)}Ve(()=>{Q()});function m(){p.emit("hover:map",[])}function A(o){if(o.type==="pointermove"){const s=h.getFeaturesAtPixel(o.pixel);if(s&&s.length>=1){const i=s[0]?.values_?.features[0]?.values_?.type;if(i&&i==="trap"){const r=s[0].get("features");if(Array.isArray(r)&&r.length>0){const n=r.map(t=>t.get("ref"));p.emit("hover:map",n)}else p.emit("hover:map",[s[0].get("ref")]);h.getTargetElement().style.cursor="pointer"}}else p.emit("hover:map",[]),h.getTargetElement().style.cursor="default";return!0}return!1}function E(o){const s=h.getAllLayers().find(i=>i.get("name")==="trapInteractionLayer");if(s){const i=s.getSource();if(i){const r=i.getFeatures();for(const n of r){const t=n.get("features");if(Array.isArray(t)){for(const u of t)if(u.getProperties().ref===o)return n}else if(n.getProperties().ref===o)return n}}}return null}function F(o){const s=h.getAllLayers().find(i=>i.get("name")==="parcelInteractionLayer");if(s){const i=s.getSource();if(i){const r=i.getFeatures();for(const n of r){const t=n.get("features");if(Array.isArray(t)){for(const u of t)if(u.getProperties().ref===o)return n}else if(n.getProperties().ref===o)return n}}}return null}function G(o){const s=Je();return o.forEach(i=>{const r=i.getGeometry();r&&Ke(s,r.getExtent())}),s}function Q(){h.getLayers().getArray().filter(s=>s instanceof de).forEach(s=>{h.removeLayer(s)}),w.getLength()&&w.clear(),C&&(h.removeInteraction(C),C.dispose(),C=null),S&&(h.removeInteraction(S),S.dispose(),S=null)}function ae(){const o=[];a.parcels.forEach(n=>{const t=x.readFeature(n.world_geom);t.setProperties({ref:"parcel_"+n.parcel_id,type:"parcel",parcel_id:n.parcel_id}),w.push(t),o.push(t)}),H=new he({features:o});const s=new me({distance:0,source:H,geometryFunction:W}),i=new de({source:s,style:R,properties:{name:"parcelInteractionLayer",ref:ve.VECTOR,id:"parcel"},renderBuffer:500});h.addLayer(i),i.setZIndex(900);const r=G(w.getArray());ne(r)}O(()=>a.curParcel,()=>{if(w.getArray().filter(s=>s.getProperties().type==="parcel").forEach(s=>{s.setStyle(R)}),a.curParcel){const s=a.parcels.find(i=>i.parcel_id===a.curParcel.parcel_id);if(s){const i=F("parcel_"+s.parcel_id);i&&i.setStyle(l)}}}),O(()=>a.zoomOnPlot,()=>{if(a.curParcel){const o=a.parcels.find(s=>s.parcel_id===a.curParcel.parcel_id);if(o){const s=F("parcel_"+o.parcel_id);if(s){const i=G([s]),r=ye(i),n=[r[0],r[1]-100];h.getView().animate({center:n,duration:500})}}}});function B(){const o=[];a.parcels.forEach(n=>{if(M.find(t=>t.parcelId===n.parcel_id)){const t=x.readFeature(n.world_geom);t.setProperties({ref:"ndvi_"+n.parcel_id,type:"ndvi",parcel_id:n.parcel_id}),w.push(t),o.push(t)}});const s=new he({features:o}),i=new me({distance:0,source:s,geometryFunction:W}),r=new de({source:i,style:ie,properties:{name:"ndviLayer",ref:ve.VECTOR,id:"ndvi"},renderBuffer:500});r.on("prerender",n=>{const t=n.context;t.imageSmoothingEnabled=!1;const u=t;u.webkitImageSmoothingEnabled=!1,u.mozImageSmoothingEnabled=!1,u.msImageSmoothingEnabled=!1}),h.addLayer(r),r.setZIndex(700)}function V(){const o=[];a.traps.forEach(n=>{const t=x.readFeature(Z(Ge([n.coordinates.lon,n.coordinates.lat])));t.setProperties({ref:"trap_"+n.id,type:"trap",trap_id:n.id}),w.push(t),o.push(t)});const s=new he({features:o}),i=new me({distance:0,source:s,geometryFunction:W}),r=new de({source:i,style:z,properties:{name:"trapInteractionLayer",ref:ve.VECTOR,id:"trap"},renderBuffer:500});C=new De({style:oe,condition(n){return Xe(n)},layers:function(n){return n.get("name")==="trapInteractionLayer"}}),h.addInteraction(C),C.on("select",n=>{const t=n.target.getFeatures().getArray()[0].getProperties().features;if(t.length>1){const u=G(t);ne(u)}else{const u=t[0].get("trap_id"),y=a.traps.find(L=>L.id===u);N("select-trap",y)}}),S=new De({style:le,condition:A,layers:function(n){return n.get("name")==="trapInteractionLayer"}}),h.addInteraction(S),h.addLayer(r),r.setZIndex(910)}O(()=>a.curTrap,()=>{if(w.getArray().filter(s=>s.getProperties().type==="trap").forEach(s=>{s.setStyle(z)}),a.curTrap){const s=a.traps.find(i=>i.id===a.curTrap.id);if(s){const i=E("trap_"+s.id);i&&i.setStyle(oe)}}}),O(()=>a.zoomOnTrap,()=>{if(a.curTrap){const o=a.traps.find(s=>s.id===a.curTrap.id);if(o){const s=E("trap_"+o.id);if(s){const i=G([s]);h.getView().animate({center:ye(i),duration:500})}}}});const R=o=>{if(o.get("features")!==void 0){const r=o.get("features")[0].getGeometry().getCoordinates();return new ee({stroke:new Ce({color:Pe("lime-200",1),width:2}),geometry:new xe(r)})}},l=o=>{if(o.get("features")!==void 0){const r=o.get("features")[0].getGeometry().getCoordinates();return new ee({stroke:new Ce({color:Pe("lime-50",1),width:4}),geometry:new xe(r)})}},z=o=>{const s=o.get("features");if(s!==void 0){const i=a.traps.find(t=>t.id===s[0].values_.trap_id);let r=0;i.insects.forEach(t=>{r+=t.count});let n=gt;return r>i.danger_treshold?n=ht:r>i.warning_treshold&&(n=xt),new ee({image:new ue({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:n})})}},le=o=>{const s=o.get("features");if(s!==void 0){const i=a.traps.find(r=>r.id===s[0].values_.trap_id);if(i){let r=0;i.insects.forEach(t=>{r+=t.count});let n=pt;return r>i.danger_treshold?n=vt:r>i.warning_treshold&&(n=yt),new ee({image:new ue({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:n})})}}},oe=o=>{const s=o.get("features");if(s!==void 0){const i=a.traps.find(t=>t.id===s[0].values_.trap_id);let r=0;i.insects.forEach(t=>{r+=t.count});let n=ft;return r>i.danger_treshold?n=mt:r>i.warning_treshold&&(n=At),new ee({image:new ue({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:n})})}},ie=o=>{const s=o.get("features");if(s!==void 0){const r=o.get("features")[0].getGeometry().getCoordinates(),t=new xe(r).getInteriorPoint().getCoordinates(),u=M.find(y=>y.parcelId===s[0].values_.parcel_id);if(u)return new ee({image:new ue({scale:u.scale,anchor:[u.coordX,u.coordY],anchorXUnits:"fraction",anchorYUnits:"fraction",src:u.image}),geometry:new Ae(t)})}};function ne(o){h.getView().fit(o,{padding:[50,50,50,50],easing:je,duration:1e3})}function W(o){const s=o.getGeometry();return s?new Ae(ye(s.getExtent())):new Ae([0])}function Z(o){return"POINT("+o[0]+" "+o[1]+")"}return(o,s)=>(c(),d("div",{ref_key:"mapRef",ref:k,class:"relative h-full w-full"},null,512))}}),wt=[{id:0,name:"Rodilegno"},{id:1,name:"Lobesia botrana"},{id:2,name:"Tortricidae"},{id:3,name:"Coleottero"},{id:4,name:"Popillia Japonica"},{id:5,name:"Processionaria"},{id:6,name:"Cerambycidae"}],_t=[{id:"1",name:"S03925",type:"Cymatrap garden",last_capture:new Date("2023-03-28"),warning_treshold:30,danger_treshold:50,insects:[{count:5,id:"0",name:"Rodilegno"},{count:18,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.560286922994884,lon:10.721558966213962},battery:67,signal:100},{id:"2",name:"S05321",type:"Cymatrap garden",last_capture:new Date("2023-03-10"),warning_treshold:30,danger_treshold:70,insects:[{count:2,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.561788608518086,lon:10.719467188742241},battery:89,signal:70},{id:"3",name:"S08513",type:"Cymatrap pro",last_capture:new Date("2023-02-07"),warning_treshold:200,danger_treshold:300,insects:[{count:12,id:"0",name:"Rodilegno"},{count:1,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56160296275679,lon:10.720474777327212},battery:56,signal:50},{id:"4",name:"S00593",type:"Isagro dispenser",last_capture:new Date("2023-04-30"),warning_treshold:10,danger_treshold:20,insects:[{count:32,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559936248891546,lon:10.720922594476088},battery:34,signal:100},{id:"5",name:"S03858",type:"Isagro dispenser",last_capture:new Date("2023-03-14"),warning_treshold:80,danger_treshold:200,insects:[{count:41,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55896672672015,lon:10.721040441094033},battery:16,signal:80},{id:"6",name:"S05952",type:"Isagro dispenser",last_capture:new Date("2023-03-10"),warning_treshold:120,danger_treshold:200,insects:[{count:32,id:"0",name:"Rodilegno"},{count:15,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55821997698153,lon:10.721606104861031},battery:89,signal:30},{id:"7",name:"S08332",type:"Linea bacterocera",last_capture:new Date("2023-03-22"),warning_treshold:50,danger_treshold:100,insects:[{count:4,id:"0",name:"Rodilegno"},{count:7,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56011777455661,lon:10.722436923510717},battery:78,signal:20},{id:"8",name:"S09876",type:"Isagro carpo +",last_capture:new Date("2023-03-24"),warning_treshold:30,danger_treshold:70,insects:[{count:0,id:"0",name:"Rodilegno"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55862017006319,lon:10.72403963751722},battery:55,signal:0},{id:"9",name:"S02273",type:"Isagro carpo +",last_capture:new Date("2023-03-26"),warning_treshold:10,danger_treshold:20,insects:[{count:51,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559086370782154,lon:10.721712166809247},battery:54,signal:80},{id:"10",name:"S01423",type:"Isagro double wing",last_capture:new Date("2023-03-07"),warning_treshold:10,danger_treshold:20,insects:[{count:54,id:"0",name:"Rodilegno"},{count:34,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559346286317734,lon:10.722271938245344},battery:79,signal:100}],Dt={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},Ct=e("span",{class:"sr-only"},"Chiudi pannello",-1),Tt=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Pt=[Ct,Tt],St={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},Et={class:"flex w-6/12 items-center border-r pr-6"},Bt={class:"flex flex-grow flex-col"},kt={class:"flex items-center gap-x-3"},It={class:"flex gap-x-3 text-lg leading-7"},Vt={class:"font-semibold"},Ft={class:"mt-2 text-sm leading-6 text-label"},Lt={class:"flex w-6/12"},Ut={class:"flex w-full divide-x divide-border"},Mt={class:"text-sm font-medium leading-6 text-label"},Qt={class:"text-3xl font-medium tracking-tight text-text"},Rt={key:0,class:"text-sm text-label"},zt={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Yt={class:"flex h-full w-6/12"},Ot={key:0,class:"flex h-full w-full"},Nt={class:"relative flex h-full w-full pb-4 pl-3 pr-3 pt-4"},Ht={class:"absolute z-10 flex h-16 w-12 flex-col items-center justify-center",style:{left:"calc(50% - 1.5rem)",top:"calc(50% - 2rem)"}},Gt=e("span",{class:"text-sm font-medium text-label"},"Totali",-1),Xt={class:"text-3xl font-medium tracking-tight text-text"},jt={class:"thin-scrollbar relative flex h-full w-full flex-col space-y-3 overflow-auto pb-4 pl-8 pr-6"},$t={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3"},Kt={class:"flex w-full flex-col"},Jt={class:"flex w-full items-center"},Wt={class:"text-sm font-medium text-label"},Zt={class:"text-3xl font-medium tracking-tight text-text"},qt={key:1,class:"thin-scrollbar h-full w-full overflow-auto px-6 pb-6"},ea={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 py-3"},ta=e("th",null,"Insetto",-1),aa=e("th",null,"Conteggio",-1),na={class:"flex flex-col h-full w-6/12 px-6 border-l overflow-auto thin-scrollbar"},sa={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3 space-x-2"},ra={key:0,class:"flex h-full w-full"},la={class:"relative flex h-full w-full pb-4 pt-4"},oa={key:1,class:"w-full pb-6"},ia=e("th",null,"Giorno",-1),ca=pe({__name:"trapResumePanel",props:{insectTypes:null,curTrap:null},emits:["close"],setup(a,{emit:N}){const K=Be(),v=f(!0);let U=!1,M=!1;const p=f(null),h=f(null),k=["Anno","Mese","Settimana"],I=f("Settimana"),C=f("chart"),S=f("chart"),w=f(0),H=f(0);let x=f([]);const T=f([]),m=qe.color;let A=[],E=[],F=[],G=[],Q=[];function ae(r){r.style.height=0}function B(r){r.style.height=`${a.curTrap.battery}%`,r.style.transition="height 1s ease-out"}function V(r){r.style.height=0}function R(r){r.style.height=`${a.curTrap.signal}%`,r.style.transition="height 1s ease-out"}const l=se(()=>{let r=0;return a.curTrap.insects.forEach(n=>{r+=n.count}),r}),z=se(()=>l.value>a.curTrap.danger_treshold),le=se(()=>l.value>a.curTrap.warning_treshold),oe=se(()=>Math.floor(l.value/a.curTrap.danger_treshold*100));we(async()=>{a.curTrap?(ne(),ie(),W(),o()):(U=!0,M=!0),v.value=!1}),O(()=>K.darkMode,async()=>{W(!0),o(!0)}),O(()=>a.curTrap,async()=>{ne(),ie(),W(),o()});function ie(){x.value=[];const r=new Date,n=365;r.setDate(new Date().getDate()-n);for(let t=0;t<n;t++){const u=new Date(r);u.setDate(u.getDate()+t);const y=[];a.curTrap.insects.forEach($=>{y.push({id:$.id,name:$.name,count:Math.floor(Math.random()*25)+1})});const L={insects:y,date:u};x.value.push(L)}}function ne(){const r=Math.floor(Math.random()*25)+1;T.value=[{name:"Batteria",value:a.curTrap.battery.toString(),unit:"%"},{name:"Segnale",value:a.curTrap.signal.toString(),unit:"%"},{name:"Ultima cattura",value:r.toString(),unit:"gg fa"}]}function W(r=!1){if(a.curTrap.insects.length===0){U=!0;return}const n=a.curTrap.insects,t=Se("color-bg-100");F=[],A=[],Q=[];const u={id:"insects",name:"Insetti",radius:["82%","90%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:t,borderWidth:4},label:{show:!1,position:"center"},emphasis:{label:{show:!1,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},type:"pie",data:[]};n.forEach(y=>{Q.findIndex(L=>L.type_id===y.id)===-1&&Q.push({type_id:y.id,type_description:y.name,colorIndex:0,count:0})}),Q.forEach((y,L)=>{let $=0;n.forEach(ce=>{ce.id===y.type_id&&($=$+ce.count)}),y.count=$,y.colorIndex=L,F.push(y.type_description),u.data.push({value:y.count,name:y.type_description})}),A.push(u),s(),r&&w.value++}O(()=>I.value,async()=>{o()});const Z=se(()=>{if(x.value.length===0)return[];const r=[];let n=new Date;x.value.length>0&&(n=new Date(x.value[x.value.length-1].date));let t=0;return I.value==="Anno"?t=365:I.value==="Mese"?t=30:I.value==="Settimana"&&(t=7),n.setDate(new Date().getDate()-t),n.setHours(0,0,0,0),x.value.forEach(u=>{const y=new Date(u.date);y.setHours(0,0,0,0),y.getTime()>n.getTime()&&r.push(u)}),r});function o(r=!1){if(Z.value.length===0){M=!0;return}Se("color-bg-100"),G=[],E=[];const n=[],t=[];Z.value[0].insects.forEach(u=>{n.findIndex(y=>y.id===u.id)===-1&&n.push({id:u.id,name:u.name})}),n.forEach((u,y)=>{const L={id:"line_"+u.id,name:u.name,smooth:!0,lineStyle:{width:2},symbolSize:6,type:"line",data:[]};t.push(L)}),Z.value.forEach(u=>{const y=new Date(u.date);G.push(new fe(y).format("dd/MM")),u.insects.forEach(L=>{const $=t.findIndex(ce=>ce.id==="line_"+L.id);$!==-1&&t[$].data.push(L.count)})}),E.push(...t),i(),r&&H.value++}function s(){p.value={grid:{top:12,right:24,left:24,bottom:20,containLabel:!0},tooltip:{trigger:"none"},legend:{show:!1,selectedMode:!1},series:A,textStyle:{fontFamily:"Work Sans"}}}function i(){h.value={grid:{top:12,right:0,left:0,bottom:0,containLabel:!0},tooltip:{trigger:"axis"},legend:{show:!1},xAxis:{type:"category",data:G},yAxis:[{type:"value",name:"",position:"left"}],series:E,textStyle:{fontFamily:"Work Sans"}}}return(r,n)=>(c(),d("div",Dt,[e("button",{type:"button",onClick:n[0]||(n[0]=t=>N("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},Pt),e("div",St,[e("div",Et,[e("div",Bt,[e("div",kt,[e("h1",It,[e("span",Vt,g(a.curTrap.type),1)])]),e("p",Ft,g(a.curTrap.name),1)]),e("div",{class:b(["order-first flex-none rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset sm:order-none",{"bg-green-500/20 text-green-700 ring-green-400/30":!_(le),"bg-orange-500/20 text-orange-700 ring-orange-400/30":_(le)&&!_(z),"bg-red-500/20 text-red-700 ring-red-400/30":_(z)}])}," Saturazione al "+g(_(oe))+"% ",3)]),e("div",Lt,[e("div",Ut,[(c(!0),d(X,null,j(T.value,(t,u)=>(c(),d("div",{key:t.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Mt,g(t.name),1),(c(),d("p",{class:"flex items-baseline gap-x-2",key:t.value},[e("span",Qt,g(t.value),1),t.unit?(c(),d("span",Rt,g(t.unit),1)):Y("",!0)])),t.name==="Batteria"?(c(),d("div",{class:b(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":a.curTrap.battery>=75,"bg-orange-50":a.curTrap.battery>=50&&a.curTrap.battery<75,"bg-red-50":a.curTrap.battery<50}]),key:a.curTrap.id},[P(q,{appear:"",onBeforeAppear:ae,onAfterAppear:B},{default:D(()=>[e("div",{class:b(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curTrap.battery>=75,"bg-orange-400":a.curTrap.battery>=50&&a.curTrap.battery<75,"bg-red-400":a.curTrap.battery<50}])},null,2)]),_:1})],2)):Y("",!0),t.name==="Segnale"?(c(),d("div",{class:b(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":a.curTrap.signal>=75,"bg-orange-50":a.curTrap.signal>=50&&a.curTrap.signal<75,"bg-red-50":a.curTrap.signal<50}]),key:a.curTrap.id},[P(q,{appear:"",onBeforeAppear:V,onAfterAppear:R},{default:D(()=>[e("div",{class:b(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curTrap.signal>=75,"bg-orange-400":a.curTrap.signal>=50&&a.curTrap.signal<75,"bg-red-400":a.curTrap.signal<50}])},null,2)]),_:1})],2)):Y("",!0)]))),128))])])]),e("div",zt,[e("div",Yt,[C.value==="chart"?(c(),d("div",Ot,[e("div",Nt,[e("div",Ht,[Gt,e("span",Xt,g(_(l)),1)]),v.value?Y("",!0):(c(),J(Ee,{key:0,options:p.value,loading:v.value,"no-data":_(U),"disable-theme-refresh":!0,rebuild:w.value},null,8,["options","loading","no-data","rebuild"]))]),e("div",jt,[e("div",$t,[P(be,{onUpdate:n[1]||(n[1]=t=>C.value=t),"cur-value":C.value},null,8,["cur-value"])]),(c(!0),d(X,null,j(_(Q).sort((t,u)=>u.count-t.count),t=>(c(),d("div",Kt,[e("div",Jt,[e("div",{class:"mr-2 h-3 w-3 rounded-sm",style:Fe("background: "+_(m)[t.colorIndex])},null,4),e("span",Wt,g(t.type_description),1)]),e("div",null,[e("span",Zt,g(t.count),1)])]))),256))])])):(c(),d("div",qt,[e("div",ea,[P(be,{onUpdate:n[2]||(n[2]=t=>C.value=t),"cur-value":C.value},null,8,["cur-value"])]),P(Te,{items:_(Q),"is-compact":"","full-width":""},{header:D(()=>[ta,aa]),rows:D(({item:t})=>[e("td",null,g(t.type_description),1),e("td",null,g(t.count),1)]),_:1},8,["items"])]))]),e("div",na,[e("div",sa,[P(We,{values:k,onUpdate:n[3]||(n[3]=t=>I.value=t),"cur-value":I.value},null,8,["cur-value"]),P(be,{onUpdate:n[4]||(n[4]=t=>S.value=t),"cur-value":S.value},null,8,["cur-value"])]),S.value==="chart"?(c(),d("div",ra,[e("div",la,[v.value?Y("",!0):(c(),J(Ee,{key:0,options:h.value,loading:v.value,"no-data":_(M),"disable-theme-refresh":!0,rebuild:H.value},null,8,["options","loading","no-data","rebuild"]))])])):(c(),d("div",oa,[P(Te,{items:_(Z),"is-compact":"","full-width":""},{header:D(()=>[e("th",null,g(_(Z)[0].insects[0].name),1),ia]),rows:D(({item:t})=>[e("td",null,g(t.insects[0].count),1),e("td",null,g(new _(fe)(t.date).format("dd/MM")),1)]),_:1},8,["items"])]))])])]))}}),da={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},ua=e("span",{class:"sr-only"},"Chiudi pannello",-1),ga=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),fa=[ua,ga],pa={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},ha={class:"flex w-6/12 items-center border-r pr-6"},ma={class:"flex flex-grow flex-col"},va={class:"flex items-center gap-x-3"},xa={class:"flex gap-x-3 text-lg leading-7"},Aa={class:"font-semibold"},ya={class:"mt-2 text-sm leading-6 text-label"},ba={class:"flex w-6/12"},wa={class:"flex w-full divide-x divide-border"},_a={class:"text-sm font-medium leading-6 text-label"},Da={class:"text-3xl font-medium tracking-tight text-text"},Ca={key:0,class:"text-sm text-label"},Ta={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Pa={class:"flex flex-grow h-full"},Sa={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Ea={class:"flex w-full flex-col items-center justify-center pt-2 pb-4"},Ba={class:"flex items-center pb-6 pt-4"},ka={class:"mr-5 border-ra pr-4a"},Ia={class:"text-5xl font-extralight"},Va={class:"relative inline-flex items-center text-blue-400"},Fa={class:"mt-2 mb-4 flex flex-col md:flex-row w-full rounded-lg text-sm"},La={class:"text-sm font-light uppercase tracking-wider"},Ua={class:"text-xl"},Ma={class:"flex w-full text-sm border-t pt-4"},Qa={class:"w-full pb-2 text-center text-xs font-light uppercase tracking-wider"},Ra={class:"w-full pb-1 text-center"},za={class:"w-full pl-1 text-center"},Ya={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Oa={role:"list",class:"space-y-6 py-6"},Na=e("div",{class:"w-px bg-gray-200"},null,-1),Ha=[Na],Ga=e("div",{class:"relative flex h-6 w-6 flex-none items-center justify-center bg-bg-100"},[e("div",{class:"h-2 w-2 rounded-full bg-gray-50 ring-1 ring-gray-200"})],-1),Xa={class:"flex-auto rounded-lg p-3 border"},ja={class:"flex justify-between gap-x-4"},$a={class:"py-0.5 text-xs leading-5 text-gray-500"},Ka={class:"font-medium text-gray-900"},Ja=["datetime"],Wa={class:"text-sm leading-6 text-gray-500"},Za={class:"flex flex-col h-full w-60 overflow-auto thin-scrollbar border-r px-6 relative"},qa={class:"flex flex-col items-center w-full py-6"},en=e("i",{class:"fal fa-wheat"},null,-1),tn=e("i",{class:"fal fa-map"},null,-1),an=e("div",{class:"pb-2 mb-2 w-full"},null,-1),nn=e("i",{class:"fal fa-tractor"},null,-1),sn=e("i",{class:"fal fa-notebook"},null,-1),rn=pe({__name:"plotResumePanel",props:{curParcel:null},emits:["close"],setup(a,{emit:N}){Be();const K=Le(),v=f(!0);f(null),f("Mese"),f("chart"),f(0);const U=[{id:0,comment:"Notati nugoli di insetti lungo il filare",date:"3 gg fa",dateTime:"2023-01-23T15:56"},{id:1,comment:"I nugoletti sono stati eliminati con un trattamento chimico",date:"5 gg fa",dateTime:"2023-01-23T15:56"},{id:2,comment:"Nugoli di insetti nuovamente notati",date:"7 gg fa",dateTime:"2023-01-23T15:56"},{id:3,comment:"I nugoli si fanno sempre pi\xF9 numerosi, urgono rinforzi",date:"13 gg fa",dateTime:"2023-01-23T15:56"},{id:4,comment:"I nugoli si stanno evolvendo in una vera e propria invasione",date:"15 gg fa",dateTime:"2023-01-23T15:56"},{id:5,comment:"Dite a tutti di stare attenti, i nugoletti sono molto pericolosi",date:"18 gg fa",dateTime:"2023-01-23T15:56"},{id:6,comment:"Non so se ce la far\xF2, sono troppi",date:"21 gg fa",dateTime:"2023-01-23T15:56"},{id:7,comment:"I nugoletti hanno oscurato il cielo, non vedo pi\xF9 il sole",date:"23 gg fa",dateTime:"2023-01-23T15:56"}],M=f([]),p=f([]),h=f([]),I=f({id:"rainy",temp:"14\xB0",icon:"fa-cloud-showers",theme:"weather-widget-rain"});function C(x){x.style.height=0}function S(x){x.style.height=`${a.curParcel.cultivatedPercentage}%`,x.style.transition="height 1s ease-out"}we(async()=>{if(a.curParcel){const x=new Date,T=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],m=["fa-cloud-showers","fa-cloud-bolt","fa-cloud-fog","fa-sun-bright","fa-sun-bright"];for(let A=1;A<=5;A++){const E=new Date(x);E.setDate(E.getDate()+A);const F=Math.floor(Math.random()*15)+10;h.value.push({day:T[E.getDay()],icon:m[A-1],temp:F+"\xB0"})}w(),H()}v.value=!1}),O(()=>a.curParcel,async()=>{w(),H()});function w(){M.value=[{name:"Coltivato",value:a.curParcel.cultivatedPercentage.toString(),unit:"%"},{name:"Area",value:a.curParcel.area.toString(),unit:"ha"},{name:"Indice NDVI",value:(a.curParcel.ndvi_change_type==="decrease"?"-":"+")+a.curParcel.ndvi_change.toString(),unit:"da ieri"}]}function H(){const x=Math.floor(Math.random()*50),T=Math.floor(Math.random()*20),m=Math.floor(Math.random()*20),A=Math.floor(Math.random()*20)+10;p.value=[{name:"Precipitazioni",value:x+" mm"},{name:"Vento",value:T+" km/h"},{name:"Temperature",value:m+"\xB0 - "+A+"\xB0"}]}return(x,T)=>(c(),d("div",da,[e("button",{type:"button",onClick:T[0]||(T[0]=m=>N("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},fa),e("div",pa,[e("div",ha,[e("div",ma,[e("div",va,[e("h1",xa,[e("span",Aa,g(a.curParcel.name),1)])]),e("p",ya,g(a.curParcel.cropDescription),1)])]),e("div",ba,[e("div",wa,[(c(!0),d(X,null,j(M.value,(m,A)=>(c(),d("div",{key:m.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",_a,g(m.name),1),(c(),d("p",{class:"flex items-baseline gap-x-2",key:m.value},[e("span",Da,g(m.value),1),m.unit?(c(),d("span",Ca,g(m.unit),1)):Y("",!0)])),m.name==="Coltivato"?(c(),d("div",{class:b(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-100":a.curParcel.cultivatedPercentage>=75,"bg-orange-100":a.curParcel.cultivatedPercentage>=50&&a.curParcel.cultivatedPercentage<75,"bg-red-100":a.curParcel.cultivatedPercentage<50}]),key:a.curParcel.parcel_id},[P(q,{appear:"",onBeforeAppear:C,onAfterAppear:S},{default:D(()=>[e("div",{class:b(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curParcel.cultivatedPercentage>=75,"bg-orange-400":a.curParcel.cultivatedPercentage>=50&&a.curParcel.cultivatedPercentage<75,"bg-red-400":a.curParcel.cultivatedPercentage<50}])},null,2)]),_:1})],2)):Y("",!0),P(q,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":a.curParcel.ndvi_change_type==="increase"?"translate-y-2 opacity-0":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100"},{default:D(()=>[m.name==="Indice NDVI"?(c(),d("div",{class:"absolute h-12 w-12 top-2 right-0",key:a.curParcel.parcel_id},[a.curParcel.ndvi_change_type==="increase"?(c(),J(_(Ie),{key:0,class:"h-full w-full text-green-200","aria-hidden":"true"})):(c(),J(_(ke),{key:1,class:"h-full w-full text-red-100","aria-hidden":"true"}))])):Y("",!0)]),_:2},1032,["enter-from-class"])]))),128))])])]),e("div",Ta,[e("div",Pa,[e("div",Sa,[e("div",Ea,[e("div",Ba,[e("div",ka,[e("span",Ia,g(I.value.temp),1)]),e("div",Va,[e("i",{class:b(["fa-solid relative z-10 text-5xl",I.value.icon]),style:{"font-size":"44px"}},null,2)])]),e("div",Fa,[(c(!0),d(X,null,j(p.value,(m,A)=>(c(),d("div",{class:b(["flex flex-grow md:flex-col px-4 py-2 md:py-0 justify-between md:justify-normal items-center md:items-start",A<p.value.length-1?"border-b md:border-b-0 md:border-r":""])},[e("span",La,g(m.name),1),e("span",Ua,g(m.value),1)],2))),256))]),e("div",Ma,[(c(!0),d(X,null,j(h.value,(m,A)=>(c(),d("div",{class:b(["flex flex-grow flex-col px-4",A<h.value.length-1?"border-r":""])},[e("span",Qa,g(m.day),1),e("span",Ra,[e("i",{class:b(["fa-solid relative z-10 text-xl text-blue-300",m.icon])},null,2)]),e("span",za,g(m.temp),1)],2))),256))])])]),e("div",Ya,[e("ul",Oa,[(c(),d(X,null,j(U,(m,A)=>e("li",{key:m.id,class:"relative flex gap-x-4"},[e("div",{class:b([A===U.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"])},Ha,2),Ga,e("div",Xa,[e("div",ja,[e("div",$a,[e("span",Ka,g(A%2===0?_(K).name:"Tu"),1),te(" "+g(A%2===0?"ha":"hai")+" scritto ",1)]),e("time",{datetime:m.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-gray-500"},g(m.date),9,Ja)]),e("p",Wa,g(m.comment),1)])])),64))])])]),e("div",Za,[e("div",qa,[P(ge,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:D(()=>[en]),default:D(()=>[te("Modifica colture")]),_:1}),P(ge,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:D(()=>[tn]),default:D(()=>[te("Vedi dettagli")]),_:1}),an,P(ge,{"is-success":"","is-outlined":"",class:"w-full mb-3"},{icon:D(()=>[nn]),default:D(()=>[te("Crea attivit\xE0")]),_:1}),P(ge,{"is-success":"","is-outlined":"",class:"w-full"},{icon:D(()=>[sn]),default:D(()=>[te("Aggiungi nota")]),_:1})])])])]))}}),ln=[{id:-4,date:new Date(new Date().setDate(new Date().getDate()-12)),isPresent:!0},{id:-3,date:new Date(new Date().setDate(new Date().getDate()-11)),isPresent:!0},{id:-2,date:new Date(new Date().setDate(new Date().getDate()-10)),isPresent:!0},{id:-1,date:new Date(new Date().setDate(new Date().getDate()-9)),isPresent:!0},{id:0,date:new Date(new Date().setDate(new Date().getDate()-8)),isPresent:!0},{id:1,date:new Date(new Date().setDate(new Date().getDate()-7)),isPresent:!1},{id:2,date:new Date(new Date().setDate(new Date().getDate()-6)),isPresent:!1},{id:3,date:new Date(new Date().setDate(new Date().getDate()-5)),isPresent:!0},{id:4,date:new Date(new Date().setDate(new Date().getDate()-4)),isPresent:!0},{id:5,date:new Date(new Date().setDate(new Date().getDate()-3)),isPresent:!0},{id:6,date:new Date(new Date().setDate(new Date().getDate()-2)),isPresent:!1},{id:7,date:new Date(new Date().setDate(new Date().getDate()-1)),isPresent:!0},{id:8,date:new Date,isPresent:!0}];const _e=a=>(Qe("data-v-1bbf8b99"),a=a(),Re(),a),on={class:"relative flex h-full w-full"},cn={class:"flex flex-col w-96 bg-green-25 rounded-l-lg overflow-auto thin-scrollbar relative"},dn={class:"flex w-full sticky top-0 pt-6 px-4 justify-between bg-green-25 z-10 pb-4"},un={class:"flex flex-grow space-x-4 overflow-y-auto","aria-label":"Tabs"},gn=["onClick","aria-current"],fn={class:"border-l border-green-200 ml-3 pl-3"},pn=_e(()=>e("i",{class:"fal fa-pen-to-square",style:{"margin-top":"-3px"}},null,-1)),hn=[pn],mn={class:"flex flex-col w-full pt-4 rounded-t-2xl bg-bg-100 flex-grow"},vn={key:0,role:"list",class:"divide-y divide-border"},xn=["onClick"],An={class:"flex max justify-between px-4"},yn={class:"flex"},bn={class:"flex flex-col"},wn={class:"text-sm font-semibold leading-6 text-gray-900"},_n={class:"mt-1 flex text-sm leading-7 text-gray-500"},Dn={class:"flex items-center"},Cn={class:"hidden sm:flex sm:flex-col sm:items-end"},Tn={class:"text-sm leading-6 text-gray-900"},Pn={class:"mt-1 flex items-center"},Sn={class:"sr-only"},En={key:1,role:"list",class:"divide-y divide-border"},Bn=["onClick"],kn={class:"flex max justify-between px-4"},In={class:"flex"},Vn={class:"flex flex-col"},Fn={class:"text-sm font-semibold leading-6 text-gray-900"},Ln={class:"mt-1 flex text-xs leading-5 text-gray-500"},Un={class:"flex items-center"},Mn={class:"hidden sm:flex sm:flex-col sm:items-end"},Qn={class:"text-sm leading-6 text-gray-900"},Rn={class:"mt-1 text-xs leading-5 text-gray-500"},zn={class:"mt-1 flex items-center gap-x-1.5"},Yn=_e(()=>e("p",{class:"text-xs leading-5 text-gray-500"},"Saturazione",-1)),On={key:2,class:"flex flex-col w-full h-full"},Nn={class:"flex flex-col pb-3 border-b px-4"},Hn=_e(()=>e("label",{for:"ndviRange",class:"form-label text-sm font-medium mb-2"},"Visibilit\xE0",-1)),Gn={class:""},Xn=["onClick"],jn={class:"flex items-center h-full justify-between px-4"},$n={class:"flex items-center"},Kn={class:"text-sm font-semibold leading-6 text-gray-900"},Jn={key:0,class:"flex items-center"},Wn={class:"flex flex-col flex-grow relative overflow-hidden"},Zn=pe({__name:"index",setup(a){const N=[{name:"Appezz.",id:"plots",icon:"fa-map"},{name:"Trappole",id:"traps",icon:"fa-mosquito"},{name:"Ndvi",id:"ndvi",icon:"fa-satellite"}],K=f(Ze),v=f(null),U=f(_t),M=f(wt),p=f(null),h=f(ln),k=f(h.value[h.value.length-1]),I=f(0),C=f(0),S=f(10),w=f(N[0].id),H=f(!1),x=f(!1),T=f(!1);function m(){H.value=!0}function A(B){let V=0;return B.insects.forEach(R=>{V+=R.count}),V}function E(B){return A(B)>B.danger_treshold}function F(B){return A(B)>B.warning_treshold}function G(B){return Math.floor(A(B)/B.danger_treshold*100)}O(()=>w.value,()=>{x.value=!1,p.value=null,T.value=!1,v.value=null}),O(()=>p.value,()=>{p&&(x.value=!0)}),O(()=>v.value,()=>{v.value&&(T.value=!0)});function Q(){x.value=!1,p.value=null}function ae(){T.value=!1,v.value=null}return(B,V)=>{const R=Me("bf-tooltip");return c(),d("div",on,[e("div",cn,[e("div",dn,[e("nav",un,[(c(),d(X,null,j(N,l=>e("button",{role:"tab",key:l.id,onClick:z=>w.value=l.id,class:b([(w.value===l.id,""),"group flex flex-col items-center space-y-1"]),"aria-current":w.value===l.id?"page":void 0},[e("span",{class:b([w.value===l.id?"border-green-600 bg-green-600 text-green-50":"border-transparent group-hover:border-green-400 text-green-500","flex flex-col items-center justify-center border-2 w-14 h-14 bg-green-400/20 transition-colors-default rounded-full"])},[e("i",{class:b(["fal",l.icon])},null,2)],2),e("span",{class:b([w.value===l.id?"text-green-700":"group-hover:text-green-700","text-sm font-medium text-gray-500 transition-colors-default"])},g(l.name),3)],10,gn)),64))]),e("div",fn,[re((c(),d("button",{onClick:m,class:"border-transparent hover:bg-green-400/20 rounded-md h-full text-green-500 flex text-xl px-4 items-center justify-center transition-colors-default"},hn)),[[R,"Aggiungi/rimuovi"]])])]),e("div",mn,[P(q,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:D(()=>[w.value==="plots"?(c(),d("ul",vn,[(c(!0),d(X,null,j(K.value,l=>(c(),d("li",{class:b(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":v.value&&v.value.parcel_id===l.parcel_id}]),onClick:z=>{x.value=!1,p.value=null,v.value=!v.value||v.value&&v.value.parcel_id!==l.parcel_id?l:null,C.value++}},[e("div",An,[e("div",yn,[e("div",bn,[e("p",wn,g(l.name),1),e("p",_n,g(l.cropDescription),1)])]),e("div",Dn,[e("div",Cn,[e("p",Tn,g(l.area)+" ha",1),e("div",Pn,[re((c(),d("div",{class:b([l.ndvi_change_type==="increase"?"bg-green-50 text-green-800":"bg-red-50 text-red-800","inline-flex items-baseline rounded-full px-2.5 py-0.5 text-sm font-medium md:mt-2 lg:mt-0"])},[l.ndvi_change_type==="increase"?(c(),J(_(Ie),{key:0,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-green-500","aria-hidden":"true"})):(c(),J(_(ke),{key:1,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-red-500","aria-hidden":"true"})),e("span",Sn,g(l.ndvi_change_type==="increase"?"Aumendo":"Diminuzione")+" del ",1),te(" "+g(l.ndvi_change),1)],2)),[[R,l.ndvi_change_type==="increase"?"Aumendo indice NDVI da ieri":"Diminuzione indice NDVI da ieri"]])])])])])],10,xn))),256))])):w.value==="traps"?(c(),d("ul",En,[(c(!0),d(X,null,j(U.value,l=>(c(),d("li",{class:b(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":p.value&&p.value.id===l.id}]),onClick:z=>{T.value=!1,v.value=null,p.value=!p.value||p.value&&p.value.id!==l.id?l:null,I.value++}},[e("div",kn,[e("div",In,[e("div",Vn,[e("p",Fn,g(l.type),1),e("p",Ln,g(l.name),1)])]),e("div",Un,[e("div",Mn,[e("p",Qn,g(A(l))+" catture ",1),e("p",Rn," Ultima cattura "+g(new _(fe)(l.last_capture).format("dd/MM")),1),e("div",zn,[re((c(),d("div",{class:b(["flex-none rounded-full p-1",{"bg-green-500/20":!F(l),"bg-orange-500/20":F(l)&&!E(l),"bg-red-500/20":E(l)}])},[e("div",{class:b(["h-1.5 w-1.5 rounded-full",{"bg-green-500":!F(l),"bg-orange-500":F(l)&&!E(l),"bg-red-500":E(l)}])},null,2)],2)),[[R,G(l)+"%"]]),Yn])])])])],10,Bn))),256))])):(c(),d("div",On,[e("div",Nn,[Hn,re(e("input",{"onUpdate:modelValue":V[0]||(V[0]=l=>S.value=l),type:"range",class:"form-range",min:"0",max:"10",step:"0.1",id:"ndviRange"},null,512),[[Ue,S.value]])]),e("ul",Gn,[(c(!0),d(X,null,j(h.value.sort((l,z)=>z.date.getTime()-l.date.getTime()),l=>(c(),d("li",{class:b(["relative py-4 transition-colors-default border-b",{"!bg-gray-100":k.value&&k.value.id===l.id,"hover:bg-gray-50 cursor-pointer":l.isPresent}]),onClick:z=>l.isPresent?k.value=!k.value||k.value&&k.value.id!==l.id?l:null:"",style:{height:"73px"}},[e("div",jn,[e("div",$n,[e("p",Kn,g(new _(fe)(l.date).format("dd/MM")),1)]),l.isPresent?Y("",!0):(c(),d("div",Jn,[re((c(),d("div",{class:b(["flex items-center justify-center w-12 h-12 rounded-full text-xl",l.isPresent?"bg-teal-50 text-teal-400":"bg-gray-50 text-gray-400"])},[e("i",{class:b(["fal",l.isPresent?"fa-check":"fa-clouds"])},null,2)],2)),[[R,l.isPresent?"NDVI presente":"\xC8 stata scattata un'immagine satellitare in questo giorno, ma l'indice di vegetazione NDVI non pu\xF2 essere calcolato. Ci\xF2 pu\xF2 accadere a causa della copertura nuvolosa, della foschia, della neve o di altri fattori."]])]))])],10,Xn))),256))])]))]),_:1})])]),e("div",Wn,[P(bt,{parcels:K.value,curParcel:v.value,traps:U.value,curTrap:p.value,zoomOnTrap:I.value,zoomOnPlot:C.value,onSelectTrap:V[1]||(V[1]=l=>{T.value=!1,v.value=null,p.value=!p.value||p.value&&p.value.id!==l.id?l:null}),onSelectParcel:V[2]||(V[2]=l=>{x.value=!1,p.value=null,v.value=!v.value||v.value&&v.value.parcel_id!==l.parcel_id?l:null})},null,8,["parcels","curParcel","traps","curTrap","zoomOnTrap","zoomOnPlot"]),P(q,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:D(()=>[x.value&&p.value?(c(),J(ca,{key:0,curTrap:p.value,insectTypes:M.value,onClose:Q},null,8,["curTrap","insectTypes"])):Y("",!0)]),_:1}),P(q,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:D(()=>[T.value&&v.value?(c(),J(rn,{key:0,curParcel:v.value,onClose:ae},null,8,["curParcel"])):Y("",!0)]),_:1})])])}}});var ss=et(Zn,[["__scopeId","data-v-1bbf8b99"]]);export{ss as default};

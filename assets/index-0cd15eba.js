import{o as i,c as g,a as e,d as pe,e as _e,K as Fe,g as O,s as ke,r as m,b as oe,j as p,n as w,F as $,y as K,q as Y,z as B,x as P,T as te,v as q,u as X,J as Le,B as Ue,A as se,k as Me,l as le,L as Qe,M as Re,N as ze}from"./index-b08b9c61.js";import{T as Ye,B as Oe,u as Ne,d as He,C as Ge,W as je,V as ue,e as he,f as me,h as ve,v as Xe,i as Ce,j as $e,k as ne,l as Te,P as Ae,I as ge,q as ye,o as Ke,r as xe,s as Je,t as We,a as be,b as Pe,_ as Ze,p as qe}from"./parcelData-c8ae6cb8.js";import{a as Se,g as Ee,D as we,_ as Be,t as et,b as tt}from"./Colors-9e4cd12d.js";import{_ as fe}from"./BfButton-1bae55ad.js";import"./use-outside-click-bbe60562.js";function Ie(o,N){return i(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})])}function Ve(o,N){return i(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})])}const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAA8klEQVQYlXWQsUrDUBRAz325NoFgitjBoXUp4hKh4ObU2dVPKM5+UD7BxcGlnQRHlw5ZFAQVUREtEk1raGocntUY7ZkevMPh3isHDQVg/2RY8EXU7QgVTFVahMRx/C35rZDsAy4TGGzrr6qZP2ZrIZ4DroEVFxr9vPgjes0QAMfAqge+wrQyjAH7oQJXr3A3hjSHjWW4iH6qJup2xF+C+zEcXcPxDdy+QVCDnfVKMZ3C2ROkuyrDEYwyW20HsHVqqzK/Y5nnw7zYDKzoOpDNSluXeUngPLGCit3hX7HdU1EDDxM7QtNfIALU91Qe3221XoNPcCBLMI6LQyMAAAAASUVORK5CYII=",nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABeElEQVQokW3SO2tUURTF8d+9nntnxjiJQpABUQz4wEY/gSIIYi1ptbIX7Cxt7GwEsbARBCtBOz+ApcRCUFQIQQIS8pyZZN535lqc0RHMqc5ZsNbe+392cn8xgI9PijLP2dig02FwQDHgzquQOOQE+PGiKK+fYrPPeEy1xrBOeoQPj4uy22H9K/fezkLSny+L8tpZTlYJaRQnE0JGnjNfp9Fg6QrvHhTlX+OtJS4scCxjPmOhTppSjOh2WFtjdZXhIHbw/mE0h3PzDCYcDdQDi8fZbcaq/R69Nr09DirkdfJarJh821N+2mZ3EIVfXb7vsLZOq0W3Tb8VQUHtBI0zpM/Ph2QusDdgfxTnzLMZvTSLlUKFcREDdranVK822OrzpRnNzX2yjCzQG0/xV2dhy09DEuDR6ZAsfy7KrX4MqEwhjUa0m4y6lGPuvp59R/hzeXM5JDdXinKzHwkXk6gPh9x49v8ShH8fFxdoDWkP46xzt0Ny6bC1wW8e44quL8wQiQAAAABJRU5ErkJggg==",st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABGklEQVQYlV2QMUvDUBSFv5e8hAYbjWkGkzRoEQdBcHUTcXcUdxdBpZOIINJR8EfojxCcHN106lrFyUWkYK1pk9fE4VWLvXC4cPk499wrmoEE4HpXlZYDyQpsnkvBVBkAN3uqrC1C2IDvPjxcqnIaFHNHlH4C4QJUZyDL4bMH3S7sXE2cDS8C19WQ58JSBI0E6jHcnU2cjXkfBil89fVAFeBUoOZBUofbUw2LZiC5b6nSMCAOtatpQpbBqIBhBp2X8THbLSkGKaQDGI20bFtvCDyII5C/GaJI9ywHx4SqpaUKeP8YOwKsH0thW9AbZ/VtmLWg/QxbF1L8gQCrB1I4FR3hLYWnV9g40S/6BwIs70sxzOGxDWuHkz/+AMEfTy2fWGeUAAAAAElFTkSuQmCC",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAALCAYAAABPhbxiAAABXklEQVQokV3Sv44SURTH8Q/MMLAgEkSCmqw2xsJiY+Nb2NlZ2Vib+Ah2PoCW1lv6BvoGFj6Aru6yYUGRsPwbZgaLC4H4S07uOffmm5zfL7f0+nYMPr/NNpCuGJ6T1Ll7zMMHTOc8ehWXHKh08sEGkoRuh2qFn/3w2Ovy9JisoL+g9XwPlwcXxDF3ujTr3Ghwr0e7FWa43+BJm6vTsBXExZrlgus59Vq4rCahoD/nZoVOlcdtvrzPNt++Un7xMS5NJlzPSNekaQCicjhnKWczzmdMM6KISp0YakeMxxzVaDWJowAlFfKcwZTRnMWSqxHLCWV49i6YHg7585fVOgB5Tl4wXzKdhcoyivUW3MHrjOUqrJvlAVile99JQq1G0jwAd/B4zO9xmPNim2C0951lZEtKuw9wqE9vsk2jEfpOJ3iPIi4uufxBOt+G87/WK36dURSMOtzqhX7wnZenIY9/RoeHctXEeSgAAAAASUVORK5CYII=",ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAYAAAD+Bd/7AAAAmElEQVQImS3MMWoCUQAA0ffX75J1NZUE0gQhrZdIn1K8huAB0od0uYBX8FARBIkKZl2V1bX4qQZmYMJsGC2mTfvwSKdLXpB1uJyZfMcQF9OmHY3pl8D1lljXieH1Szt64fmJ+sShSuGvYrUie/+MYfOb4qDH4P+U5xQFGVQVP2sOR44ntnu2O2KXMBtGsJw3bVkmCW8fMcAdpnwsOXDzZHAAAAAASUVORK5CYII=",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAYAAAAvg9c4AAADGElEQVQ4jY2Vu28cVRSHv5l7x7Mzs+ud9a6XXeJAgmUhBYeHeCRSihRINAiJAiSIxB9ARRmK0FHQICFqCkQXCkSBKKBCAoFEeIkiFBESmOBX/Fjvzu7Mzt25FGftGOKxudLojnTv+e5vzj3nN84bLU3Z+PAVY/0qeCHkQ3j1A+2Ubj40nKOgH10x1lGgPPAC8HzwfUgSeOn9k8H/In7/rrHrG+CuQZEDngDrMQQBtFr/R+cU2vnSWM+F3i6Mc0hHYDKwE8gz2VgNQSn45h1jL715vFr3hZ+MfaIJ8Qzs9mGYgOvKs5+CagSTQgKMga/eNvZYaOiBr2AhggunoN2GWg0cF0wKwx1YXYNBIgHd+wR8LLQbgHZgYuFcDM88BGEkCpUnue2tweYG3NkWeKsJn10tV+u+t6idUEOoYc6H8zF05mXRUVJOjguDLQH39mA8hiiCj18/GnxQUs/9YGySg7HwWw8++Q621qHYz2UKroJqE/wZyfnOHej95VCJLY4Lp5fg8jXtHJRUw4ckh6GBByJ4eBF+zSCb3n6uwRaQDiBzpdQqVXDPWup10B7c/l1q/AB6fVk7L/5ibGIgMfBUB7Ix/Hlb1oMA+nuwuy1wV0kKGg1ozUFYkeZIR/8p/k8f086Fb43tjaHmwaNdGAxhlEJ3HiYTCSwKqZBOG5oxLMUQKMhyyfk9PXo6gj8G8PcA2j6cfxBurctaNQLVFfhcDBfPwP0BdEPYTCGuwep6Se8//rWxP25DYwZmPbjVh+0EzsRQ09A3Mi/OSsVMLGyM4GYPsucPXdTh0Q5Ewc5Y5uUYfi4gL+BcAyoK0sndLlsZwMAIEMA9CvrFk9rpTJvCWIg0XJyHdgVWh+C7UJ924uZIgCvP3vWDUjNtB5BNJNBX0wMKuLElwIUqzM7IIYeBpUr31T49L4GRBuXKe6Dh8xVR6Cu4eflexyq3fWCpLs1gLOyNYXMsipWSr7i+fLQFlioFeOuUdrqhAIyVi+vnsnbjUrmnHgsFscTVIQxz2EhhJ4HmyyeY9EnQq13tPNKArUxULrx28j/qH3hsHP+6HLkeAAAAAElFTkSuQmCC",it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAWCAYAAADNX8xBAAAB5ElEQVQ4jZ3UTWsTURTG8f+9cyevTYO1RDoqFUQt6iIYXIkSdJmNIEpBBDcuXNWtX8DPIGTRb9CF4AuCK5euxHahoNWWCFralCbTJNM7GReHtNa0zYwHBubexY/nHM6Mmps05F/ZaCOArAOdENK3jSJhqedLRDaCogu+hbUuNDrJMf15C1o7kHZgPAUFF6bz0H9ho0SQq+FrC353oReC0dLi2TEovomP6V7NKKMllW8h48CYK08ziJ9Mg8xjaRO6oVw6CmwfLhVheS1mosFLEEh7ti9no2Vm1TPw/tnoVLvQ1H2jVlvwrQ1hJOC2BS8H1y7D66dHY/rvQ2nWqE8/4WMT2hbaO7AVQCkNnhcz0aDOPzLqVwsa22AjGXgnhNJEQmjQ5vI6bPT27k6Ow8KTw9s7EAKYfmjUii87VXBhIgWVMszfOxg7FAI4fteoH75ABRcqU3DlOtRr4RBmjoIAVjbB1eBlBbtxDtp+BC8TJAI49UA+3k4oW+9lYfYqfKnvb3EkBNCrGdUMZPONhhMZuDMD/sIeFgsCKGUklaMg58LFY/B4Bm5+EEzNTY4c026dfmcjLwcXirLx698Xk7U2qNVbRhVTkHf3I4khgLcVo2xjceg+MQRQr5aHfsP/Bf2L1atl9QeqsqHj3YkKIgAAAABJRU5ErkJggg==",ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAABCElEQVQYlW2RvUoDQRRGz0yuG+KSTTZkQfEPGy20CNhELKzEws4XER/AR1IhhY1Yia2FICmsxB8ChpVEF1yc3bEYJW7YW92Bw5nv3quO2sLo1NjQg/UA+ruiKCmd94zthLAdQVSDpStjy0B1/YoFSDNIDMQp9EeQHhTNeqe5wkboIGNhfhbWgpKvj5dflGgHNGZAFCz6kPeKETTAyYKoVhWqFWfOLNQFkrMJrP+a2yGMv38j5LDVhs3mlBHgpivqLoaGB764GKt18C+cVfOvBntu0sCDinZROi2YuzS2AAKcP7pVZbkbLKpB6E0ZAfxDUffvk/fzJ7x9lYDgzhin8JTAwwcM90X9AG7EUPqOil3VAAAAAElFTkSuQmCC",dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABVElEQVQokX2SO0sDQRSFv5kd3DyMmKABQSGxEdRCxEYESSOCIFj6L/xFVmJl46O3E3yAlYgQLAyBSBINajbuspNdi2sUjXGqO3C/uefcOWpnzACwdGbjlxDKJaP452iA1UsbA9gIiqdSDwRWzm2cT8BsFvJJuHuF4HAwpF0HJtNy6UbQDiHpgD75G9I2hucArhrwFMBCTgAbQ3WvH9K1DhxVoOKJpPksTGfg3UImBfe7PyFdLhlV96WpkIGRIRhPgN+FmREoFf7YkrtllKOgFUAnFDlzozA7KhOj4+8puldUPbhuip+EI81GQ9CFxRzU9gX6AprrRt224DWElIGcK/9iY5hKw2bh1wSA/LZRDR9qHXk5LSHAszCRgqcDG/8AAN5CeGhDEIHriLygC3VffPUB3oZRNgLnM1FZV2TdtOBxzag+oOen6omU4jBcLBvlbUgoPwDYj4IfJzeDcwAAAABJRU5ErkJggg==",ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAHCAYAAAArkDztAAAAj0lEQVQImT3LIQ7CQBRF0fvLz1AMpRWsANFAAt0AEk9SyxbYAptAo9gAHl+FIehaQkARxJB0YBDT8JKrTp5sTnj3haqG2VqFdlGvA0UGywmct87/4WrBecgHsCqg3gXUVwN3C8MYphl0czjsnY+SUsV+4NmE5ziFcgQKcFuocHReBfoGEtMCQGrg8Q5d5io/VTwqesL437MAAAAASUVORK5CYII=",gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAABa0lEQVQokXXQMWtTURiH8d+9ObmpJEohttg2qFhEnFwVHNXBXRDByQ/g5GcQV0eHfoZSHUV0sRQK6iAoOKhBi2mjialp09ybOByhNtYXXs45vO/zf+Akd48HDzby8conVpqcrHJ1geULIXFIJfdfGb//GR+dXuy5Ga41eH35Xyhd+8LXTQZDsjJFwZu3LK1z9nk+ngRCrRpTi4Iso1Si26Xd4uk0pyYN9RshaZyg16fVptNlNKS/xeoqg+WDlhSuN9jb43OT9lYcZDW2Wzxb4/yLfSiFtUshma0zzAlljk5TqzN1jB/fePJhwgCzN0MyP0clI6tEsFJjVPCxSfo4WlJ/1WydNI1LkJQIU2xu8PLdhAEat+O/7+ySDxkXMWBc0GoxWsnHBwA4czqeef4nsUypHAOa3ycMsHgnJNttdrsUOflgf9b7dQgAt5ZCstNh2Cc7Ei3zCzy88h8AZhYJlXivVrl4LySPzoXkN4PofZ5v1q44AAAAAElFTkSuQmCC",ft="/new_farmer_dist/assets/trap_green_default-4e22ed9b.svg",pt="/new_farmer_dist/assets/trap_green_selected-50db3ff5.svg",ht="/new_farmer_dist/assets/trap_green_hover-94fb773d.svg",mt="/new_farmer_dist/assets/trap_red_default-8a46b256.svg",vt="/new_farmer_dist/assets/trap_red_selected-87af6be1.svg",At="/new_farmer_dist/assets/trap_red_hover-33543daa.svg",yt="/new_farmer_dist/assets/trap_orange_default-fbd0de4d.svg",xt="/new_farmer_dist/assets/trap_orange_selected-15335778.svg",bt="/new_farmer_dist/assets/trap_orange_hover-ecdc61c5.svg",wt="Aerial",_t="Ak2gN0iZ3d02J-xwYSYgRp8oHFZCOneWeg_Hj7C2ZntIKTXCGc0HXVQ8GHkuxp17",Dt=pe({__name:"EntitiesMapViewer",props:{parcels:{},curParcel:{},traps:{},curTrap:{},zoomOnTrap:{},zoomOnPlot:{}},emits:["select-trap","select-parcel"],setup(o,{emit:N}){const Z=new Ye({visible:!0,preload:1/0,source:new Oe({key:_t,imagerySet:wt})}),y=[{parcelId:12,image:at,coordX:.4,coordY:.5,scale:14},{parcelId:10,image:nt,coordX:.5,coordY:.5,scale:14},{parcelId:2,image:st,coordX:.53,coordY:.48,scale:14},{parcelId:3,image:rt,coordX:.55,coordY:.51,scale:14},{parcelId:11,image:ot,coordX:.55,coordY:.51,scale:14},{parcelId:9,image:lt,coordX:.74,coordY:.51,scale:14},{parcelId:8,image:it,coordX:.47,coordY:.48,scale:14},{parcelId:6,image:ct,coordX:.47,coordY:.48,scale:14},{parcelId:7,image:dt,coordX:.46,coordY:.52,scale:14},{parcelId:13,image:ut,coordX:.51,coordY:.53,scale:13},{parcelId:1,image:gt,coordX:.51,coordY:.53,scale:14}],F=Ne(),{map:x,mapRef:A,padding:R}=He();let k=null,C=null;const T=new Ge;let z=null;const S=new je;_e(async()=>{A.value&&(x.setTarget(A.value),A.value.addEventListener("mouseleave",f),await new Promise(s=>setTimeout(s,500))),Q(),x.getLayers().clear(),await J(),H(),U(),re()});async function J(){x.addLayer(Z)}Fe(()=>{Q()});function f(){F.emit("hover:map",[])}function E(s){if(s.type==="pointermove"){const t=x.getFeaturesAtPixel(s.pixel);if(t&&t.length>=1){const r=t[0]?.values_?.features[0]?.values_?.type;if(r&&r==="trap"){const d=t[0].get("features");if(Array.isArray(d)&&d.length>0){const l=d.map(u=>u.get("ref"));F.emit("hover:map",l)}else F.emit("hover:map",[t[0].get("ref")]);x.getTargetElement().style.cursor="pointer"}}else F.emit("hover:map",[]),x.getTargetElement().style.cursor="default";return!0}return!1}function v(s){const t=x.getAllLayers().find(r=>r.get("name")==="trapInteractionLayer");if(t){const r=t.getSource();if(r){const d=r.getFeatures();for(const l of d){const u=l.get("features");if(Array.isArray(u)){for(const a of u)if(a.getProperties().ref===s)return l}else if(l.getProperties().ref===s)return l}}}return null}function b(s){const t=x.getAllLayers().find(r=>r.get("name")==="parcelInteractionLayer");if(t){const r=t.getSource();if(r){const d=r.getFeatures();for(const l of d){const u=l.get("features");if(Array.isArray(u)){for(const a of u)if(a.getProperties().ref===s)return l}else if(l.getProperties().ref===s)return l}}}return null}function L(s){const t=We();return s.forEach(r=>{const d=r.getGeometry();d&&Je(t,d.getExtent())}),t}function Q(){x.getLayers().getArray().filter(t=>t instanceof ue).forEach(t=>{x.removeLayer(t)}),T.getLength()&&T.clear(),k&&(x.removeInteraction(k),k.dispose(),k=null),C&&(x.removeInteraction(C),C.dispose(),C=null)}function H(){const s=[];o.parcels.forEach(l=>{const u=S.readFeature(l.world_geom);u.setProperties({ref:"parcel_"+l.parcel_id,type:"parcel",parcel_id:l.parcel_id}),T.push(u),s.push(u)}),z=new he({features:s});const t=new me({distance:0,source:z,geometryFunction:ae}),r=new ue({source:t,style:ee,properties:{name:"parcelInteractionLayer",ref:ve.VECTOR,id:"parcel"},renderBuffer:500});x.addLayer(r),r.setZIndex(900);const d=L(T.getArray());ie(d)}O(()=>o.curParcel,()=>{if(T.getArray().filter(t=>t.getProperties().type==="parcel").forEach(t=>{t.setStyle(ee)}),o.curParcel){const t=o.parcels.find(r=>r.parcel_id===o.curParcel.parcel_id);if(t){const r=b("parcel_"+t.parcel_id);r&&r.setStyle(I)}}}),O(()=>o.zoomOnPlot,()=>{if(o.curParcel){const s=o.parcels.find(t=>t.parcel_id===o.curParcel.parcel_id);if(s){const t=b("parcel_"+s.parcel_id);if(t){const r=L([t]),d=xe(r),l=[d[0],d[1]-100];x.getView().animate({center:l,duration:500})}}}});function U(){const s=[];o.parcels.forEach(l=>{if(y.find(u=>u.parcelId===l.parcel_id)){const u=S.readFeature(l.world_geom);u.setProperties({ref:"ndvi_"+l.parcel_id,type:"ndvi",parcel_id:l.parcel_id}),T.push(u),s.push(u)}});const t=new he({features:s}),r=new me({distance:0,source:t,geometryFunction:ae}),d=new ue({source:r,style:G,properties:{name:"ndviLayer",ref:ve.VECTOR,id:"ndvi"},renderBuffer:500});d.on("prerender",l=>{const u=l.context;u.imageSmoothingEnabled=!1;const a=u;a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1}),x.addLayer(d),d.setZIndex(700)}function re(){const s=[];o.traps.forEach(l=>{const u=S.readFeature(ce(Xe([l.coordinates.lon,l.coordinates.lat])));u.setProperties({ref:"trap_"+l.id,type:"trap",trap_id:l.id}),T.push(u),s.push(u)});const t=new he({features:s}),r=new me({distance:0,source:t,geometryFunction:ae}),d=new ue({source:r,style:V,properties:{name:"trapInteractionLayer",ref:ve.VECTOR,id:"trap"},renderBuffer:500});k=new Ce({style:n,condition(l){return $e(l)},layers:function(l){return l.get("name")==="trapInteractionLayer"}}),x.addInteraction(k),k.on("select",l=>{const u=l.target.getFeatures().getArray()[0].getProperties().features;if(u.length>1){const a=L(u);ie(a)}else{const a=u[0].get("trap_id"),h=o.traps.find(c=>c.id===a);N("select-trap",h)}}),C=new Ce({style:M,condition:E,layers:function(l){return l.get("name")==="trapInteractionLayer"}}),x.addInteraction(C),x.addLayer(d),d.setZIndex(910)}O(()=>o.curTrap,()=>{if(T.getArray().filter(t=>t.getProperties().type==="trap").forEach(t=>{t.setStyle(V)}),o.curTrap){const t=o.traps.find(r=>r.id===o.curTrap.id);if(t){const r=v("trap_"+t.id);r&&r.setStyle(n)}}}),O(()=>o.zoomOnTrap,()=>{if(o.curTrap){const s=o.traps.find(t=>t.id===o.curTrap.id);if(s){const t=v("trap_"+s.id);if(t){const r=L([t]);x.getView().animate({center:xe(r),duration:500})}}}});const ee=s=>{if(s.get("features")!==void 0){const d=s.get("features")[0].getGeometry().getCoordinates();return new ne({stroke:new Te({color:Se("lime-200",1),width:2}),geometry:new Ae(d)})}},I=s=>{if(s.get("features")!==void 0){const d=s.get("features")[0].getGeometry().getCoordinates();return new ne({stroke:new Te({color:Se("lime-50",1),width:4}),geometry:new Ae(d)})}},V=s=>{const t=s.get("features");if(t!==void 0){const r=o.traps.find(u=>u.id===t[0].values_.trap_id);let d=0;r.insects.forEach(u=>{d+=u.count});let l=ft;return d>r.danger_treshold?l=mt:d>r.warning_treshold&&(l=yt),new ne({image:new ge({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:l})})}},M=s=>{const t=s.get("features");if(t!==void 0){const r=o.traps.find(d=>d.id===t[0].values_.trap_id);if(r){let d=0;r.insects.forEach(u=>{d+=u.count});let l=ht;return d>r.danger_treshold?l=At:d>r.warning_treshold&&(l=bt),new ne({image:new ge({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:l})})}}},n=s=>{const t=s.get("features");if(t!==void 0){const r=o.traps.find(u=>u.id===t[0].values_.trap_id);let d=0;r.insects.forEach(u=>{d+=u.count});let l=pt;return d>r.danger_treshold?l=vt:d>r.warning_treshold&&(l=xt),new ne({image:new ge({scale:1,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:l})})}},G=s=>{const t=s.get("features");if(t!==void 0){const d=s.get("features")[0].getGeometry().getCoordinates(),u=new Ae(d).getInteriorPoint().getCoordinates(),a=y.find(h=>h.parcelId===t[0].values_.parcel_id);if(a)return new ne({image:new ge({scale:a.scale,anchor:[a.coordX,a.coordY],anchorXUnits:"fraction",anchorYUnits:"fraction",src:a.image}),geometry:new ye(u)})}};function ie(s){x.getView().fit(s,{padding:[50,50,50,50],easing:Ke,duration:1e3})}function ae(s){const t=s.getGeometry();return t?new ye(xe(t.getExtent())):new ye([0])}function ce(s){return"POINT("+s[0]+" "+s[1]+")"}return(s,t)=>(i(),g("div",{ref_key:"mapRef",ref:A,class:"relative h-full w-full"},null,512))}}),Ct=[{id:0,name:"Rodilegno"},{id:1,name:"Lobesia botrana"},{id:2,name:"Tortricidae"},{id:3,name:"Coleottero"},{id:4,name:"Popillia Japonica"},{id:5,name:"Processionaria"},{id:6,name:"Cerambycidae"}],Tt=[{id:"1",name:"S03925",type:"Cymatrap garden",last_capture:new Date("2023-03-28"),warning_treshold:30,danger_treshold:50,insects:[{count:5,id:"0",name:"Rodilegno"},{count:18,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.560286922994884,lon:10.721558966213962},battery:67,signal:100},{id:"2",name:"S05321",type:"Cymatrap garden",last_capture:new Date("2023-03-10"),warning_treshold:30,danger_treshold:70,insects:[{count:2,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.561788608518086,lon:10.719467188742241},battery:89,signal:70},{id:"3",name:"S08513",type:"Cymatrap pro",last_capture:new Date("2023-02-07"),warning_treshold:200,danger_treshold:300,insects:[{count:12,id:"0",name:"Rodilegno"},{count:1,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56160296275679,lon:10.720474777327212},battery:56,signal:50},{id:"4",name:"S00593",type:"Isagro dispenser",last_capture:new Date("2023-04-30"),warning_treshold:10,danger_treshold:20,insects:[{count:32,id:"0",name:"Rodilegno"},{count:3,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559936248891546,lon:10.720922594476088},battery:34,signal:100},{id:"5",name:"S03858",type:"Isagro dispenser",last_capture:new Date("2023-03-14"),warning_treshold:80,danger_treshold:200,insects:[{count:41,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55896672672015,lon:10.721040441094033},battery:16,signal:80},{id:"6",name:"S05952",type:"Isagro dispenser",last_capture:new Date("2023-03-10"),warning_treshold:120,danger_treshold:200,insects:[{count:32,id:"0",name:"Rodilegno"},{count:15,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55821997698153,lon:10.721606104861031},battery:89,signal:30},{id:"7",name:"S08332",type:"Linea bacterocera",last_capture:new Date("2023-03-22"),warning_treshold:50,danger_treshold:100,insects:[{count:4,id:"0",name:"Rodilegno"},{count:7,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.56011777455661,lon:10.722436923510717},battery:78,signal:20},{id:"8",name:"S09876",type:"Isagro carpo +",last_capture:new Date("2023-03-24"),warning_treshold:30,danger_treshold:70,insects:[{count:0,id:"0",name:"Rodilegno"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.55862017006319,lon:10.72403963751722},battery:55,signal:0},{id:"9",name:"S02273",type:"Isagro carpo +",last_capture:new Date("2023-03-26"),warning_treshold:10,danger_treshold:20,insects:[{count:51,id:"0",name:"Rodilegno"},{count:23,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559086370782154,lon:10.721712166809247},battery:54,signal:80},{id:"10",name:"S01423",type:"Isagro double wing",last_capture:new Date("2023-03-07"),warning_treshold:10,danger_treshold:20,insects:[{count:54,id:"0",name:"Rodilegno"},{count:34,id:"1",name:"Lobesia botrana"},{count:21,id:"2",name:"Tortricidae"},{count:4,id:"3",name:"Coleottero"},{count:12,id:"4",name:"Popillia Japonica"}],coordinates:{lat:45.559346286317734,lon:10.722271938245344},battery:79,signal:100}],Pt={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},St=e("span",{class:"sr-only"},"Chiudi pannello",-1),Et=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Bt=[St,Et],kt={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},It={class:"flex w-6/12 items-center border-r pr-6"},Vt={class:"flex flex-grow flex-col"},Ft={class:"flex items-center gap-x-3"},Lt={class:"flex gap-x-3 text-lg leading-7"},Ut={class:"font-semibold"},Mt={class:"mt-2 text-sm leading-6 text-label"},Qt={class:"flex w-6/12"},Rt={class:"flex w-full divide-x divide-border"},zt={class:"text-sm font-medium leading-6 text-label"},Yt={class:"text-3xl font-medium tracking-tight text-text"},Ot={key:0,class:"text-sm text-label"},Nt={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Ht={class:"flex h-full w-6/12"},Gt={key:0,class:"flex h-full w-full"},jt={class:"relative flex h-full w-full pb-4 pl-3 pr-3 pt-4"},Xt={class:"absolute z-10 flex h-16 w-12 flex-col items-center justify-center",style:{left:"calc(50% - 1.5rem)",top:"calc(50% - 2rem)"}},$t=e("span",{class:"text-sm font-medium text-label"},"Totali",-1),Kt={class:"text-3xl font-medium tracking-tight text-text"},Jt={class:"thin-scrollbar relative flex h-full w-full flex-col space-y-3 overflow-auto pb-4 pl-8 pr-6"},Wt={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3"},Zt={class:"flex w-full flex-col"},qt={class:"flex w-full items-center"},ea={class:"text-sm font-medium text-label"},ta={class:"text-3xl font-medium tracking-tight text-text"},aa={key:1,class:"thin-scrollbar h-full w-full overflow-auto px-6 pb-6"},na={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 py-3"},sa=e("th",null,"Insetto",-1),ra=e("th",null,"Conteggio",-1),oa={class:"flex flex-col h-full w-6/12 px-6 border-l overflow-auto thin-scrollbar"},la={class:"sticky top-0 z-10 flex w-full justify-end border-b bg-bg-100 pb-3 pt-3 space-x-2"},ia={key:0,class:"flex h-full w-full"},ca={class:"relative flex h-full w-full pb-4 pt-4"},da={key:1,class:"w-full pb-6"},ua=e("th",null,"Giorno",-1),ga=pe({__name:"trapResumePanel",props:{insectTypes:{},curTrap:{}},emits:["close"],setup(o,{emit:N}){const Z=ke(),y=m(!0);let F=!1,x=!1;const A=m(null),R=m(null),k=["Anno","Mese","Settimana"],C=m("Settimana"),T=m("chart"),z=m("chart"),S=m(0),J=m(0);let f=m([]);const E=m([]),v=et.color;let b=[],L=[],Q=[],H=[],U=[];function re(a){a.style.height=0}function ee(a){a.style.height=`${o.curTrap.battery}%`,a.style.transition="height 1s ease-out"}function I(a){a.style.height=0}function V(a){a.style.height=`${o.curTrap.signal}%`,a.style.transition="height 1s ease-out"}const M=oe(()=>{let a=0;return o.curTrap.insects.forEach(h=>{a+=h.count}),a}),n=oe(()=>M.value>o.curTrap.danger_treshold),G=oe(()=>M.value>o.curTrap.warning_treshold),ie=oe(()=>Math.floor(M.value/o.curTrap.danger_treshold*100));_e(async()=>{o.curTrap?(ce(),ae(),s(),r()):(F=!0,x=!0),y.value=!1}),O(()=>Z.darkMode,async()=>{s(!0),r(!0)}),O(()=>o.curTrap,async()=>{ce(),ae(),s(),r()});function ae(){f.value=[];const a=new Date,h=365;a.setDate(new Date().getDate()-h);for(let c=0;c<h;c++){const _=new Date(a);_.setDate(_.getDate()+c);const D=[];o.curTrap.insects.forEach(W=>{D.push({id:W.id,name:W.name,count:Math.floor(Math.random()*25)+1})});const j={insects:D,date:_};f.value.push(j)}}function ce(){const a=Math.floor(Math.random()*25)+1;E.value=[{name:"Batteria",value:o.curTrap.battery.toString(),unit:"%"},{name:"Segnale",value:o.curTrap.signal.toString(),unit:"%"},{name:"Ultima cattura",value:a.toString(),unit:"gg fa"}]}function s(a=!1){if(o.curTrap.insects.length===0){F=!0;return}const h=o.curTrap.insects,c=Ee("color-bg-100");Q=[],b=[],U=[];const _={id:"insects",name:"Insetti",radius:["82%","90%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:c,borderWidth:4},label:{show:!1,position:"center"},emphasis:{label:{show:!1,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},type:"pie",data:[]};h.forEach(D=>{U.findIndex(j=>j.type_id===D.id)===-1&&U.push({type_id:D.id,type_description:D.name,colorIndex:0,count:0})}),U.forEach((D,j)=>{let W=0;h.forEach(de=>{de.id===D.type_id&&(W=W+de.count)}),D.count=W,D.colorIndex=j,Q.push(D.type_description),_.data.push({value:D.count,name:D.type_description})}),b.push(_),d(),a&&S.value++}O(()=>C.value,async()=>{r()});const t=oe(()=>{if(f.value.length===0)return[];const a=[];let h=new Date;f.value.length>0&&(h=new Date(f.value[f.value.length-1].date));let c=0;return C.value==="Anno"?c=365:C.value==="Mese"?c=30:C.value==="Settimana"&&(c=7),h.setDate(new Date().getDate()-c),h.setHours(0,0,0,0),f.value.forEach(_=>{const D=new Date(_.date);D.setHours(0,0,0,0),D.getTime()>h.getTime()&&a.push(_)}),a});function r(a=!1){if(t.value.length===0){x=!0;return}Ee("color-bg-100"),H=[],L=[];const h=[],c=[];t.value[0].insects.forEach(_=>{h.findIndex(D=>D.id===_.id)===-1&&h.push({id:_.id,name:_.name})}),h.forEach((_,D)=>{const j={id:"line_"+_.id,name:_.name,smooth:!0,lineStyle:{width:2},symbolSize:6,type:"line",data:[]};c.push(j)}),t.value.forEach(_=>{const D=new Date(_.date);H.push(new we(D).format("dd/MM")),_.insects.forEach(j=>{const W=c.findIndex(de=>de.id==="line_"+j.id);W!==-1&&c[W].data.push(j.count)})}),L.push(...c),l(),a&&J.value++}function d(){A.value={grid:{top:12,right:24,left:24,bottom:20,containLabel:!0},tooltip:{trigger:"none"},legend:{show:!1,selectedMode:!1},series:b,textStyle:{fontFamily:"Work Sans"}}}function l(){R.value={grid:{top:12,right:0,left:0,bottom:0,containLabel:!0},tooltip:{trigger:"axis"},legend:{show:!1},xAxis:{type:"category",data:H},yAxis:[{type:"value",name:"",position:"left"}],series:L,textStyle:{fontFamily:"Work Sans"}}}function u(a,h){return new we(a).format(h)}return(a,h)=>(i(),g("div",Pt,[e("button",{type:"button",onClick:h[0]||(h[0]=c=>N("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},Bt),e("div",kt,[e("div",It,[e("div",Vt,[e("div",Ft,[e("h1",Lt,[e("span",Ut,p(a.curTrap.type),1)])]),e("p",Mt,p(a.curTrap.name),1)]),e("div",{class:w(["order-first flex-none rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset sm:order-none",{"bg-green-500/20 text-green-700 ring-green-400/30":!G.value,"bg-orange-500/20 text-orange-700 ring-orange-400/30":G.value&&!n.value,"bg-red-500/20 text-red-700 ring-red-400/30":n.value}])}," Saturazione al "+p(ie.value)+"% ",3)]),e("div",Qt,[e("div",Rt,[(i(!0),g($,null,K(E.value,(c,_)=>(i(),g("div",{key:c.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",zt,p(c.name),1),(i(),g("p",{class:"flex items-baseline gap-x-2",key:c.value},[e("span",Yt,p(c.value),1),c.unit?(i(),g("span",Ot,p(c.unit),1)):Y("",!0)])),c.name==="Batteria"?(i(),g("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":a.curTrap.battery>=75,"bg-orange-50":a.curTrap.battery>=50&&a.curTrap.battery<75,"bg-red-50":a.curTrap.battery<50}]),key:a.curTrap.id},[B(te,{appear:"",onBeforeAppear:re,onAfterAppear:ee},{default:P(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curTrap.battery>=75,"bg-orange-400":a.curTrap.battery>=50&&a.curTrap.battery<75,"bg-red-400":a.curTrap.battery<50}])},null,2)]),_:1})],2)):Y("",!0),c.name==="Segnale"?(i(),g("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-50":a.curTrap.signal>=75,"bg-orange-50":a.curTrap.signal>=50&&a.curTrap.signal<75,"bg-red-50":a.curTrap.signal<50}]),key:a.curTrap.id},[B(te,{appear:"",onBeforeAppear:I,onAfterAppear:V},{default:P(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":a.curTrap.signal>=75,"bg-orange-400":a.curTrap.signal>=50&&a.curTrap.signal<75,"bg-red-400":a.curTrap.signal<50}])},null,2)]),_:1})],2)):Y("",!0)]))),128))])])]),e("div",Nt,[e("div",Ht,[T.value==="chart"?(i(),g("div",Gt,[e("div",jt,[e("div",Xt,[$t,e("span",Kt,p(M.value),1)]),y.value?Y("",!0):(i(),q(Be,{key:0,options:A.value,loading:y.value,"no-data":X(F),"disable-theme-refresh":!0,rebuild:S.value},null,8,["options","loading","no-data","rebuild"]))]),e("div",Jt,[e("div",Wt,[B(be,{onUpdate:h[1]||(h[1]=c=>T.value=c),"cur-value":T.value},null,8,["cur-value"])]),(i(!0),g($,null,K(X(U).sort((c,_)=>_.count-c.count),c=>(i(),g("div",Zt,[e("div",qt,[e("div",{class:"mr-2 h-3 w-3 rounded-sm",style:Le("background: "+X(v)[c.colorIndex])},null,4),e("span",ea,p(c.type_description),1)]),e("div",null,[e("span",ta,p(c.count),1)])]))),256))])])):(i(),g("div",aa,[e("div",na,[B(be,{onUpdate:h[2]||(h[2]=c=>T.value=c),"cur-value":T.value},null,8,["cur-value"])]),B(Pe,{items:X(U),"is-compact":"","full-width":""},{header:P(()=>[sa,ra]),rows:P(({item:c})=>[e("td",null,p(c.type_description),1),e("td",null,p(c.count),1)]),_:1},8,["items"])]))]),e("div",oa,[e("div",la,[B(Ze,{values:k,onUpdate:h[3]||(h[3]=c=>C.value=c),"cur-value":C.value},null,8,["cur-value"]),B(be,{onUpdate:h[4]||(h[4]=c=>z.value=c),"cur-value":z.value},null,8,["cur-value"])]),z.value==="chart"?(i(),g("div",ia,[e("div",ca,[y.value?Y("",!0):(i(),q(Be,{key:0,options:R.value,loading:y.value,"no-data":X(x),"disable-theme-refresh":!0,rebuild:J.value},null,8,["options","loading","no-data","rebuild"]))])])):(i(),g("div",da,[B(Pe,{items:t.value,"is-compact":"","full-width":""},{header:P(()=>[e("th",null,p(t.value[0].insects[0].name),1),ua]),rows:P(({item:c})=>[e("td",null,p(c.insects[0].count),1),e("td",null,p(u(c.date,"dd/MM")),1)]),_:1},8,["items"])]))])])]))}}),fa={class:"absolute bottom-0 left-0 w-10/12 z-20 rounded-tr-md bg-bg-100",style:{height:"46%"}},pa=e("span",{class:"sr-only"},"Chiudi pannello",-1),ha=e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ma=[pa,ha],va={class:"flex items-start justify-between py-4 mt-9 border-t px-6 border-b",style:{height:"94px"}},Aa={class:"flex w-6/12 items-center border-r pr-6"},ya={class:"flex flex-grow flex-col"},xa={class:"flex items-center gap-x-3"},ba={class:"flex gap-x-3 text-lg leading-7"},wa={class:"font-semibold"},_a={class:"mt-2 text-sm leading-6 text-label"},Da={class:"flex w-6/12"},Ca={class:"flex w-full divide-x divide-border"},Ta={class:"text-sm font-medium leading-6 text-label"},Pa={class:"text-3xl font-medium tracking-tight text-text"},Sa={key:0,class:"text-sm text-label"},Ea={class:"flex w-full",style:{height:"calc(100% - 130px)"}},Ba={class:"flex flex-grow h-full"},ka={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Ia={class:"flex w-full flex-col items-center justify-center pt-2 pb-4"},Va={class:"flex items-center pb-6 pt-4"},Fa={class:"mr-5 border-ra pr-4a"},La={class:"text-5xl font-extralight"},Ua={class:"relative inline-flex items-center text-blue-400"},Ma={class:"mt-2 mb-4 flex flex-col md:flex-row w-full rounded-lg text-sm"},Qa={class:"text-sm font-light uppercase tracking-wider"},Ra={class:"text-xl"},za={class:"flex w-full text-sm border-t pt-4"},Ya={class:"w-full pb-2 text-center text-xs font-light uppercase tracking-wider"},Oa={class:"w-full pb-1 text-center"},Na={class:"w-full pl-1 text-center"},Ha={class:"flex flex-col h-full w-6/12 overflow-auto thin-scrollbar border-r px-6 relative"},Ga={role:"list",class:"space-y-6 py-6"},ja=e("div",{class:"w-px bg-gray-200"},null,-1),Xa=[ja],$a=e("div",{class:"relative flex h-6 w-6 flex-none items-center justify-center bg-bg-100"},[e("div",{class:"h-2 w-2 rounded-full bg-gray-50 ring-1 ring-gray-200"})],-1),Ka={class:"flex-auto rounded-lg p-3 border"},Ja={class:"flex justify-between gap-x-4"},Wa={class:"py-0.5 text-xs leading-5 text-gray-500"},Za={class:"font-medium text-gray-900"},qa=["datetime"],en={class:"text-sm leading-6 text-gray-500"},tn={class:"flex flex-col h-full w-60 overflow-auto thin-scrollbar border-r px-6 relative"},an={class:"flex flex-col items-center w-full py-6"},nn=e("i",{class:"fal fa-wheat"},null,-1),sn=e("i",{class:"fal fa-map"},null,-1),rn=e("div",{class:"pb-2 mb-2 w-full"},null,-1),on=e("i",{class:"fal fa-tractor"},null,-1),ln=e("i",{class:"fal fa-notebook"},null,-1),cn=pe({__name:"plotResumePanel",props:{curParcel:{}},emits:["close"],setup(o,{emit:N}){ke();const Z=Ue(),y=m(!0);m(null),m("Mese"),m("chart"),m(0);const F=[{id:0,comment:"Notati nugoli di insetti lungo il filare",date:"3 gg fa",dateTime:"2023-01-23T15:56"},{id:1,comment:"I nugoletti sono stati eliminati con un trattamento chimico",date:"5 gg fa",dateTime:"2023-01-23T15:56"},{id:2,comment:"Nugoli di insetti nuovamente notati",date:"7 gg fa",dateTime:"2023-01-23T15:56"},{id:3,comment:"I nugoli si fanno sempre più numerosi, urgono rinforzi",date:"13 gg fa",dateTime:"2023-01-23T15:56"},{id:4,comment:"I nugoli si stanno evolvendo in una vera e propria invasione",date:"15 gg fa",dateTime:"2023-01-23T15:56"},{id:5,comment:"Dite a tutti di stare attenti, i nugoletti sono molto pericolosi",date:"18 gg fa",dateTime:"2023-01-23T15:56"},{id:6,comment:"Non so se ce la farò, sono troppi",date:"21 gg fa",dateTime:"2023-01-23T15:56"},{id:7,comment:"I nugoletti hanno oscurato il cielo, non vedo più il sole",date:"23 gg fa",dateTime:"2023-01-23T15:56"}],x=m([]),A=m([]),R=m([]),C=m({id:"rainy",temp:"14°",icon:"fa-cloud-showers",theme:"weather-widget-rain"});function T(f){f.style.height=0}function z(f){f.style.height=`${o.curParcel.cultivatedPercentage}%`,f.style.transition="height 1s ease-out"}_e(async()=>{if(o.curParcel){const f=new Date,E=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],v=["fa-cloud-showers","fa-cloud-bolt","fa-cloud-fog","fa-sun-bright","fa-sun-bright"];for(let b=1;b<=5;b++){const L=new Date(f);L.setDate(L.getDate()+b);const Q=Math.floor(Math.random()*15)+10;R.value.push({day:E[L.getDay()],icon:v[b-1],temp:Q+"°"})}S(),J()}y.value=!1}),O(()=>o.curParcel,async()=>{S(),J()});function S(){x.value=[{name:"Coltivato",value:o.curParcel.cultivatedPercentage.toString(),unit:"%"},{name:"Area",value:o.curParcel.area.toString(),unit:"ha"},{name:"Indice NDVI",value:(o.curParcel.ndvi_change_type==="decrease"?"-":"+")+o.curParcel.ndvi_change.toString(),unit:"da ieri"}]}function J(){const f=Math.floor(Math.random()*50),E=Math.floor(Math.random()*20),v=Math.floor(Math.random()*20),b=Math.floor(Math.random()*20)+10;A.value=[{name:"Precipitazioni",value:f+" mm"},{name:"Vento",value:E+" km/h"},{name:"Temperature",value:v+"° - "+b+"°"}]}return(f,E)=>(i(),g("div",fa,[e("button",{type:"button",onClick:E[0]||(E[0]=v=>N("close")),class:"transition-colors-default absolute right-0 top-0 rounded-bl-md rounded-tr-md p-2 text-gray-500 hover:bg-gray-100 focus:outline-none"},ma),e("div",va,[e("div",Aa,[e("div",ya,[e("div",xa,[e("h1",ba,[e("span",wa,p(f.curParcel.name),1)])]),e("p",_a,p(f.curParcel.cropDescription),1)])]),e("div",Da,[e("div",Ca,[(i(!0),g($,null,K(x.value,(v,b)=>(i(),g("div",{key:v.name,class:"w-4/12 px-6 overflow-hidden relative"},[e("p",Ta,p(v.name),1),(i(),g("p",{class:"flex items-baseline gap-x-2",key:v.value},[e("span",Pa,p(v.value),1),v.unit?(i(),g("span",Sa,p(v.unit),1)):Y("",!0)])),v.name==="Coltivato"?(i(),g("div",{class:w(["flex items-end absolute top-0 bottom-0 right-2 w-2 rounded overflow-hidden",{"bg-green-100":f.curParcel.cultivatedPercentage>=75,"bg-orange-100":f.curParcel.cultivatedPercentage>=50&&f.curParcel.cultivatedPercentage<75,"bg-red-100":f.curParcel.cultivatedPercentage<50}]),key:f.curParcel.parcel_id},[B(te,{appear:"",onBeforeAppear:T,onAfterAppear:z},{default:P(()=>[e("div",{class:w(["absolute right-0 left-0 bottom-0 w-full",{"bg-green-400":f.curParcel.cultivatedPercentage>=75,"bg-orange-400":f.curParcel.cultivatedPercentage>=50&&f.curParcel.cultivatedPercentage<75,"bg-red-400":f.curParcel.cultivatedPercentage<50}])},null,2)]),_:1})],2)):Y("",!0),B(te,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":f.curParcel.ndvi_change_type==="increase"?"translate-y-2 opacity-0":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100"},{default:P(()=>[v.name==="Indice NDVI"?(i(),g("div",{class:"absolute h-12 w-12 top-2 right-0",key:f.curParcel.parcel_id},[f.curParcel.ndvi_change_type==="increase"?(i(),q(X(Ve),{key:0,class:"h-full w-full text-green-200","aria-hidden":"true"})):(i(),q(X(Ie),{key:1,class:"h-full w-full text-red-100","aria-hidden":"true"}))])):Y("",!0)]),_:2},1032,["enter-from-class"])]))),128))])])]),e("div",Ea,[e("div",Ba,[e("div",ka,[e("div",Ia,[e("div",Va,[e("div",Fa,[e("span",La,p(C.value.temp),1)]),e("div",Ua,[e("i",{class:w(["fa-solid relative z-10 text-5xl",C.value.icon]),style:{"font-size":"44px"}},null,2)])]),e("div",Ma,[(i(!0),g($,null,K(A.value,(v,b)=>(i(),g("div",{class:w(["flex flex-grow md:flex-col px-4 py-2 md:py-0 justify-between md:justify-normal items-center md:items-start",b<A.value.length-1?"border-b md:border-b-0 md:border-r":""])},[e("span",Qa,p(v.name),1),e("span",Ra,p(v.value),1)],2))),256))]),e("div",za,[(i(!0),g($,null,K(R.value,(v,b)=>(i(),g("div",{class:w(["flex flex-grow flex-col px-4",b<R.value.length-1?"border-r":""])},[e("span",Ya,p(v.day),1),e("span",Oa,[e("i",{class:w(["fa-solid relative z-10 text-xl text-blue-300",v.icon])},null,2)]),e("span",Na,p(v.temp),1)],2))),256))])])]),e("div",Ha,[e("ul",Ga,[(i(),g($,null,K(F,(v,b)=>e("li",{key:v.id,class:"relative flex gap-x-4"},[e("div",{class:w([b===F.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"])},Xa,2),$a,e("div",Ka,[e("div",Ja,[e("div",Wa,[e("span",Za,p(b%2===0?X(Z).name:"Tu"),1),se(" "+p(b%2===0?"ha":"hai")+" scritto ",1)]),e("time",{datetime:v.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-gray-500"},p(v.date),9,qa)]),e("p",en,p(v.comment),1)])])),64))])])]),e("div",tn,[e("div",an,[B(fe,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:P(()=>[nn]),default:P(()=>[se("Modifica colture")]),_:1}),B(fe,{"is-info":"","is-outlined":"",class:"w-full mb-3"},{icon:P(()=>[sn]),default:P(()=>[se("Vedi dettagli")]),_:1}),rn,B(fe,{"is-success":"","is-outlined":"",class:"w-full mb-3"},{icon:P(()=>[on]),default:P(()=>[se("Crea attività")]),_:1}),B(fe,{"is-success":"","is-outlined":"",class:"w-full"},{icon:P(()=>[ln]),default:P(()=>[se("Aggiungi nota")]),_:1})])])])]))}}),dn=[{id:-4,date:new Date(new Date().setDate(new Date().getDate()-12)),isPresent:!0},{id:-3,date:new Date(new Date().setDate(new Date().getDate()-11)),isPresent:!0},{id:-2,date:new Date(new Date().setDate(new Date().getDate()-10)),isPresent:!0},{id:-1,date:new Date(new Date().setDate(new Date().getDate()-9)),isPresent:!0},{id:0,date:new Date(new Date().setDate(new Date().getDate()-8)),isPresent:!0},{id:1,date:new Date(new Date().setDate(new Date().getDate()-7)),isPresent:!1},{id:2,date:new Date(new Date().setDate(new Date().getDate()-6)),isPresent:!1},{id:3,date:new Date(new Date().setDate(new Date().getDate()-5)),isPresent:!0},{id:4,date:new Date(new Date().setDate(new Date().getDate()-4)),isPresent:!0},{id:5,date:new Date(new Date().setDate(new Date().getDate()-3)),isPresent:!0},{id:6,date:new Date(new Date().setDate(new Date().getDate()-2)),isPresent:!1},{id:7,date:new Date(new Date().setDate(new Date().getDate()-1)),isPresent:!0},{id:8,date:new Date,isPresent:!0}];const De=o=>(Re("data-v-650d5132"),o=o(),ze(),o),un={class:"relative flex h-full w-full"},gn={class:"flex flex-col w-96 bg-green-25 rounded-l-lg overflow-auto thin-scrollbar relative"},fn={class:"flex w-full sticky top-0 pt-6 px-4 justify-between bg-green-25 z-10 pb-4"},pn={class:"flex flex-grow space-x-4 overflow-y-auto","aria-label":"Tabs"},hn=["onClick","aria-current"],mn={class:"border-l border-green-200 ml-3 pl-3"},vn=De(()=>e("i",{class:"fal fa-pen-to-square",style:{"margin-top":"-3px"}},null,-1)),An=[vn],yn={class:"flex flex-col w-full pt-4 rounded-t-2xl bg-bg-100 flex-grow"},xn={key:0,role:"list",class:"divide-y divide-border"},bn=["onClick"],wn={class:"flex max justify-between px-4"},_n={class:"flex"},Dn={class:"flex flex-col"},Cn={class:"text-sm font-semibold leading-6 text-gray-900"},Tn={class:"mt-1 flex text-sm leading-7 text-gray-500"},Pn={class:"flex items-center"},Sn={class:"hidden sm:flex sm:flex-col sm:items-end"},En={class:"text-sm leading-6 text-gray-900"},Bn={class:"mt-1 flex items-center"},kn={class:"sr-only"},In={key:1,role:"list",class:"divide-y divide-border"},Vn=["onClick"],Fn={class:"flex max justify-between px-4"},Ln={class:"flex"},Un={class:"flex flex-col"},Mn={class:"text-sm font-semibold leading-6 text-gray-900"},Qn={class:"mt-1 flex text-xs leading-5 text-gray-500"},Rn={class:"flex items-center"},zn={class:"hidden sm:flex sm:flex-col sm:items-end"},Yn={class:"text-sm leading-6 text-gray-900"},On={class:"mt-1 text-xs leading-5 text-gray-500"},Nn={class:"mt-1 flex items-center gap-x-1.5"},Hn=De(()=>e("p",{class:"text-xs leading-5 text-gray-500"},"Saturazione",-1)),Gn={key:2,class:"flex flex-col w-full h-full"},jn={class:"flex flex-col pb-3 border-b px-4"},Xn=De(()=>e("label",{for:"ndviRange",class:"form-label text-sm font-medium mb-2"},"Visibilità",-1)),$n={class:""},Kn=["onClick"],Jn={class:"flex items-center h-full justify-between px-4"},Wn={class:"flex items-center"},Zn={class:"text-sm font-semibold leading-6 text-gray-900"},qn={key:0,class:"flex items-center"},es={class:"flex flex-col flex-grow relative overflow-hidden"},ts=pe({__name:"index",setup(o){const N=[{name:"Appezz.",id:"plots",icon:"fa-map"},{name:"Trappole",id:"traps",icon:"fa-mosquito"},{name:"Ndvi",id:"ndvi",icon:"fa-satellite"}],Z=m(qe),y=m(null),F=m(Tt),x=m(Ct),A=m(null),R=m(dn),k=m(R.value[R.value.length-1]),C=m(0),T=m(0),z=m(10),S=m(N[0].id),J=m(!1),f=m(!1),E=m(!1);function v(){J.value=!0}O(()=>S.value,()=>{f.value=!1,A.value=null,E.value=!1,y.value=null}),O(()=>A.value,()=>{A&&(f.value=!0)}),O(()=>y.value,()=>{y.value&&(E.value=!0)});function b(){f.value=!1,A.value=null}function L(){E.value=!1,y.value=null}function Q(I){let V=0;return I.insects.forEach(M=>{V+=M.count}),V}function H(I){return Q(I)>I.danger_treshold}function U(I){return Q(I)>I.warning_treshold}function re(I){return Math.floor(Q(I)/I.danger_treshold*100)}function ee(I,V){return new we(I).format(V)}return(I,V)=>{const M=Me("bf-tooltip");return i(),g("div",un,[e("div",gn,[e("div",fn,[e("nav",pn,[(i(),g($,null,K(N,n=>e("button",{role:"tab",key:n.id,onClick:G=>S.value=n.id,class:w([(S.value===n.id,""),"group flex flex-col items-center space-y-1"]),"aria-current":S.value===n.id?"page":void 0},[e("span",{class:w([S.value===n.id?"border-green-600 bg-green-600 text-green-50":"border-transparent group-hover:border-green-400 text-green-500","flex flex-col items-center justify-center border-2 w-14 h-14 bg-green-400/20 transition-colors-default rounded-full"])},[e("i",{class:w(["fal",n.icon])},null,2)],2),e("span",{class:w([S.value===n.id?"text-green-700":"group-hover:text-green-700","text-sm font-medium text-gray-500 transition-colors-default"])},p(n.name),3)],10,hn)),64))]),e("div",mn,[le((i(),g("button",{onClick:v,class:"border-transparent hover:bg-green-400/20 rounded-md h-full text-green-500 flex text-xl px-4 items-center justify-center transition-colors-default"},An)),[[M,"Aggiungi/rimuovi"]])])]),e("div",yn,[B(te,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100"},{default:P(()=>[S.value==="plots"?(i(),g("ul",xn,[(i(!0),g($,null,K(Z.value,n=>(i(),g("li",{class:w(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":y.value&&y.value.parcel_id===n.parcel_id}]),onClick:G=>{f.value=!1,A.value=null,y.value=!y.value||y.value&&y.value.parcel_id!==n.parcel_id?n:null,T.value++}},[e("div",wn,[e("div",_n,[e("div",Dn,[e("p",Cn,p(n.name),1),e("p",Tn,p(n.cropDescription),1)])]),e("div",Pn,[e("div",Sn,[e("p",En,p(n.area)+" ha",1),e("div",Bn,[le((i(),g("div",{class:w([n.ndvi_change_type==="increase"?"bg-green-50 text-green-800":"bg-red-50 text-red-800","inline-flex items-baseline rounded-full px-2.5 py-0.5 text-sm font-medium md:mt-2 lg:mt-0"])},[n.ndvi_change_type==="increase"?(i(),q(X(Ve),{key:0,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-green-500","aria-hidden":"true"})):(i(),q(X(Ie),{key:1,class:"-ml-1 mr-0.5 h-4 w-4 flex-shrink-0 self-center text-red-500","aria-hidden":"true"})),e("span",kn,p(n.ndvi_change_type==="increase"?"Aumendo":"Diminuzione")+" del ",1),se(" "+p(n.ndvi_change),1)],2)),[[M,n.ndvi_change_type==="increase"?"Aumendo indice NDVI da ieri":"Diminuzione indice NDVI da ieri"]])])])])])],10,bn))),256))])):S.value==="traps"?(i(),g("ul",In,[(i(!0),g($,null,K(F.value,n=>(i(),g("li",{class:w(["relative py-3 hover:bg-gray-50 cursor-pointer transition-colors-default",{"!bg-gray-100":A.value&&A.value.id===n.id}]),onClick:G=>{E.value=!1,y.value=null,A.value=!A.value||A.value&&A.value.id!==n.id?n:null,C.value++}},[e("div",Fn,[e("div",Ln,[e("div",Un,[e("p",Mn,p(n.type),1),e("p",Qn,p(n.name),1)])]),e("div",Rn,[e("div",zn,[e("p",Yn,p(Q(n))+" catture ",1),e("p",On," Ultima cattura "+p(ee(n.last_capture,"dd/MM")),1),e("div",Nn,[le((i(),g("div",{class:w(["flex-none rounded-full p-1",{"bg-green-500/20":!U(n),"bg-orange-500/20":U(n)&&!H(n),"bg-red-500/20":H(n)}])},[e("div",{class:w(["h-1.5 w-1.5 rounded-full",{"bg-green-500":!U(n),"bg-orange-500":U(n)&&!H(n),"bg-red-500":H(n)}])},null,2)],2)),[[M,re(n)+"%"]]),Hn])])])])],10,Vn))),256))])):(i(),g("div",Gn,[e("div",jn,[Xn,le(e("input",{"onUpdate:modelValue":V[0]||(V[0]=n=>z.value=n),type:"range",class:"form-range",min:"0",max:"10",step:"0.1",id:"ndviRange"},null,512),[[Qe,z.value]])]),e("ul",$n,[(i(!0),g($,null,K(R.value.sort((n,G)=>G.date.getTime()-n.date.getTime()),n=>(i(),g("li",{class:w(["relative py-4 transition-colors-default border-b",{"!bg-gray-100":k.value&&k.value.id===n.id,"hover:bg-gray-50 cursor-pointer":n.isPresent}]),onClick:G=>n.isPresent?k.value=!k.value||k.value&&k.value.id!==n.id?n:null:"",style:{height:"73px"}},[e("div",Jn,[e("div",Wn,[e("p",Zn,p(ee(n.date,"dd/MM")),1)]),n.isPresent?Y("",!0):(i(),g("div",qn,[le((i(),g("div",{class:w(["flex items-center justify-center w-12 h-12 rounded-full text-xl",n.isPresent?"bg-teal-50 text-teal-400":"bg-gray-50 text-gray-400"])},[e("i",{class:w(["fal",n.isPresent?"fa-check":"fa-clouds"])},null,2)],2)),[[M,n.isPresent?"NDVI presente":"È stata scattata un'immagine satellitare in questo giorno, ma l'indice di vegetazione NDVI non può essere calcolato. Ciò può accadere a causa della copertura nuvolosa, della foschia, della neve o di altri fattori."]])]))])],10,Kn))),256))])]))]),_:1})])]),e("div",es,[B(Dt,{parcels:Z.value,curParcel:y.value,traps:F.value,curTrap:A.value,zoomOnTrap:C.value,zoomOnPlot:T.value,onSelectTrap:V[1]||(V[1]=n=>{E.value=!1,y.value=null,A.value=!A.value||A.value&&A.value.id!==n.id?n:null}),onSelectParcel:V[2]||(V[2]=n=>{f.value=!1,A.value=null,y.value=!y.value||y.value&&y.value.parcel_id!==n.parcel_id?n:null})},null,8,["parcels","curParcel","traps","curTrap","zoomOnTrap","zoomOnPlot"]),B(te,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:P(()=>[f.value&&A.value?(i(),q(ga,{key:0,curTrap:A.value,insectTypes:x.value,onClose:b},null,8,["curTrap","insectTypes"])):Y("",!0)]),_:1}),B(te,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:P(()=>[E.value&&y.value?(i(),q(cn,{key:0,curParcel:y.value,onClose:L},null,8,["curParcel"])):Y("",!0)]),_:1})])])}}}),ls=tt(ts,[["__scopeId","data-v-650d5132"]]);export{ls as default};
